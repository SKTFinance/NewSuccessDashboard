<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finanzanalyse – Präsentation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    
    
    /* === Transition Styles === */
    .slide {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.8s ease, visibility 0.8s ease;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }
    .slide.active {
      opacity: 1;
      visibility: visible;
      pointer-events: all;
      z-index: 10;
    }
    .fade-in {
      opacity: 0;
      transform: translateY(15px);
      transition: all 0.6s ease;
    }
    .fade-in.show {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* Überschriften die immer sichtbar sein sollen */
    .always-visible {
      opacity: 1 !important;
      transform: translateY(0) !important;
      visibility: visible !important;
    }
    
    /* Zoom-safe styling */
    @media screen and (min-width: 1024px) {
      .content-container {
        transform-origin: center center;
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    }
    
    /* Responsive text scaling */
    .responsive-text {
      font-size: clamp(1.2rem, 4vw, 3rem);
    }
    .responsive-title {
      font-size: clamp(2rem, 6vw, 4.5rem);
    }
    .responsive-subtitle {
      font-size: clamp(1.5rem, 5vw, 2.5rem);
    }
    
    /* Control buttons styling */
    .control-buttons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 12px;
      z-index: 1001;
    }
    
    .control-btn {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      background: rgba(30, 64, 175, 0.9);
      border: 2px solid rgba(56, 189, 248, 0.6);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .control-btn:hover {
      background: rgba(56, 189, 248, 0.9);
      border-color: rgba(56, 189, 248, 1);
      transform: scale(1.1);
    }
    

    
    /* Navigation indicator */
    .nav-indicator {
      position: fixed;
      bottom: 20px;
      left: 20px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      z-index: 1000;
    }

    /* Berater-Seite Styling */
    .bg-accent-gold {
      background-color: #fbbf24;
    }

    .text-skt-blue {
      color: #1e40af;
    }

    .bg-skt-blue-light {
      background-color: #3b82f6;
    }

    .text-gold {
      color: #fbbf24;
    }

    .loader-white {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 3px solid #ffffff;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-sky-950 text-white font-sans overflow-hidden">

  <!-- ====================================== -->
  <!-- // Folie 0 – Berater-Name Eingabe -->
  <!-- ====================================== -->
  <section id="folie0" class="slide active flex flex-col items-center justify-center px-4 content-container">
    <div class="text-center w-full max-w-4xl">
      <h1 class="text-8xl font-bold mb-12">Willkommen zur digitalen Analyse</h1>
      <p class="text-4xl mb-8 text-gray-300">Reduziere deinen Zoom im Browser auf das Minimum strg-</p>
      <p class="text-4xl mb-8 text-gray-300">Bitte gib deinen Namen ein, um zu starten.</p>
      <input type="text" id="beraterNameInput" class="text-4xl text-center bg-transparent border-b-2 border-gray-400 focus:border-white focus:outline-none py-2 text-white placeholder-gray-400" placeholder="Dein Name (Berater)">
    </div>
  </section>


    <!-- ====================================== -->
  <!-- // Folie 1 – Herzlich Willkommen -->
  <!-- ====================================== -->
  <section id="folie1" class="slide flex flex-col items-center justify-center text-center px-4 cursor-pointer content-container" onclick="nextSlide(2)">
    <img src="AnalyseBilder/business-intelligence-in-der-finanzanalyse.webp"
         alt="Business Intelligence / Finanzanalyse"
         class="absolute inset-0 w-full h-full object-cover opacity-15 pointer-events-none" />
    <div class="relative z-10 max-w-5xl w-full">
      <h1 class="text-9xl md:text-8xl font-bold mb-16 drop-shadow-lg leading-tight text-center">
        Herzlich Willkommen<br>zur Finanzanalyse
      </h1>
      <p class="responsive-subtitle mb-10" id="beraterInfo">
        <span id="beraterRang">Finanzexperte</span> <span class="font-semibold text-sky-300" id="beraterNameDisplay">Ihr Berater</span>
      </p>
      <blockquote class="text-lg md:text-xl lg:text-4xl italic text-sky-100 leading-relaxed border-l-4 border-sky-400 pl-6 mb-4 max-w-4xl">
        „Manchmal ist es besser, eine Stunde über sein Geld nachzudenken,<br>
        als eine Woche dafür zu arbeiten."
      </blockquote>
      <p class="text-base md:text-lg text-sky-200 mb-10">– André Kostolany (1906 – 1999)</p>
      <p class="text-sky-400 text-xl animate-pulse">Klicken oder tippen, um fortzufahren →</p>
    </div>
  </section>

  <!-- ====================================== -->
  <!-- // Folie 2 – Berater-Vorstellung -->
  <!-- ====================================== -->
  <section id="folie2" class="slide flex flex-col items-center justify-center px-4 cursor-pointer content-container" onclick="nextSlide(3)">
    <div id="berater-slide-container" class="w-full max-w-7xl fade-in">
      <!-- Berater-Inhalt wird dynamisch per JavaScript generiert -->
      <div class="flex justify-center items-center h-64">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-white mb-4"></div>
          <p class="text-xl">Lade Beraterinformationen...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ====================================== -->
  <!-- // Folie 3 – OVB → SKT Finance -->
  <!-- ====================================== -->
  <section id="folie3" class="slide flex flex-col items-center justify-center px-4 cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift -->
    <h1 class="text-6xl md:text-7xl font-bold mb-16 text-center text-white always-visible">Ein starkes Netzwerk</h1>
    
    <div class="flex items-center justify-center gap-20 w-full max-w-6xl">
      
      <!-- SKT Finance Logo -->
      <div class="flex flex-col items-center fade-in" id="sktLogo">
        <div class="rounded-2xl p-12 shadow-2xl">
          <img src="AnalyseBilder/SKT Logo_transparent Kopie.png" alt="SKT Finance Logo" class="w-80 h-80 object-contain">
        </div>
      </div>

      <!-- Pfeil -->
      <div class="flex justify-center fade-in" id="arrow">
        <svg class="w-20 h-20 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
      </div>

      <!-- OVB Logo -->
      <div class="flex flex-col items-center fade-in" id="ovbLogo">
        <div class="bg-white rounded-2xl p-12 shadow-2xl">
          <img src="AnalyseBilder/ovb logo.png" alt="OVB Logo" class="w-80 h-80 object-contain">
        </div>
      </div>
    </div>
  </section>

  <!-- ====================================== -->
  <!-- // Folie 4 – OVB Fakten -->
  <!-- ====================================== -->
  <section id="folie4" class="slide flex flex-col items-center justify-center px-4 cursor-pointer content-container" onclick="nextStep()">
    
    <!-- Hauptcontainer mit flexibler Aufteilung -->
    <div class="flex flex-col w-full h-full items-center justify-center gap-12 py-16">
      
      <!-- Überschrift mit Abstand -->
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white mt-8">Fakten zu OVB</h1>
      
      <!-- Inhalt Container -->
      <div class="flex w-full items-center justify-center gap-12 flex-1">
      
      <!-- Linke Seite: Fakten und TÜV Logo -->
      <div class="flex flex-col justify-center items-end w-1/3">
        <!-- Fakten Liste -->
        <div class="space-y-8 mb-12">
          <div class="flex items-center text-5xl text-white fade-in" id="fakt1">
            <div class="w-4 h-4 bg-sky-400 rounded-full mr-8"></div>
            <span>Gründung 1970, Deutschland</span>
          </div>
          <div class="flex items-center text-5xl text-white fade-in" id="fakt2">
            <div class="w-4 h-4 bg-sky-400 rounded-full mr-8"></div>
            <span>Seit 1992 in Österreich</span>
          </div>
          <div class="flex items-center text-5xl text-white fade-in" id="fakt3">
            <div class="w-4 h-4 bg-sky-400 rounded-full mr-8"></div>
            <span>&gt; 5.800 Berater</span>
          </div>
          <div class="flex items-center text-5xl text-white fade-in" id="fakt4">
            <div class="w-4 h-4 bg-sky-400 rounded-full mr-8"></div>
            <span>&gt; 4.500.000 Kunden</span>
          </div>
          <div class="flex items-center text-5xl text-white fade-in" id="fakt5">
            <div class="w-4 h-4 bg-sky-400 rounded-full mr-8"></div>
            <span>&gt; 100 Produktpartner</span>
          </div>
          <div class="flex items-center text-5xl text-white fade-in" id="fakt6">
            <div class="w-4 h-4 bg-sky-400 rounded-full mr-8"></div>
            <span>16 europäische Länder</span>
          </div>
          <div class="flex items-center text-5xl text-white fade-in" id="fakt7">
            <div class="w-4 h-4 bg-sky-400 rounded-full mr-8"></div>
            <span>Seit 2006 TÜV-zertifiziert</span>
          </div>
        </div>
        
        <!-- TÜV Logo -->
        <div class="flex justify-end fade-in" id="tuvLogo">
          <img src="AnalyseBilder/tuv.png" alt="TÜV Zertifikat" class="h-40 object-contain">
        </div>
      </div>

      <!-- Rechte Seite: Große Länderkarte -->
      <div class="flex justify-center items-center w-2/3 fade-in" id="laenderkarte">
        <img src="AnalyseBilder/Länderkarte.png" alt="OVB Länder Europa" class="h-[60vh] w-auto object-contain">
      </div>
      </div>
    </div>
  </section>

  <!-- ====================================== -->
  <!-- // Folie 5 – Arzt vs Finanzexperte -->
  <!-- ====================================== -->
  <section id="folie5" class="slide flex flex-col items-center justify-center px-4 cursor-pointer content-container" onclick="nextStep()">
    <h1 class="text-6xl md:text-7xl font-bold mb-16 text-center text-white">System mit Erfolg</h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 w-full max-w-7xl items-start">
      
      <!-- Arzt -->
      <div class="flex flex-col items-center">
        <!-- rheumatology-animate.svg eingebettet -->
        <div class="w-96 h-96 mb-10 fade-in" id="imgArzt">
          <img src="AnalyseBilder/rheumatology-animate.svg" alt="Rheumatology Animation" class="w-full h-full object-contain">
        </div>

        <h3 class="text-4xl md:text-5xl lg:text-6xl font-semibold mb-8 text-sky-300 fade-in" id="titleArzt">Arzt</h3>
        <div class="flex flex-col items-center space-y-6">
          <div class="fade-in" id="a1">
            <div class="bg-sky-700 px-10 py-6 rounded-xl text-center text-4xl font-medium min-w-[280px]">Untersuchung</div>
          </div>
          <div class="fade-in" id="arrow1">
            <svg class="w-10 h-16 text-sky-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V16a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
            </svg>
          </div>
          <div class="fade-in" id="a2">
            <div class="bg-sky-600 px-10 py-6 rounded-xl text-center text-4xl font-medium min-w-[280px]">Diagnose</div>
          </div>
          <div class="fade-in" id="arrow2">
            <svg class="w-10 h-16 text-sky-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V16a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
            </svg>
          </div>
          <div class="fade-in" id="a3">
            <div class="bg-sky-500 px-10 py-6 rounded-xl text-center text-4xl font-medium min-w-[280px]">Rezept</div>
          </div>
          <div class="fade-in" id="arrow3">
            <svg class="w-10 h-16 text-sky-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V16a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
            </svg>
          </div>
          <div class="fade-in" id="a4">
            <div class="bg-sky-400 px-10 py-6 rounded-xl text-center text-4xl font-semibold text-sky-900 min-w-[280px]">Anwendung</div>
          </div>
        </div>
      </div>

      <!-- Finanzexperte -->
      <div class="flex flex-col items-center">
        <!-- finance-app-animate.svg eingebettet -->
        <div class="w-96 h-96 mb-10 fade-in" id="imgFin">
          <img src="AnalyseBilder/finance-app-animate.svg" alt="Finance App Animation" class="w-full h-full object-contain">
        </div>
        
        <h3 class="text-4xl md:text-5xl lg:text-6xl font-semibold mb-8 text-sky-300 fade-in" id="titleFin">Finanzexperte</h3>
        <div class="flex flex-col items-center space-y-6">
          <div class="fade-in" id="f1">
            <div class="bg-emerald-700 px-10 py-6 rounded-xl text-center text-4xl font-medium min-w-[280px]">Aktuelle Datenerfassung</div>
          </div>
          <div class="fade-in" id="arrow4">
            <svg class="w-10 h-16 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V16a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
            </svg>
          </div>
          <div class="fade-in" id="f2">
            <div class="bg-emerald-600 px-10 py-6 rounded-xl text-center text-4xl font-medium min-w-[280px]">Auswertung</div>
          </div>
          <div class="fade-in" id="arrow5">
            <svg class="w-10 h-16 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V16a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
            </svg>
          </div>
          <div class="fade-in" id="f3">
            <div class="bg-emerald-500 px-10 py-6 rounded-xl text-center text-4xl font-medium min-w-[280px]">Konzept</div>
          </div>
          <div class="fade-in" id="arrow6">
            <svg class="w-10 h-16 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L11 6.414V16a1 1 0 11-2 0V6.414L7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
            </svg>
          </div>
          <div class="fade-in" id="f4">
            <div class="bg-emerald-400 px-10 py-6 rounded-xl text-center text-4xl font-semibold text-emerald-900 min-w-[280px]">Nutzen</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Text entfernt gemäß Anfrage -->
  </section>

  <!-- ====================================== -->
  <!-- // Folie 6 – Finanzmarkt Donut -->
  <!-- ====================================== -->
  <section id="folie6" class="slide flex flex-col items-center justify-center px-4 cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift -->
    <h1 class="text-6xl md:text-7xl font-bold mb-20 text-center text-white">Finanzmarkt</h1>
    
    <!-- Donut-Diagramm Container -->
    <div class="flex items-center justify-center w-full h-full">
      <img src="AnalyseBilder/Kreis.png" alt="Donut Chart" class="w-3/4 h-3/4 object-contain" />
    </div>
  </section>

  <!-- ====================================== -->
  <!-- // Folie Banken (Folie 7) -->
  <!-- ====================================== -->
  <section id="folie7" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Banken</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-72%] top-1/2 transform -translate-y-1/2">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" />
        </div>
      </div>

      <!-- Text direkt links neben dem Kreis mit mehr Abstand -->
      <div class="flex flex-col justify-center items-start mr-8" style="width: 30vw; margin-left: calc(-5vw + 4px);">
        <h2 class="text-8xl font-bold text-sky-300 mb-6 always-visible">ca. 500 Banken</h2>
        <p class="text-4xl text-sky-300 mb-12 always-visible">~40% seit 2012</p>
        <ul class="space-y-6">
          <li class="flex items-center text-6xl text-sky-300 fade-in" id="bankPunkt1">
            <span class="text-red-500 text-6xl mr-6">✗</span> Ansprechpartner
          </li>
          <li class="flex items-center text-6xl text-sky-300 fade-in" id="bankPunkt2">
            <span class="text-red-500 text-6xl mr-6">✗</span> Hohe Gebühren
          </li>
          <li class="flex items-center text-6xl text-sky-300 fade-in" id="bankPunkt3">
            <span class="text-red-500 text-6xl mr-6">✗</span> Niedrige Zinsen
          </li>
        </ul>
      </div>

      <!-- Bank SVG Animation - noch größer -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/Bank.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;">
          <img src="AnalyseBilder/Bank.svg" alt="Bank Animation" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- ====================================== -->
  <!-- // Folie Versicherungen (Folie 8) -->
  <!-- ====================================== -->
  <section id="folie8" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Versicherungen</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild - wird animiert gedreht -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2" id="versicherungKreis">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(0deg); transition: transform 3s ease-in-out;" />
        </div>
      </div>

      <!-- Text direkt links neben dem Kreis mit mehr Abstand -->
      <div class="flex flex-col justify-center items-start mr-8" style="width: 30vw; margin-left: calc(-5vw + 4px);">
        <h2 class="text-8xl font-bold text-sky-300 mb-8 always-visible">ca. 100 Versicherungen</h2>
        
        <div class="space-y-8">
          <div class="flex items-start space-x-6 fade-in" id="versicherungPunkt1">
            <span class="text-red-500 text-5xl mt-1 flex-shrink-0">✗</span>
            <div>
              <p class="text-5xl font-semibold text-sky-300 mb-2">Vertreter</p>
              <p class="text-3xl text-sky-300 leading-relaxed">handelt im Auftrag eines<br>Versicherungsunternehmens<br>(z.B. Uniqa, Allianz, ...)</p>
            </div>
          </div>
          
          <div class="flex items-start space-x-6 fade-in" id="versicherungPunkt2">
            <span class="text-green-500 text-5xl mt-1 flex-shrink-0">✓</span>
            <div>
              <p class="text-5xl font-semibold text-sky-300 mb-2">Mehrfachagent</p>
              <p class="text-3xl text-sky-300 leading-relaxed">vergleicht zw. beliebig vielen<br>Gesellschaften und sucht das<br>beste Angebot für den Kunden</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Versicherungen SVG Animation - noch größer -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/versicherungen.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;">
          <img src="AnalyseBilder/versicherungen.svg" alt="Versicherungen Animation" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 9: Bausparkassen -->
  <section id="folie9" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Bausparkassen</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild - wird animiert gedreht -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-72%] top-1/2 transform -translate-y-1/2" id="bausparkassenKreis">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-60deg); transition: transform 3s ease-in-out;" />
        </div>
      </div>

      <!-- Text direkt links neben dem Kreis mit mehr Abstand -->
      <div class="flex flex-col justify-center items-start mr-8" style="width: 30vw; margin-left: calc(-5vw + 4px);">
        <h2 class="text-8xl font-bold text-sky-300 mb-8 always-visible">4 Bausparkassen</h2>
        
        <div class="space-y-6">
          <div class="flex items-start space-x-6 fade-in" id="bausparkassenPunkt1">
            <span class="text-green-500 text-4xl mt-1 flex-shrink-0">✓</span>
            <p class="text-5xl text-sky-300 font-medium">staatl. Zuschüsse</p>
          </div>
          
          <div class="flex items-start space-x-6 fade-in" id="bausparkassenPunkt2">
            <span class="text-red-500 text-5xl mt-1 flex-shrink-0">✗</span>
            <p class="text-5xl text-sky-300 font-medium">Niedrige Zinsen</p>
          </div>
          
          <div class="flex items-start space-x-6 fade-in" id="bausparkassenPunkt3">
            <span class="text-red-500 text-5xl mt-1 flex-shrink-0">✗</span>
            <p class="text-5xl text-sky-300 font-medium">Geringe Flexibilität</p>
          </div>
          
          <div class="flex items-start space-x-6 fade-in" id="bausparkassenPunkt4">
            <span class="text-red-500 text-5xl mt-1 flex-shrink-0">✗</span>
            <p class="text-5xl text-sky-300 font-medium">Vorzeitige Kündigung</p>
          </div>
        </div>
      </div>

      <!-- Bausparkassen SVG Animation -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/sparkasse.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;">
          <img src="AnalyseBilder/sparkasse.svg" alt="Bausparkassen Animation" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 10: Investment -->
  <section id="folie10" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Investment</h1>
    </div>
    
    <!-- Kreis ganz links -->
    <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh; transform: translate(-60px, 70px);">
      <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2" id="investmentKreis">
        <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-120deg); transition: transform 3s ease-in-out;" />
      </div>
    </div>

    <!-- Text direkt links neben dem Kreis mit mehr Abstand -->
    <div class="flex flex-col justify-center items-start mr-8" style="width: 70vw; margin-left: calc(-5vw + 4px);">
      <div class="w-full flex items-center justify-center space-x-8">
        
        <!-- Aktien Spalte -->
        <div class="flex-1 flex flex-col items-center justify-between text-center bg-gray-800 bg-opacity-30 backdrop-blur-sm rounded-xl p-8" style="height: 60vh;">
          <h2 class="text-7xl font-bold text-white fade-in" id="aktienTitle">Aktien</h2>
          
          <!-- Aktien Icons -->
          <div class="flex flex-col items-center" style="gap: 27px;">
            <!-- Kerzenchart PNG -->
            <div class="fade-in" id="aktienChart">
              <img src="AnalyseBilder/kerzenchart.png" alt="Kerzenchart" class="w-37 h-37 object-contain" />
            </div>
            
            <!-- Haus PNG -->
            <div class="fade-in" id="aktienBuilding">
              <img src="AnalyseBilder/haus.png" alt="Haus" class="w-37 h-37 object-contain" />
            </div>
          </div>
          
          <div class="flex flex-col items-center space-y-4">
            <div class="text-8xl font-bold text-emerald-400 fade-in" id="aktienPercent">10%</div>
            
            <div class="text-center space-y-3">
              <div class="flex items-center justify-center text-3xl text-emerald-400 fade-in" id="aktienPro">
                <span class="text-4xl mr-3">+</span> hohe Rendite
              </div>
              <div class="flex items-center justify-center text-3xl text-red-400 fade-in" id="aktienCon">
                <span class="text-4xl mr-3">−</span> hohes Risiko
              </div>
            </div>
          </div>
        </div>
        
        <!-- Trennlinie -->
        <div class="w-1 h-96 bg-white opacity-30"></div>
        
        <!-- Anleihen Spalte -->
        <div class="flex-1 flex flex-col items-center justify-between text-center bg-gray-800 bg-opacity-30 backdrop-blur-sm rounded-xl p-8" style="height: 60vh;">
          <h2 class="text-7xl font-bold text-white fade-in" id="anleihenTitle">Anleihen</h2>
          
          <!-- Anleihen Icons -->
          <div class="flex flex-col items-center" style="gap: 19px;">
            <!-- Geldsack PNG -->
            <div class="flex justify-center fade-in" id="anleihenMoney">
              <img src="AnalyseBilder/geldsack.png" alt="Geldsack" class="w-37 h-37 object-contain" />
            </div>
            
            <div class="text-4xl font-bold text-yellow-400 fade-in" id="anleihenAmount">1.000.000 EUR</div>
            
            <!-- Hand PNG -->
            <div class="flex justify-center fade-in" id="anleihenBills">
              <img src="AnalyseBilder/hand.png" alt="Hand" class="w-37 h-37 object-contain" />
            </div>
          </div>
          
          <div class="flex flex-col items-center space-y-4">
            <div class="text-8xl font-bold text-yellow-400 fade-in" id="anleihenPercent">2%</div>
            
            <div class="text-center space-y-3">
              <div class="flex items-center justify-center text-3xl text-red-400 fade-in" id="anleihenCon">
                <span class="text-4xl mr-3">−</span> geringe Rendite
              </div>
              <div class="flex items-center justify-center text-3xl text-emerald-400 fade-in" id="anleihenPro">
                <span class="text-4xl mr-3">+</span> geringes Risiko
              </div>
            </div>
          </div>
        </div>
        
        <!-- Trennlinie -->
        <div class="w-1 h-96 bg-white opacity-30"></div>
        
        <!-- Fonds Spalte -->
        <div class="flex-1 flex flex-col items-center justify-between text-center bg-gray-800 bg-opacity-30 backdrop-blur-sm rounded-xl p-8" style="height: 60vh;">
          <h2 class="text-7xl font-bold text-white fade-in" id="fondsTitle">Fonds</h2>
          
          <!-- Fonds Icons -->
          <div class="flex flex-col items-center" style="gap: 27px;">
            <!-- Fonds PNG -->
            <div class="fade-in" id="fondsPie">
              <img src="AnalyseBilder/fonds.png" alt="Fonds" class="w-37 h-37 object-contain" />
            </div>
            
            <!-- Manager PNG -->
            <div class="fade-in" id="fondsManager">
              <img src="AnalyseBilder/manager.png" alt="Manager" class="w-37 h-37 object-contain" />
            </div>
          </div>
          
          <div class="flex flex-col items-center space-y-4">
            <div class="text-8xl font-bold text-purple-400 fade-in" id="fondsPercent">7-8%</div>
            
            <div class="text-center space-y-3">
              <div class="flex items-center justify-center text-3xl text-emerald-400 fade-in" id="fondsPro1">
                <span class="text-4xl mr-3">+</span> höhere Rendite
              </div>
              <div class="flex items-center justify-center text-3xl text-emerald-400 fade-in" id="fondsPro2">
                <span class="text-4xl mr-3">+</span> geringeres Risiko
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </section>

  <!-- Folie 11: Immobilien Hauptseite -->
  <section id="folie11" class="slide content-container">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Immobilien</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2" id="immobilienKreis">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-240deg); transition: transform 3s ease-in-out;" />
        </div>
      </div>

      <!-- Vergleichstabelle -->
      <div class="flex justify-center items-center space-x-4" style="width: 45vw; margin-left: -4vw;">
        
        <!-- Linke Spalte: Privat -->
        <div class="bg-white text-gray-800 rounded-3xl p-6 shadow-2xl flex-1 max-w-sm min-h-[600px]">
          <h2 class="text-4xl font-bold text-center mb-8 text-blue-900">Privat</h2>
          
          <div class="space-y-6">
            <div class="text-center">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3">Keinen Marktüberblick</h3>
              <div class="flex justify-center mb-4">
                <svg class="w-12 h-12 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 3L6 9h8l-4-6z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
                </svg>
              </div>
            </div>
            
            <div class="text-center">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3">Sehr zeitaufwändig</h3>
              <div class="flex justify-center mb-4">
                <svg class="w-12 h-12 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 3L6 9h8l-4-6z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
                </svg>
              </div>
            </div>
            
            <div class="text-center">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3">unterschätztes Risiko</h3>
              <div class="flex justify-center mb-4">
                <svg class="w-12 h-12 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 3L6 9h8l-4-6z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
                </svg>
              </div>
            </div>
            
            <div class="text-center mb-6">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3">Fehlende professionelle Bewertung</h3>
            </div>
          </div>
          
          <button onclick="navigateToBuy()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold text-2xl py-4 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-105">
            Ich <u>suche eine</u><br>Immobilie
          </button>
        </div>

        <!-- Mittellinie -->
        <div class="w-1 h-96 bg-gradient-to-b from-red-500 to-blue-500 mx-6"></div>

        <!-- Rechte Spalte: Mit OVB als Profi -->
        <div class="bg-white text-gray-800 rounded-3xl p-6 shadow-2xl flex-1 max-w-sm min-h-[600px]">
          <h2 class="text-4xl font-bold text-center mb-8 text-blue-900">Mit uns als Profi</h2>
          
          <div class="space-y-6">
            <div class="text-center">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3"><u>Professionelle Beratung</u></h3>
              <div class="flex justify-center mb-4">
                <svg class="w-12 h-12 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 3L6 9h8l-4-6z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
                </svg>
              </div>
            </div>
            
            <div class="text-center">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3">Zeitersparnis</h3>
              <div class="flex justify-center mb-4">
                <svg class="w-12 h-12 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 3L6 9h8l-4-6z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
                </svg>
              </div>
            </div>
            
            <div class="text-center">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3">Sichere Abwicklung</h3>
              <div class="flex justify-center mb-4">
                <svg class="w-12 h-12 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 3L6 9h8l-4-6z" clip-rule="evenodd" transform="rotate(180 10 10)"></path>
                </svg>
              </div>
            </div>
            
            <div class="text-center mb-6">
              <h3 class="text-2xl font-semibold text-blue-800 mb-3">Besserer Preis der Immobilie</h3>
            </div>
          </div>
          
          <button onclick="navigateToSell()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold text-2xl py-4 rounded-2xl shadow-lg transition-all duration-300 transform hover:scale-105">
            Ich <u>verkaufe eine</u><br>Immobilie
          </button>
        </div>
      </div>

      <!-- Immobilien SVG rechts daneben -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/immobilien.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 1200px; max-height: 95vh;">
          <img src="AnalyseBilder/immobilien.svg" alt="Immobilien Animation" class="w-full h-auto" style="max-width: 1200px; max-height: 95vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 12: Immobilie verkaufen -->
  <section id="folie12" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Immobilie verkaufen</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild - wird animiert gedreht -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-240deg);" />
        </div>
      </div>

      <!-- Content für Verkaufen -->
      <div class="flex flex-col justify-start items-start" style="width: 50vw; margin-left: -8vw;">
        <div class="grid grid-cols-2 gap-12 max-w-6xl">
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-chart-line text-7xl text-green-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Marktbewertung</h3>
            <p class="text-xl">Professionelle Bewertung Ihrer Immobilie zum aktuellen Marktpreis</p>
          </div>
          
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-users text-7xl text-blue-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Käufersuche</h3>
            <p class="text-xl">Gezieltes Marketing und Käuferakquise über unser Netzwerk</p>
          </div>
          
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-file-contract text-7xl text-yellow-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Vertragsabwicklung</h3>
            <p class="text-xl">Sichere und professionelle Abwicklung des Verkaufsprozesses</p>
          </div>
          
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-piggy-bank text-7xl text-purple-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Steueroptimierung</h3>
            <p class="text-xl">Optimale steuerliche Gestaltung Ihres Immobilienverkaufs</p>
          </div>
        </div>
      </div>

      <!-- Immobilien SVG rechts daneben -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/immobilien.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;">
          <img src="AnalyseBilder/immobilien.svg" alt="Immobilien Animation" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 13: Immobilie kaufen -->
  <section id="folie13" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Immobilie kaufen</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild - wird animiert gedreht -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-240deg);" />
        </div>
      </div>

      <!-- Content für Kaufen -->
      <div class="flex flex-col justify-start items-start" style="width: 50vw; margin-left: -8vw;">
        <div class="grid grid-cols-2 gap-12 max-w-6xl">
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-search text-7xl text-green-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Objektsuche</h3>
            <p class="text-xl">Maßgeschneiderte Suche nach Ihrer perfekten Immobilie</p>
          </div>
          
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-calculator text-7xl text-blue-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Finanzierung</h3>
            <p class="text-xl">Optimale Finanzierungslösungen für Ihren Immobilienkauf</p>
          </div>
          
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-clipboard-check text-7xl text-yellow-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Objektprüfung</h3>
            <p class="text-xl">Professionelle Bewertung und Zustandsprüfung der Immobilie</p>
          </div>
          
          <div class="bg-sky-800 bg-opacity-50 p-9 rounded-xl">
            <i class="fas fa-handshake text-7xl text-purple-400 mb-6"></i>
            <h3 class="text-3xl font-bold mb-4">Kaufabwicklung</h3>
            <p class="text-xl">Sicherer Kaufprozess von der Besichtigung bis zur Übergabe</p>
          </div>
        </div>
      </div>

      <!-- Immobilien SVG rechts daneben -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/immobilien.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;">
          <img src="AnalyseBilder/immobilien.svg" alt="Immobilien Animation" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 14: Tippgeber -->
  <section id="folie14" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Tippgeber</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-240deg);" />
        </div>
      </div>

      <!-- Content für Tippgeber -->
      <div class="flex flex-col justify-center items-center" style="width: 50vw; margin-left: -8vw;">
        <div class="bg-gradient-to-r from-yellow-500 to-orange-500 p-16 rounded-3xl shadow-2xl max-w-6xl text-center">
          <i class="fas fa-gift text-8xl text-white mb-12"></i>
          
          <h3 class="text-5xl font-bold text-white mb-12">Jetzt bis zu 7.000€ Tippgeberprovision erhalten!</h3>
          
          <div class="grid grid-cols-3 gap-12 text-white mb-12">
            <div class="text-center">
              <i class="fas fa-euro-sign text-6xl mb-6"></i>
              <h4 class="text-3xl font-bold mb-4">Provision</h4>
              <p class="text-lg">Attraktive Vergütung für jeden erfolgreichen Tipp</p>
            </div>
            
            <div class="text-center">
              <i class="fas fa-network-wired text-6xl mb-6"></i>
              <h4 class="text-3xl font-bold mb-4">Netzwerk</h4>
              <p class="text-lg">Erweitern Sie Ihr persönliches Netzwerk</p>
            </div>
            
            <div class="text-center">
              <i class="fas fa-trophy text-6xl mb-6"></i>
              <h4 class="text-3xl font-bold mb-4">Erfolg</h4>
              <p class="text-lg">Helfen Sie anderen bei ihren Immobilienzielen</p>
            </div>
          </div>
          
          <div class="text-3xl font-semibold text-white text-center">
            Sprechen Sie uns an – wir erklären Ihnen gerne die Details!
          </div>
        </div>
      </div>

      <!-- Immobilien SVG rechts daneben -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/immobilien.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 1200px; max-height: 95vh;">
          <img src="AnalyseBilder/immobilien.svg" alt="Immobilien Animation" class="w-full h-auto" style="max-width: 1200px; max-height: 95vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 15: Immobilienfinanzierung Vergleich -->
  <section id="folie15" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Immobilienfinanzierung</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild - wird animiert gedreht -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-240deg);" />
        </div>
      </div>

      <!-- Vergleichstabelle -->
      <div class="flex flex-col justify-center items-center" style="width: 50vw; margin-left: -8vw;">
        
        <!-- Grafik mit Bank/Kunde/Berater oben -->
        <div class="mb-8 text-center">
          <div class="flex items-center justify-center mb-6">
            <!-- Linke Grafik -->
            <div class="fade-in" id="finanzierungLinks">
              <img src="AnalyseBilder/finanzierunglinks.png" alt="Finanzierung Links" class="h-64 object-contain rounded-l-2xl" />
            </div>
            
            <!-- Rechte Grafik -->
            <div class="fade-in" id="finanzierungRechts">
              <img src="AnalyseBilder/finanzierungrechts.png" alt="Finanzierung Rechts" class="h-64 object-contain rounded-r-2xl" />
            </div>
          </div>
          
          <!-- Schwarzer Pfeil -->
          <div class="fade-in mb-8" id="finanzierungPfeil">
            <svg class="w-24 h-24 mx-auto text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L2 12h6v10h8V12h6L12 2z" transform="rotate(225 12 12)"/>
            </svg>
          </div>
        </div>

        <!-- Vergleichstabelle Bank vs OVB -->
        <div class="bg-white rounded-3xl p-12 shadow-2xl w-full max-w-6xl fade-in" id="finanzierungTabelle">
          <div class="grid grid-cols-2 gap-16">
            
            <!-- Bank Spalte -->
            <div class="text-center fade-in" id="bankSpalte">
              <h2 class="text-5xl font-bold text-blue-900 mb-8">Bank</h2>
              
              <div class="space-y-6">
                <div class="text-4xl font-bold text-red-600">300.000,00 €</div>
                <div class="text-3xl font-semibold text-red-600">4% Zinsen</div>
                <div class="text-3xl font-semibold text-red-600">30 Jahre</div>
                <div class="border-t-4 border-red-500 pt-6 mt-8">
                  <div class="text-4xl font-bold text-red-600">511.165,88 €</div>
                </div>
              </div>
            </div>

            <!-- Vertikale Trennlinie -->
            <div class="border-l-4 border-purple-500 relative">
              <!-- OVB Spalte -->
              <div class="text-center pl-8 fade-in" id="ovbSpalte">
                <h2 class="text-5xl font-bold text-blue-900 mb-8">Mit uns</h2>
                
                <div class="space-y-6">
                  <div class="text-4xl font-bold text-blue-600">300.000,00 €</div>
                  <div class="text-3xl font-semibold text-blue-600">3% Zinsen</div>
                  <div class="text-3xl font-semibold text-blue-600">30 Jahre</div>
                  <div class="border-t-4 border-blue-500 pt-6 mt-8">
                    <div class="text-4xl font-bold text-blue-600">452.978,13 €</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Ersparnis unten -->
          <div class="text-center border-t-4 border-gray-300 pt-8 mt-12 fade-in" id="ersparnis">
            <div class="text-6xl font-bold text-green-600 mb-3">58.187,75 €</div>
            <div class="text-4xl font-bold text-green-600">Ersparnis</div>
          </div>
        </div>
      </div>

      <!-- Immobilien SVG rechts daneben -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/immobilien.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 1200px; max-height: 95vh;">
          <img src="AnalyseBilder/immobilien.svg" alt="Immobilien Animation" class="w-full h-auto" style="max-width: 1200px; max-height: 95vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 16: Steuern -->
  <section id="folie16" class="slide cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift ganz oben -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">Strom & Gas</h1>
    </div>
    
    <div class="relative w-full h-full flex items-center justify-center pt-32">
      <!-- Kreis mit rechter Hälfte im Bild - wird animiert gedreht -->
      <div class="flex-shrink-0 relative" style="width: 30vw; height: 100vh;">
        <div class="absolute left-[-68%] top-1/2 transform -translate-y-1/2" id="steuernKreis">
          <img src="AnalyseBilder/Kreis.png" alt="Kreis" class="w-[70vh] h-[70vh] object-contain" style="transform: rotate(-240deg); transition: transform 3s ease-in-out;" />
        </div>
      </div>

      <!-- Content für Steuern -->
      <div class="flex flex-col justify-start items-start" style="width: 50vw; margin-left: -8vw;">
        
        <!-- Staat Sektion -->
        <div class="mb-12 fade-in" id="staatSektion">
          <div class="flex items-start space-x-6">
            <div class="text-6xl text-red-500 mt-2">✗</div>
            <div>
              <h2 class="text-5xl font-bold text-white mb-6">Hohe Energiekosten?</h2>
              <div class="flex items-center space-x-4">
                <div class="w-4 h-4 bg-blue-600 rounded-full"></div>
                <p class="text-3xl text-white">95% der Österreicher zahlen zu viel für ihre Energiekosten!</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Steuerzahler Sektion -->
        <div class="fade-in" id="steuerzahlerSektion">
          <div class="flex items-start space-x-6">
            <div class="text-6xl text-green-500 mt-2">✓</div>
            <div>
              <h2 class="text-5xl font-bold text-white mb-6">Mit uns als Energiekostenmakler</h2>
              <div class="space-y-4">
                <div class="flex items-center space-x-4">
                  <div class="w-4 h-4 bg-blue-600 rounded-full"></div>
                  <p class="text-3xl text-white">Vergleichen Sie Anbieter und sparen Sie Geld</p>
                </div>
                <div class="flex items-center space-x-4">
                  <div class="w-4 h-4 bg-blue-600 rounded-full"></div>
                  <p class="text-3xl text-white">Unkompliziert & Kostenlos</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Steuern SVG rechts daneben -->
      <div class="flex-shrink-0 flex items-center justify-center flex-1">
        <object data="AnalyseBilder/steuern.svg" type="image/svg+xml" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;">
          <img src="AnalyseBilder/steuern.svg" alt="Steuern Animation" class="w-full h-auto" style="max-width: 800px; max-height: 90vh;" />
        </object>
      </div>
    </div>
  </section>

  <!-- Folie 17: Finanzmarkt Donut mit OVB-Vorteilen -->
  <section id="folie17" class="slide flex flex-col items-center justify-center px-4 cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift -->
    <h1 class="text-6xl md:text-7xl font-bold mb-20 text-center text-white">Finanzmarkt</h1>
    
    <!-- Donut-Diagramm Container -->
    <div class="flex items-center justify-center w-full h-full relative">
      <!-- Donut Chart in der Mitte - Um 30% vergrößert -->
      <div class="relative">
        <img src="AnalyseBilder/Kreis.png" alt="Donut Chart" class="w-[62rem] h-[62rem] object-contain" id="finanzmarkt-donut-ovb" />
      </div>
      
      <!-- 4 Eckpunkte - Zentral in jedem Quadranten positioniert - Um 30% vergrößert -->
      <!-- Oben links: 0 € Kosten - Zentrum des oberen linken Quadranten -->
      <div class="absolute top-1/4 left-1/4 transform -translate-x-1/2 -translate-y-1/2 text-center fade-in bg-white/20 backdrop-blur-md rounded-xl p-8 border border-white/30 shadow-2xl" id="corner1">
        <h2 class="text-8xl font-bold text-yellow-400 mb-4">0€</h2>
        <h3 class="text-3xl font-bold text-white mb-3">Kosten</h3>
        <p class="text-xl text-blue-200">Keine versteckten Gebühren</p>
      </div>
      
      <!-- Oben rechts: 100% Transparenz - Zentrum des oberen rechten Quadranten -->
      <div class="absolute top-1/4 right-1/4 transform translate-x-1/2 -translate-y-1/2 text-center fade-in bg-white/20 backdrop-blur-md rounded-xl p-8 border border-white/30 shadow-2xl" id="corner2">
        <h2 class="text-8xl font-bold text-green-400 mb-4">100%</h2>
        <h3 class="text-3xl font-bold text-white mb-3">Transparenz</h3>
        <p class="text-xl text-blue-200">Vollständige Offenlegung</p>
      </div>
      
      <!-- Unten links: 100% Individuell - Zentrum des unteren linken Quadranten -->
      <div class="absolute bottom-1/4 left-1/4 transform -translate-x-1/2 translate-y-1/2 text-center fade-in bg-white/20 backdrop-blur-md rounded-xl p-8 border border-white/30 shadow-2xl" id="corner3">
        <h2 class="text-8xl font-bold text-purple-400 mb-4">100%</h2>
        <h3 class="text-3xl font-bold text-white mb-3">Individuell</h3>
        <p class="text-xl text-blue-200">Maßgeschneiderte Lösungen</p>
      </div>
      
      <!-- Unten rechts: 24/7 passend zu Ihrem finanziellen Lebensplan - Zentrum des unteren rechten Quadranten -->
      <div class="absolute bottom-1/4 right-1/4 transform translate-x-1/2 translate-y-1/2 text-center fade-in bg-white/20 backdrop-blur-md rounded-xl p-8 border border-white/30 shadow-2xl max-w-lg" id="corner4">
        <h2 class="text-7xl font-bold text-orange-400 mb-4">24/7</h2>
        <h3 class="text-2xl font-bold text-white mb-2">Passend zu Ihrem</h3>
        <h3 class="text-2xl font-bold text-white mb-3">finanziellen Lebensplan</h3>
        <p class="text-xl text-blue-200">Immer für Sie da</p>
      </div>
    </div>
  </section>

  <!-- Control Buttons (rechts unten) -->
  <div class="control-buttons">
    <!-- Fullscreen Button -->
    <button class="control-btn" onclick="toggleFullscreen()" title="Vollbild">
      <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
      </svg>
    </button>
    
    <!-- Calculator Button mit Dropdown -->
    <div class="relative">
      <button class="control-btn" onclick="toggleCalculatorDropdown()" title="Rechner">
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8-4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8-4H7V7h2v2zm4 0h-2V7h2v2zm4 0h-2V7h2v2z"/>
        </svg>
      </button>
      
      <!-- Dropdown-Menü -->
      <div id="calculatorDropdown" class="absolute bottom-full right-0 mb-2 w-80 bg-blue-800 border border-blue-600 rounded-lg shadow-lg hidden z-50">
        <div class="p-4">
          <h3 class="text-white text-lg font-bold mb-3">Rechner auswählen</h3>
          <div class="space-y-2">
            <button onclick="openCalculatorModal('pensionsluecke')" class="w-full text-left p-3 text-white hover:bg-blue-700 rounded border-b border-blue-600">
              Pensionslückenrechner
            </button>
            <button onclick="openCalculatorModal('vorsorge')" class="w-full text-left p-3 text-white hover:bg-blue-700 rounded border-b border-blue-600">
              Vorsorgerechner
            </button>
            <button onclick="openCalculatorModal('bu-luecke')" class="w-full text-left p-3 text-white hover:bg-blue-700 rounded border-b border-blue-600">
              BU-Lückenrechner
            </button>
            <button onclick="openCalculatorModal('erwerbspotential')" class="w-full text-left p-3 text-white hover:bg-blue-700 rounded border-b border-blue-600">
              Erwerbspotentialrechner
            </button>
            <button onclick="openCalculatorModal('finanzierung')" class="w-full text-left p-3 text-white hover:bg-blue-700 rounded border-b border-blue-600">
              Finanzierungsrechner
            </button>
            <button onclick="openCalculatorModal('leasing')" class="w-full text-left p-3 text-white hover:bg-blue-700 rounded border-b border-blue-600">
              Leasingrechner
            </button>
            <button onclick="openCalculatorModal('steuervorteil')" class="w-full text-left p-3 text-white hover:bg-blue-700 rounded">
              Steuervorteilrechner
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rechner Modals -->
  <div id="calculatorModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-sky-950 rounded-lg shadow-xl max-w-7xl w-full m-4 max-h-screen overflow-y-auto border border-sky-700 transform scale-150">
      <div class="flex justify-between items-center p-6 border-b border-sky-700">
        <h2 id="calculatorTitle" class="text-3xl font-bold text-white">Rechner</h2>
        <button onclick="closeCalculatorModal()" class="text-gray-300 hover:text-white text-3xl">×</button>
      </div>
      <div id="calculatorContent" class="p-6 text-white">
        <!-- Rechner Inhalt wird hier dynamisch geladen -->
      </div>
    </div>
  </div>

  <!-- Folie 18: Finanzieller Lebensplan - Komplett neu -->
  <section id="folie18" class="slide flex flex-col items-center justify-center px-4 cursor-pointer content-container" onclick="nextStep()">
    <!-- Überschrift - 20px vom oberen Bildschirmrand, horizontal zentriert -->
    <h1 class="absolute top-5 w-full text-6xl md:text-7xl font-bold text-center text-white">Finanzieller Lebensplan</h1>
    
    <!-- Großer Container für die Bilder - über dem Pfeil -->
    <div class="absolute top-20 w-full max-w-[1800px] h-[400px] flex items-center justify-center">
      <!-- Ziele Icons - nochmal doppelt so groß und viel weiter auseinander -->
      <div class="flex space-x-24">
        <div class="fade-in opacity-0" id="ziel-ausbildung">
          <img src="AnalyseBilder/ausbildung.png" alt="Ausbildung" class="w-32 h-32" />
        </div>
        <div class="fade-in opacity-0" id="ziel-auto">
          <img src="AnalyseBilder/kfz.png" alt="Auto" class="w-32 h-32" />
        </div>
        <div class="fade-in opacity-0" id="ziel-geld">
          <img src="AnalyseBilder/geld.png" alt="Geld" class="w-32 h-32" />
        </div>
        <div class="fade-in opacity-0" id="ziel-immobilie">
          <img src="AnalyseBilder/immo.png" alt="Immobilie" class="w-32 h-32" />
        </div>
        <div class="fade-in opacity-0" id="ziel-reisen">
          <img src="AnalyseBilder/flugzeug.png" alt="Reisen" class="w-32 h-32" />
        </div>
      </div>
    </div>
    
    <!-- Hauptcontainer für den Pfeil - darunter -->
    <div class="relative w-full max-w-6xl h-[600px] flex items-center justify-center" style="margin-top: 250px;">

      <!-- Zentraler großer weißer Pfeil -->
      <div class="relative">
        <!-- Riesiger weißer Pfeil - Pfeilspitze dicker als Schaft -->
        <div class="fade-in opacity-0" id="pfeil-outline">
          <svg viewBox="0 0 1000 1000" class="w-[1200px] h-[1000px]">
            <!-- Massiver Pfeil mit dicker Spitze nach oben in weiß -->
            <polygon points="500,40 750,240 650,240 650,960 350,960 350,240 250,240" 
                     fill="white" stroke="white" stroke-width="4"/>
          </svg>
        </div>
        
        <!-- Schlangenlinie im Pfeil - genauso lang wie der Pfeil -->
        <div class="absolute top-0 bottom-0 left-0 right-0 flex items-center justify-center fade-in opacity-0" id="schlangenlinie">
          <img src="AnalyseBilder/schlangenlinie.png" alt="Schlangenlinie" class="w-80 h-full object-fill" />
        </div>

        <!-- Risiko Labels - INNERHALB des Pfeil-Containers, direkt an der Schlangenlinie -->
        <div class="absolute left-1 top-1/4 fade-in opacity-0 z-20" id="risiko-unvorhergesehenes">
          <div class="text-blue-300 text-5xl font-bold text-center">
            <div>Unvorher-</div>
            <div>gesehenes</div>
          </div>
        </div>
        <div class="absolute left-1 bottom-1/4 fade-in opacity-0 z-20" id="risiko-ams">
          <div class="text-blue-300 text-5xl font-bold">AMS</div>
        </div>
        <div class="absolute right-1 top-1/4 fade-in opacity-0 z-20" id="risiko-unfall">
          <div class="text-blue-300 text-5xl font-bold">Unfall</div>
        </div>
        <div class="absolute right-1 bottom-1/4 fade-in opacity-0 z-20" id="risiko-krankheit">
          <div class="text-blue-300 text-5xl font-bold">Krankheit</div>
        </div>
      </div>

    <!-- SPAREN - perfekt vertikal zentriert -->
    <div class="absolute left-[-200px] top-1/2 fade-in opacity-0" id="sparen-box" style="transform: translateY(-50%);">
      <div class="bg-yellow-500 text-blue-900 px-6 py-72 text-5xl font-bold rounded-lg flex items-center justify-center">
        <div class="transform -rotate-90 whitespace-nowrap">SPAREN</div>
      </div>
    </div>

    <!-- Vorteile - weiter rechts und 20% kleiner -->
    <div class="absolute right-[-100px] top-1/2 transform -translate-y-1/2 space-y-10">
      <div class="flex items-center fade-in opacity-0" id="vorteil-sicherer">
        <span class="text-green-400 text-6xl mr-6">✓</span>
        <span class="text-green-400 text-5xl font-bold">sicherer</span>
      </div>
      <div class="flex items-center fade-in opacity-0" id="vorteil-schneller">
        <span class="text-green-400 text-6xl mr-6">✓</span>
        <span class="text-green-400 text-5xl font-bold">schneller</span>
      </div>
      <div class="flex items-center fade-in opacity-0" id="vorteil-guenstiger">
        <span class="text-green-400 text-6xl mr-6">✓</span>
        <span class="text-green-400 text-5xl font-bold">günstiger</span>
      </div>
    </div>
    </div>

    <!-- ZIELE Box - perfekt mittig und genauso groß wie FINANZIELLE SITUATION -->
    <div class="absolute top-[390px] w-full flex justify-center fade-in opacity-0 z-50" id="ziele-box">
      <div class="bg-blue-700 text-white px-12 py-4 text-2xl font-bold rounded">FINANZIELLE ZIELE</div>
    </div>

    <!-- FINANZIELLE SITUATION Box - doppelt so groß -->
    <div class="absolute bottom-20 w-full flex justify-center fade-in opacity-0" id="situation-box">
      <div class="bg-blue-700 text-white px-12 py-4 text-2xl font-bold rounded">FINANZIELLE SITUATION</div>
    </div>
  </section>

  <!-- ====================================== -->
  <!-- Slide 19: A-B-S Konzept -->
  <!-- ====================================== -->
  <section class="slide hidden cursor-pointer content-container text-white" id="folie19" onclick="nextStep()">
    
    <!-- Überschrift -->
    <div class="absolute top-24 left-0 right-0 z-50">
      <h1 class="text-6xl md:text-7xl font-bold text-center text-white" style="opacity: 1 !important; transform: translateY(0) !important; visibility: visible !important; z-index: 1000;">A-B-S System</h1>
    </div>
    
    <!-- Grid Layout: 3 gleichmäßige Spalten über den ganzen Bildschirm -->
    <div class="grid grid-cols-3 gap-16 w-full h-full p-16 pt-32">
      
      <!-- Spalte 1: A-B-S Buchstaben - 50% größer -->
      <div class="flex flex-col justify-center items-center space-y-20">
        <!-- A-Kasten - 50% größer -->
        <div class="bg-green-600 text-white w-60 h-60 flex items-center justify-center text-9xl font-bold rounded-lg fade-in opacity-0" id="abs-a">
          A
        </div>
        
        <!-- B-Kasten - 50% größer -->
        <div class="bg-green-600 text-white w-60 h-60 flex items-center justify-center text-9xl font-bold rounded-lg fade-in opacity-0" id="abs-b" style="margin-top: 40px;">
          B
        </div>
        
        <!-- S-Kasten - 50% größer, weiter unten -->
        <div class="bg-green-600 text-white w-60 h-60 flex items-center justify-center text-9xl font-bold rounded-lg fade-in opacity-0" id="abs-s" style="margin-top: 60px;">
          S
        </div>
      </div>
      
      <!-- Spalte 2: Text und Bulletpoints - 50% größer -->
      <div class="flex flex-col justify-center space-y-20">
        <!-- A - Aktuelle Datenerfassung -->
        <div class="fade-in opacity-0" id="abs-text-a">
          <h2 class="text-6xl font-bold text-white mb-9">AKTUELLE DATENERFASSUNG</h2>
          <ul class="text-3xl text-gray-300 space-y-4">
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> Auswertung</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> Experten</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> 2-4 Tage</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> finanzielle Vorteile</li>
          </ul>
        </div>
        
        <!-- B - Beratung -->
        <div class="fade-in opacity-0" id="abs-text-b" style="margin-top: 40px;">
          <h2 class="text-6xl font-bold text-white mb-9">BERATUNG</h2>
          <ul class="text-3xl text-gray-300 space-y-4">
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> staatl. gepr. Berater</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> kostenlos</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> Konzept 80% → 100%</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> Entscheidung mit?</li>
          </ul>
        </div>
        
        <!-- S - Service -->
        <div class="fade-in opacity-0" id="abs-text-s" style="margin-top: 60px;">
          <h2 class="text-6xl font-bold text-white mb-9">SERVICE</h2>
          <ul class="text-3xl text-gray-300 space-y-4">
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> aktuelle Infos</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> laufend Kontakt</li>
            <li class="flex items-center"><span class="text-green-400 mr-6 text-3xl">■</span> finanzielle Wege</li>
          </ul>
        </div>
      </div>
      
      <!-- Spalte 3: Bilder - 20% kleiner -->
      <div class="flex flex-col justify-center items-center space-y-20">
        <!-- A.svg - 20% kleiner -->
        <div class="w-120 h-72 fade-in opacity-0" id="abs-img-a">
          <img src="AnalyseBilder/a.svg" alt="A - Datenerfassung" class="w-full h-full object-contain">
        </div>
        
        <!-- B.svg - 20% kleiner -->
        <div class="w-120 h-72 fade-in opacity-0" id="abs-img-b" style="margin-top: 40px;">
          <img src="AnalyseBilder/b.svg" alt="B - Beratung" class="w-full h-full object-contain">
        </div>
        
        <!-- C.svg - 20% kleiner -->
        <div class="w-120 h-72 fade-in opacity-0" id="abs-img-s" style="margin-top: 60px;">
          <img src="AnalyseBilder/c.svg" alt="S - Service" class="w-full h-full object-contain">
        </div>
      </div>
    </div>
  </section>

  <!-- ====================================== -->
  <!-- Slide 20: Noch ein paar Fragen -->
  <!-- ====================================== -->
  <section class="slide hidden cursor-pointer content-container text-white" id="folie20" onclick="nextStep()">
    
    <!-- Grid Layout: Fragen links, Bild rechts -->
    <div class="grid grid-cols-2 gap-16 w-full h-full p-16">
      
      <!-- Linke Spalte: Fragen und Eingabefelder -->
      <div class="flex flex-col justify-center px-8">
        
        <!-- Überschrift -->
        <h1 class="text-8xl font-bold text-white mb-12">
          Noch ein paar Fragen
        </h1>
        
        <!-- Eingabebereich -->
        <div class="space-y-8">
          
          <!-- Frage 0: Kundenname -->
          <div>
            <label for="kundenname" class="block text-2xl font-semibold text-white mb-4">
              Wie ist Ihr Name?
            </label>
            <input 
              type="text" 
              id="kundenname" 
              placeholder="Vor- und Nachname"
              onclick="event.stopPropagation()"
              class="w-full px-6 py-4 text-xl bg-white border border-gray-300 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 placeholder-gray-500"
            >
          </div>
          
          <!-- Frage 1: Beratungstermin -->
          <div>
            <label for="beratungstermin" class="block text-2xl font-semibold text-white mb-4">
              Wann möchten Sie den Beratungstermin ansetzen?
            </label>
            <input 
              type="datetime-local" 
              id="beratungstermin" 
              onclick="event.stopPropagation()"
              class="w-full px-6 py-4 text-xl bg-white border border-gray-300 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
            >
          </div>
          
          <!-- Frage 2: Wichtigste Punkte -->
          <div>
            <label for="wichtige-punkte" class="block text-2xl font-semibold text-white mb-4">
              Was sind Ihre 3 wichtigsten Punkte für das Beratungsgespräch?
            </label>
            <textarea 
              id="wichtige-punkte" 
              rows="4" 
              placeholder="Bitte beschreiben Sie die drei wichtigsten Themen..."
              onclick="event.stopPropagation()"
              class="w-full px-6 py-4 text-xl bg-white border border-gray-300 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 placeholder-gray-500 resize-none"
            ></textarea>
          </div>
          
          <!-- Frage 3: Unterlagen -->
          <div>
            <label for="unterlagen" class="block text-2xl font-semibold text-white mb-4">
              Wie bekommen wir Ihre Unterlagen?
            </label>
            <select 
              id="unterlagen" 
              onclick="event.stopPropagation()"
              class="w-full px-6 py-4 text-xl bg-white border border-gray-300 text-black rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
            >
              <option value="">Bitte wählen Sie eine Option</option>
              <option value="email">Per E-Mail</option>
              <option value="post">Per Post</option>
              <option value="termin">Bringe ich zum Termin mit</option>
              <option value="online">An Berater übergeben</option>
              <option value="abholung">Abholung vor Ort</option>
            </select>
          </div>
          
        </div>
        
      </div>
      
      <!-- Rechte Spalte: SVG-Bild -->
      <div class="flex justify-center items-center">
        <div class="w-full h-full max-w-2xl max-h-2xl flex items-center justify-center">
          <img src="AnalyseBilder/Abschluss.svg" alt="Abschluss" class="w-full h-full object-contain">
        </div>
      </div>
      
    </div>
    
  </section>

  <!-- ====================================== -->
  <!-- Slide 21: Danke für Ihr Vertrauen -->
  <!-- ====================================== -->
  <section class="slide hidden cursor-pointer content-container text-white" id="folie21" onclick="nextStep()">
    
    <!-- Grid Layout: Text links, Bild rechts -->
    <div class="grid grid-cols-2 gap-16 w-full h-full p-16">
      
      <!-- Linke Spalte: Text ohne Animation - 50% größer -->
      <div class="flex flex-col justify-center px-8">
        
        <!-- Überschrift - sofort sichtbar, 50% größer -->
        <h1 class="text-9xl md:text-10xl font-bold text-white mb-18" id="danke-title" style="opacity: 1;">
          Danke für Ihr Vertrauen
        </h1>
        
        <!-- Haupttext - sofort sichtbar, 50% größer -->
        <div class="mb-18" id="danke-text" style="opacity: 1;">
          <p class="text-3xl text-gray-300 leading-relaxed mb-12">
            Ihnen hat das Gespräch gefallen? Empfehlen Sie uns gerne weiter damit wir unsere Dienstleistung weiterhin kostenlos und ohne Werbung anbieten können.
          </p>
        </div>
        
        <!-- Footer - sofort sichtbar, 50% größer -->
        <div id="danke-footer" style="opacity: 1;">
          <p class="text-3xl text-blue-300 font-semibold">
            Ihr SKT Finance Team
          </p>
        </div>
        
      </div>
      
      <!-- Rechte Spalte: Großes Bild - sofort sichtbar und doppelt so groß -->
      <div class="flex items-center justify-center">
        <div class="w-full h-192" id="recommendation-image" style="opacity: 1;">
          <img src="AnalyseBilder/recommendation.svg" alt="Empfehlung" class="w-full h-full object-contain">
        </div>
      </div>
      
    </div>
  </section>



  <!-- ====================================== -->
  <!-- // JS Logic -->
  <!-- ====================================== -->
  <script>
    let currentSlide = 0;  // Starte bei 0 für Eingabefeld
    const totalSlides = 22; // Jetzt 22 Slides total (0-21)
    let immobilienPath = null; // 'sell', 'buy', oder null
    
    // Berater-Name Eingabe und Start
    function startAnalyse() {
      const beraterName = document.getElementById('beraterNameInput').value.trim();
      if (!beraterName) {
        alert('Bitte geben Sie Ihren Namen ein.');
        return;
      }
      
      // Speichere Berater-Name global
      window.currentBeraterName = beraterName;
      
      console.log('Starte Analyse für Berater:', beraterName);
      
      // Aktualisiere Berater-Info auf Startseite
      updateBeraterInfoOnStartpage(beraterName);
      
      // Springe zur ersten richtigen Folie
      nextSlide(1);
    }

    // Berater-Info auf Startseite aktualisieren
    function updateBeraterInfoOnStartpage(beraterName) {
      const beraterRangElement = document.getElementById('beraterRang');
      const beraterNameElement = document.getElementById('beraterNameDisplay');
      
      if (!beraterRangElement || !beraterNameElement) return;
      
      // Standard-Fallback
      beraterRangElement.textContent = 'Finanzexperte';
      beraterNameElement.textContent = beraterName;
      
      // Wenn SeaTable verfügbar ist, lade echte Daten
      if (typeof COLUMN_MAPS !== 'undefined' && typeof db !== 'undefined' && db.mitarbeiter && db.mitarbeiter.length > 0) {
        const nameKey = COLUMN_MAPS.mitarbeiter?.Name;
        const berater = nameKey 
          ? db.mitarbeiter.find(m => m && m[nameKey] && m[nameKey].toLowerCase() === beraterName.toLowerCase())
          : null;
        
        if (berater) {
          // Karrierestufe aus DB holen
          const karrierestufeLink = berater[COLUMN_MAPS.mitarbeiter.Karrierestufe];
          const karrierestufe = (Array.isArray(karrierestufeLink) && karrierestufeLink[0]) ? karrierestufeLink[0].display_value : 'Finanzexperte';
          
          beraterRangElement.textContent = karrierestufe;
          beraterNameElement.textContent = berater[nameKey];
          console.log('✅ Berater-Info auf Startseite aktualisiert:', karrierestufe, berater[nameKey]);
        }
      }
    }
    
    // Seitenwechsel
    function nextSlide(nr) {
      console.log('🔄 Wechsle zu Folie:', nr);
      const oldSlideNr = currentSlide;

      // Verstecke alle Folien komplett
      document.querySelectorAll('.slide').forEach(s => {
        s.classList.remove('active');
        s.style.display = 'none';
        s.style.opacity = '0';
        s.style.visibility = 'hidden';
      });

      // Zeige gewünschte Folie
      const targetSlide = document.getElementById('folie' + nr);
      if (targetSlide) {
        targetSlide.classList.add('active');
        targetSlide.style.display = 'flex';
        targetSlide.style.opacity = '1';
        targetSlide.style.visibility = 'visible';
        currentSlide = nr;
        updateSlideNumber();

        // Reset Animation Index für neue Folie
        resetAnimationIndex();

        // Stelle sicher, dass Überschriften sofort sichtbar sind
        const headlines = targetSlide.querySelectorAll('h1, h2');
        headlines.forEach(headline => {
          headline.style.opacity = '1';
          headline.style.transform = 'translateY(0)';
          headline.style.visibility = 'visible';
          headline.classList.remove('fade-in');
        });

        // Spezielle Aktionen für bestimmte Folien
        if (nr === 2 && window.currentBeraterName) {
          // Berater-Daten für Folie 2 laden
          console.log('🔄 Springe zu Folie 2 - lade Berater-Daten');
          setTimeout(() => {
            renderBeraterVorstellung();
          }, 100);
        } else if (nr === 6) {
          // Reset Donut Position für Folie 6
          resetFinanzmarktDonut();
        } else if (nr === 7) {
          // Morph transition to Folie 7
          morphTransitionToFolie7();
        } else if (nr === 8) {
          // Starte Kreis-Rotation für Versicherungen-Folie
          setTimeout(() => {
            rotateVersicherungKreis();
          }, 500); // Kleine Verzögerung damit die Folie erst geladen ist
        } else if (nr === 9) {
          // Starte Kreis-Rotation für Bausparkassen-Folie
          setTimeout(() => {
            rotateBausparkassenKreis();
          }, 500); // Kleine Verzögerung damit die Folie erst geladen ist
        } else if (nr === 10) {
          // Starte Kreis-Rotation für Investment-Folie
          setTimeout(() => {
            rotateInvestmentKreis();
          }, 500); // Kleine Verzögerung damit die Folie erst geladen ist
        } else if (nr === 11) {
          // Starte Kreis-Rotation für Immobilien-Folie
          setTimeout(() => {
            rotateImmobilienKreis();
          }, 500); // Kleine Verzögerung damit die Folie erst geladen ist
        } else if (nr === 16) {
          // Starte Kreis-Rotation für Steuern-Folie
          setTimeout(() => {
            rotateSteuernKreis();
          }, 500); // Kleine Verzögerung damit die Folie erst geladen ist
        }

        // Reset Kreis bei Folienwechsel
        if (oldSlideNr === 7) { // Von Folie 8 (index 7) kommend
          resetVersicherungKreis();
        } else if (oldSlideNr === 8) { // Von Folie 9 (index 8) kommend
          resetBausparkassenKreis();
        } else if (oldSlideNr === 9) { // Von Folie 10 (index 9) kommend
          resetInvestmentKreis();
        } else if (oldSlideNr === 10) { // Von Folie 11 (index 10) kommend
          resetImmobilienKreis();
        }
      } else {
        console.error('❌ Folie nicht gefunden:', 'folie' + nr);
      }
    }

    // Slide-Nummer aktualisieren
    function updateSlideNumber() {
      const slideElement = document.getElementById('slideNumber');
      if (slideElement) {
        if (currentSlide === 0) {
          slideElement.textContent = 'Eingabe';
        } else {
          slideElement.textContent = currentSlide;
        }
      }
    }

    // Einheitliche Animation für alle Folien
    const slideAnimations = {
      3: ['sktLogo', 'arrow', 'ovbLogo'],
      4: ['laenderkarte', 'fakt1', 'fakt2', 'fakt3', 'fakt4', 'fakt5', 'fakt6', 'fakt7', 'tuvLogo'],
      5: ["imgArzt","titleArzt","a1","arrow1","a2","arrow2","a3","arrow3","a4","imgFin","titleFin","f1","arrow4","f2","arrow5","f3","arrow6","f4"],
      7: ['bankPunkt1', 'bankPunkt2', 'bankPunkt3'],
      8: ['versicherungPunkt1', 'versicherungPunkt2'],
      9: ['bausparkassenPunkt1', 'bausparkassenPunkt2', 'bausparkassenPunkt3', 'bausparkassenPunkt4'],
      10: ['aktienTitle', 'aktienChart', 'aktienBuilding', 'aktienPercent', 'aktienPro', 'aktienCon', 'anleihenTitle', 'anleihenMoney', 'anleihenAmount', 'anleihenBills', 'anleihenPercent', 'anleihenCon', 'anleihenPro', 'fondsTitle', 'fondsPie', 'fondsManager', 'fondsPercent', 'fondsPro1', 'fondsPro2'],
      15: ['finanzierungLinks', 'finanzierungRechts', 'finanzierungPfeil', 'finanzierungTabelle', 'bankSpalte', 'ovbSpalte', 'ersparnis'],
      16: ['staatSektion', 'steuerzahlerSektion'],
      17: ['corner1', 'corner2', 'corner3', 'corner4'],
      18: ['ziele-box', 'ziel-ausbildung', 'ziel-auto', 'ziel-geld', 'ziel-immobilie', 'ziel-reisen','situation-box', 'pfeil-outline', 'schlangenlinie', 'risiko-unvorhergesehenes', 'risiko-unfall', 'risiko-ams', 'risiko-krankheit' , 'sparen-box', 'vorteil-sicherer', 'vorteil-schneller', 'vorteil-guenstiger'],
      19: ['abs-a', 'abs-text-a', 'abs-img-a', 'abs-b', 'abs-text-b', 'abs-img-b', 'abs-s', 'abs-text-s', 'abs-img-s'],
      20: []
      // Folie 6 hat keine Animationen mehr - springt direkt zur nächsten Folie
      // Folien 11-14 (Immobilien) haben keine step-by-step Animationen
    };
    
    let animationIndex = 0;
    
    function nextStep() {
      const currentAnimations = slideAnimations[currentSlide];
      
      if (currentAnimations && animationIndex < currentAnimations.length) {
        // Spezielle Behandlung für Finanzmarkt-Donut
        if (currentSlide === 6 && currentAnimations[animationIndex] === 'finanzmarkt-rotation') {
          rotateFinanzmarktDonut();
        } else {
          // Zeige nächstes Animations-Element
          const element = document.getElementById(currentAnimations[animationIndex]);
          if (element) {
            element.classList.add("show");
          }
        }
        animationIndex++;
      } else {
        // Animation abgeschlossen -> nächste Folie
        // Spezielle Behandlung für Immobilien-Seiten
        if (currentSlide === 11) {
          // Von Immobilien Hauptseite: Gehe immer zu Tippgeber (Folie 14)
          nextSlide(14);
        } else if (currentSlide === 12 || currentSlide === 13) {
          // Von Verkaufen oder Kaufen Seite: Gehe zu Tippgeber
          nextSlide(14);
        } else if (currentSlide === 14) {
          // Von Tippgeber Seite: Gehe zu Finanzierung
          nextSlide(15);
        } else if (currentSlide === 15) {
          // Von Finanzierung: Gehe zu Steuern
          nextSlide(16);
        } else if (currentSlide === 16) {
          // Von Steuern: Gehe zur Finanzmarkt-Übersicht
          nextSlide(17);
        } else if (currentSlide === 17) {
          // Von Finanzmarkt-Übersicht: Gehe zu Finanzieller Lebensplan
          nextSlide(18);
        } else if (currentSlide === 18) {
          // Von Finanzieller Lebensplan: Weiter zu ABS-Konzept
          nextSlide(currentSlide + 1);
        } else if (currentSlide === 19) {
          // Von ABS-Konzept: Weiter zu Fragen-Folie
          nextSlide(currentSlide + 1);
        } else if (currentSlide === 20) {
          // Von Fragen-Folie: Weiter zu Danke-Folie
          nextSlide(currentSlide + 1);
        } else if (currentSlide === 21) {
          // Von Danke-Folie: Zurück zum Anfang
          immobilienPath = null; // Reset da wir die Sektion verlassen
          nextSlide(1);
        } else if (currentSlide < 16) {
          // Normale Navigation für andere Folien
          nextSlide(currentSlide + 1);
        } else {
          // Am Ende angekommen -> zurück zum Anfang
          immobilienPath = null; // Reset Immobilien-Pfad
          nextSlide(1);
        }
        resetAnimationIndex();
      }
    }
    
    // Finanzmarkt-Donut Rotation
    function rotateFinanzmarktDonut() {
      const donut = document.getElementById('finanzmarkt-donut');
      if (donut) {
        // Rotiere den Donut um 60 Grad (360°/6 Segmente) und verschiebe ihn zur Hälfte aus dem Bildschirm
        donut.style.transform = 'translateX(-400px) rotate(60deg)';
        donut.style.transition = 'all 1.5s ease-in-out';
      }
    }
    
    // Reset Donut Position bei Folienwechsel
    function resetFinanzmarktDonut() {
      const donut = document.getElementById('finanzmarkt-donut');
      if (donut) {
        donut.style.transform = 'translateX(0px) rotate(0deg)';
        donut.style.transition = 'all 0.8s ease-in-out';
      }
    }
    
    function resetAnimationIndex() {
      animationIndex = 0;
    }
    
    // Keyboard Navigation - EINHEITLICH
    document.addEventListener('keydown', function(event) {
      if (event.key === 'ArrowRight') {
        // Nächste Animation oder nächste Folie
        if (currentSlide === 0) {
          startAnalyse();
        } else {
          nextStep();
        }
        event.preventDefault();
      } else if (event.key === 'ArrowLeft') {
        // Vorherige Folie
        if (currentSlide > 0) {
          resetAllAnimations();
          nextSlide(currentSlide - 1);
        }
        event.preventDefault();
      } else if (event.key === 'Enter' && currentSlide === 0) {
        startAnalyse();
        event.preventDefault();
      } else if (event.key === 'Escape') {
        // Vollbild beenden
        if (document.fullscreenElement) {
          document.exitFullscreen();
        }
      }
    });
    
    // Fullscreen Toggle
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log('Fullscreen not supported:', err);
        });
      } else {
        document.exitFullscreen();
      }
    }
    
    // Calculator Dropdown Functions
    function toggleCalculatorDropdown() {
      const dropdown = document.getElementById('calculatorDropdown');
      dropdown.classList.toggle('hidden');
    }

    function openCalculatorModal(calculatorType) {
      // Schließe Dropdown
      document.getElementById('calculatorDropdown').classList.add('hidden');
      
      // Setze Titel und Inhalt basierend auf Rechner-Typ
      const modal = document.getElementById('calculatorModal');
      const title = document.getElementById('calculatorTitle');
      const content = document.getElementById('calculatorContent');
      
      switch(calculatorType) {
        case 'pensionsluecke':
          title.textContent = 'Pensionslückenrechner';
          content.innerHTML = `
            <div class="pensionsrechner-container">
                <div id="pr-input-sections" class="pr-input-collapsible">
                    <h3 class="text-xl font-bold text-white mb-3">1. Allgemeine Daten</h3>
                    <div class="pensionsrechner-row">
                        <div style="flex:1">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Geschlecht</label>
                            <select id="pr-geschlecht" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"><option>Männlich</option><option>Weiblich</option></select>
                        </div>
                        <div style="flex:1">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Geburtsdatum</label>
                            <input type="date" id="pr-geburtsdatum" value="1995-12-11" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                    </div>
                    <div class="pensionsrechner-row">
                        <div style="flex:1">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Monatl. Einkommen (brutto)</label>
                            <input type="number" id="pr-einkommen" value="2000" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                        <div style="flex:1">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Karriereverlauf</label>
                            <select id="pr-karriere" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400"><option value="1">1 % p.a.</option><option value="2">2 % p.a.</option><option value="3">3 % p.a.</option><option value="4">4 % p.a.</option></select>
                        </div>
                        <div style="flex:1">
                            <label class="block text-sm font-medium text-gray-300 mb-1">Pensionsantrittsalter</label>
                            <input type="number" id="pr-pensionsalter" value="65" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                    </div>

                    <h3 class="text-xl font-bold text-white mt-6 mb-3">2. Analyse</h3>
                    <div class="pensionsrechner-note p-4 bg-sky-800 border border-sky-600 rounded-md text-sm text-gray-300">
                        Bei der Schnellanalyse greifen wir auf Durchschnittswerte zurück. Dadurch können wir zwar eine
                        nähere Pensionslücke errechnen, diese beruht aber auf Schätzwerten. Bitte sieh die angezeigten Werte
                        nur als Orientierungshilfe. Pensionen werden 14x pro Jahr ausbezahlt. Die Berechnung erfolgt in heutigem Geldwert.
                    </div>
                </div>

                <button id="pr-berechnen-btn" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors mx-auto block mt-4">Berechnen</button>

                <div id="pr-auswertung" class="pensionsrechner-result mt-6 p-6 bg-sky-800 rounded-lg border border-sky-600" style="display:none">
                    <h3 class="text-xl font-bold text-white mb-4">Alterspension</h3>
                    <div class="pensionsrechner-res-row flex justify-between py-2 border-b border-sky-600"><span class="text-gray-300">Pensionsantritt:</span><span id="pr-pAntritt" class="font-semibold text-white"></span></div>
                    <div class="pensionsrechner-res-row flex justify-between py-2 border-b border-sky-600"><span class="text-gray-300">Antrittsalter:</span><span id="pr-pAlter" class="font-semibold text-white"></span></div>
                    <div class="pensionsrechner-res-row flex justify-between py-2 border-b border-sky-600"><span class="text-gray-300">Karriereverlauf:</span><span id="pr-pKarriere" class="font-semibold text-white"></span></div>
                    <div class="pensionsrechner-res-row flex justify-between py-2 border-b border-sky-600"><span class="text-gray-300">Nettoletzteinkommen:</span><span id="pr-pLetzte" class="font-semibold text-white"></span></div>
                    <div class="pensionsrechner-res-row flex justify-between py-2 border-b border-sky-600"><span class="text-gray-300">Nettopension:</span><span class="font-semibold text-green-400" id="pr-pPension"></span></div>
                    <div class="pensionsrechner-res-row flex justify-between py-2 border-b border-sky-600"><span class="text-gray-300">Lücke:</span><span class="font-semibold text-red-400" id="pr-pLuecke"></span></div>
                    <div class="pensionsrechner-chart mt-6">
                        <div class="pensionsrechner-bar h-8 bg-sky-700 rounded-full overflow-hidden relative"><div class="segment pension bg-green-500 h-full absolute left-0" id="pr-barPension"></div><div class="segment gap bg-red-500 h-full absolute" id="pr-barGap"></div></div>
                        <div class="pensionsrechner-legend flex justify-center gap-6 mt-3">
                            <div class="legend-item flex items-center gap-2"><div class="legend-dot pension w-4 h-4 bg-green-500 rounded-full"></div><span class="text-sm text-gray-300">Gesicherte Pension</span></div>
                            <div class="legend-item flex items-center gap-2"><div class="legend-dot gap w-4 h-4 bg-red-500 rounded-full"></div><span class="text-sm text-gray-300">Pensionslücke</span></div>
                        </div>
                    </div>
                    <div class="text-center mt-6">
                        <button id="pr-reset-btn" class="bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 transition-colors"><i class="fas fa-redo mr-2"></i>Neu berechnen</button>
                    </div>
                </div>
            </div>
            <style>
              .pensionsrechner-row {
                display: flex;
                gap: 1rem;
                margin-bottom: 1rem;
              }
              .pr-input-collapsible.collapsed {
                display: none;
              }
              #pr-barGap {
                right: 0;
              }
            </style>
          `;
          // Initialisiere den Pensionslückenrechner nach dem DOM-Update
          setTimeout(() => initPensionsrechner(), 100);
          break;
        case 'vorsorge':
          title.textContent = 'Vorsorgerechner';
          content.innerHTML = `
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Eingaben -->
                <div class="lg:col-span-1 space-y-4">
                    <div>
                        <label for="vr-entnahme" class="block text-sm font-medium text-gray-300 mb-1">Entnahme pro Monat (€)</label>
                        <input type="number" id="vr-entnahme" value="2000" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div>
                        <label for="vr-dauer" class="block text-sm font-medium text-gray-300 mb-1">Entnahmezeitraum (Jahre)</label>
                        <input type="number" id="vr-dauer" value="37" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div>
                        <label for="vr-zinsEntnahme" class="block text-sm font-medium text-gray-300 mb-1">Zinssatz in Entnahmephase (% p.a.)</label>
                        <input type="number" id="vr-zinsEntnahme" value="3" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div>
                        <label for="vr-startKapital" class="block text-sm font-medium text-gray-300 mb-1">Anfangskapital (€)</label>
                        <input type="number" id="vr-startKapital" value="0" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div>
                        <label for="vr-zinsSparen" class="block text-sm font-medium text-gray-300 mb-1">Zinssatz in Sparphase (% p.a.)</label>
                        <input type="number" id="vr-zinsSparen" value="9" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <button id="vr-berechnen-btn" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors w-full">Berechnen</button>
                </div>
                <!-- Chart + Ergebnis -->
                <div class="lg:col-span-2 flex flex-col">
                    <div id="vr-chart-container" class="w-full flex-grow min-h-[300px]"></div>
                    <div class="mt-6 pt-6 border-t border-sky-600 space-y-2 text-lg text-white">
                        <div class="flex justify-between"><span class="text-gray-300">Benötigtes Kapital:</span> <span id="vr-kapital" class="font-bold text-white">0 €</span></div>
                        <div class="flex justify-between"><span class="text-gray-300">Monatliche Entnahme:</span> <span id="vr-monatl" class="font-bold text-white">0 €</span></div>
                        <div class="flex justify-between text-xl text-green-400 pt-2 border-t border-sky-600"><span>Benötigte Sparrate / Monat:</span> <span id="vr-sparrate" class="font-bold">0 €</span></div>
                    </div>
                </div>
            </div>
          `;
          // Initialisiere den Vorsorgerechner nach dem DOM-Update
          setTimeout(() => initVorsorgerechner(), 100);
          break;
        case 'bu-luecke':
          title.textContent = 'BU-Lückenrechner';
          content.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Linke Spalte: Eingaben -->
                <div class="space-y-4">
                    <h3 class="text-xl font-semibold text-white border-b border-sky-600 pb-2">1. Allgemeine Daten</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="bu-birthdate" class="block text-sm font-medium text-gray-300 mb-1">Geburtstag</label>
                            <input type="date" id="bu-birthdate" value="1995-12-11" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                        <div>
                            <label for="bu-job" class="block text-sm font-medium text-gray-300 mb-1">Berufsgruppe</label>
                            <select id="bu-job" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                                <option value="ang">Angestellte:r</option>
                                <option value="arb">Arbeiter:in</option>
                                <option value="selbst">Selbstständig</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="bu-income" class="block text-sm font-medium text-gray-300 mb-1">Monatl. Einkommen</label>
                            <input type="number" id="bu-income" value="2000" min="0" step="100" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                        <div>
                            <label for="bu-income-type" class="block text-sm font-medium text-gray-300 mb-1">Art</label>
                            <div id="bu-income-type-toggle" class="flex gap-2 bg-sky-800 p-1 rounded-lg border border-sky-600">
                                <button type="button" data-v="net" class="bu-toggle-btn flex-1 px-3 py-1 text-sm rounded bg-blue-600 text-white active">Netto</button>
                                <button type="button" data-v="gross" class="bu-toggle-btn flex-1 px-3 py-1 text-sm rounded text-gray-300 hover:bg-sky-700">Brutto</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="bu-ret-age" class="block text-sm font-medium text-gray-300 mb-1">Geplanter Pensionsantritt (Alter)</label>
                        <select id="bu-ret-age" class="w-full px-3 py-2 bg-sky-800 border border-sky-600 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <option>60</option><option>61</option><option>62</option><option>63</option><option>64</option><option selected>65</option><option>66</option><option>67</option>
                        </select>
                    </div>
                    
                    <div class="pt-4 border-t border-sky-600">
                        <h3 class="text-xl font-semibold text-white border-b border-sky-600 pb-2">2. Szenario BU</h3>
                        <label for="bu-entry-age" class="block text-sm font-medium text-gray-300 mt-4">Eintritt Berufsunfähigkeit mit <span id="bu-age-now" class="font-bold text-white">29</span> Jahren</label>
                        <input type="range" id="bu-entry-age" min="18" max="64" value="29" class="w-full mt-2 accent-blue-500">
                        <p class="text-xs text-gray-400 mt-2">Schieberegler bewegen, um den Zeitpunkt eines BU-Ereignisses zu simulieren. Berechnung erfolgt in heutigem Geld (vereinfacht).</p>
                    </div>
                </div>

                <!-- Rechte Spalte: Ergebnisse -->
                <div class="space-y-4">
                    <div class="bu-kpi bg-sky-800 p-4 rounded-lg border border-sky-600">
                        <div class="text-sm text-gray-300 mb-1">Geschätzte BU-Staatspension / Monat</div>
                        <div class="text-2xl font-bold text-white" id="bu-result-pension">–</div>
                    </div>
                    <div class="bu-kpi bg-red-900/30 p-4 rounded-lg border border-red-600">
                        <div class="text-sm text-gray-300 mb-1">Monatliche Lücke</div>
                        <div class="text-2xl font-bold text-red-400" id="bu-result-gap-month">–</div>
                    </div>
                    <div class="bu-kpi bg-sky-800 p-4 rounded-lg border border-sky-600">
                        <div class="text-sm text-gray-300 mb-1">Gesamtlücke bis zur Pension</div>
                        <div class="text-2xl font-bold text-white" id="bu-result-gap-total">–</div>
                    </div>
                    
                    <!-- Container für das ApexCharts-Diagramm -->
                    <div id="bu-chart-container" class="bg-sky-800 p-4 rounded-lg border border-sky-600"></div>
                    
                    <p class="text-xs text-gray-400 p-3 bg-sky-800 rounded-lg border border-sky-600">
                        Hinweis: Dies ist ein stark vereinfachtes Rechenmodell. Die BU-Staatspension wird hier überschlägig aus dem Nettoeinkommen abgeleitet und je nach Berufsgruppe skaliert. Tatsächliche Ansprüche hängen von Beitragszeiten, Bemessungsgrundlagen, Gesetzeslage u.v.m. ab. Werte dienen als Orientierung, nicht als Beratung oder Angebot.
                    </p>
                </div>
            </div>
            <style>
              .bu-toggle-btn.active {
                background-color: rgb(37 99 235) !important;
                color: white !important;
              }
              .bu-toggle-btn:not(.active) {
                background-color: transparent;
                color: rgb(156 163 175);
              }
              .bu-toggle-btn:not(.active):hover {
                background-color: rgb(51 65 85);
              }
            </style>
          `;
          // Initialisiere den BU-Lückenrechner nach dem DOM-Update
          setTimeout(() => initBuLueckenrechner(), 100);
          break;
        case 'erwerbspotential':
          title.textContent = 'Erwerbspotentialrechner';
          content.innerHTML = `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Linke Spalte: Eingaben -->
                <div class="space-y-4 bg-sky-800 p-6 rounded-lg border border-sky-600">
                    <h3 class="text-xl font-semibold text-white border-b border-sky-600 pb-2">Deine Angaben</h3>
                    <div>
                        <label for="ep-birth" class="block text-sm font-medium text-gray-300 mb-1">Geburtsdatum:</label>
                        <input type="date" id="ep-birth" value="1995-12-11" class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    <div>
                        <label for="ep-job" class="block text-sm font-medium text-gray-300 mb-1">Berufsgruppe:</label>
                        <select id="ep-job" class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <option value="arb" selected>Arbeiter:in</option>
                            <option value="ang">Angestellte:r</option>
                            <option value="selbst">Selbstständig</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="ep-gross" class="block text-sm font-medium text-gray-300 mb-1">Bruttogehalt p.m.:</label>
                            <input type="number" id="ep-gross" value="2709" min="0" step="1" class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                        <div>
                            <label for="ep-net" class="block text-sm font-medium text-gray-300 mb-1">Nettogehalt p.m.:</label>
                            <input type="number" id="ep-net" value="2000" min="0" step="1" class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        </div>
                    </div>
                    <div>
                        <label for="ep-growth" class="block text-sm font-medium text-gray-300 mb-1">Karriereverlauf:</label>
                        <select id="ep-growth" class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <option value="0">0 % p.a.</option>
                            <option value="0.02">2 % p.a.</option>
                            <option value="0.03" selected>3 % p.a.</option>
                            <option value="0.04">4 % p.a.</option>
                            <option value="0.05">5 % p.a.</option>
                        </select>
                    </div>
                </div>

                <!-- Rechte Spalte: Chart & KPIs -->
                <div class="flex flex-col bg-sky-800 rounded-lg overflow-hidden border border-sky-600">
                    <div class="p-6 flex-grow">
                        <h3 class="text-xl font-semibold text-white">Wert der Arbeitskraft</h3>
                        <div id="ep-chart-container" class="mt-4"></div>
                    </div>
                    <div class="bg-sky-700 p-4 border-t border-sky-600">
                        <div class="text-sm text-gray-300 mb-1">Summe deines erarbeiteten Nettoeinkommens bis zur Pension</div>
                        <div class="text-2xl font-bold text-white" id="ep-sum">–</div>
                    </div>
                </div>
            </div>
          `;
          // Initialisiere den Erwerbspotentialrechner nach dem DOM-Update
          setTimeout(() => initErwerbspotentialRechner(), 100);
          break;
        case 'finanzierung':
          title.textContent = 'Finanzierungsrechner';
          content.innerHTML = `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Linke Spalte: Eingaben -->
                <div class="space-y-6 bg-sky-800 p-6 rounded-lg border border-sky-600">
                    <h3 class="text-xl font-semibold text-white border-b border-sky-600 pb-2">Deine Angaben</h3>
                    
                    <!-- Kreditbetrag -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-300">Kreditbetrag</label>
                        <div class="space-y-2">
                            <input type="range" id="kr-amountRange" min="50000" max="3000000" step="10000" value="400000" 
                                   class="w-full h-2 bg-sky-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
                            <div class="flex justify-between items-center">
                                <button data-step="-50000" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">−</button>
                                <input type="text" id="kr-amountInput" value="400.000 €" 
                                       class="flex-1 mx-2 px-3 py-2 bg-sky-700 border border-sky-500 text-white text-center rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                                <button data-step="50000" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Laufzeit -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-300">Laufzeit</label>
                        <div class="space-y-2">
                            <input type="range" id="kr-yearsRange" min="10" max="35" step="1" value="25" 
                                   class="w-full h-2 bg-sky-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
                            <div class="flex justify-between items-center">
                                <button data-step="-1" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">−</button>
                                <input type="text" id="kr-yearsInput" value="25 Jahre" 
                                       class="flex-1 mx-2 px-3 py-2 bg-sky-700 border border-sky-500 text-white text-center rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                                <button data-step="1" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Sollzinssatz -->
                    <div>
                        <label for="kr-ratePA" class="block text-sm font-medium text-gray-300 mb-1">Sollzinssatz, variabel</label>
                        <input type="number" id="kr-ratePA" value="3.5" min="0" max="15" step="0.1" 
                               class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>

                    <!-- Tilgungsart -->
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Tilgungsart</label>
                        <select id="kr-tilgung" class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                            <option value="ann" selected>Annuitätendarlehen</option>
                            <option value="lin">Tilgungsdarlehen</option>
                        </select>
                    </div>

                    <!-- Monatsrate Anzeige -->
                    <div class="bg-sky-700 p-4 rounded-lg border border-sky-500">
                        <h4 class="text-lg font-semibold text-white mb-2">Monatsrate</h4>
                        <div class="text-2xl font-bold text-white" id="kr-kpiRate">–</div>
                    </div>
                </div>

                <!-- Rechte Spalte: Ergebnis -->
                <div class="bg-sky-800 p-6 rounded-lg border border-sky-600">
                    <div id="kr-breakdown-container">
                        <!-- Wird durch JavaScript gefüllt -->
                    </div>
                </div>
            </div>
          `;
          // Initialisiere den Finanzierungsrechner nach dem DOM-Update
          setTimeout(() => initKreditrechner(), 100);
          break;
        case 'leasing':
          title.textContent = 'Leasingrechner';
          content.innerHTML = `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Linke Spalte: Eingaben -->
                <div class="space-y-6 bg-sky-800 p-6 rounded-lg border border-sky-600">
                    <h3 class="text-xl font-semibold text-white border-b border-sky-600 pb-2">Deine Angaben</h3>
                    
                    <!-- Kaufpreis -->
                    <div>
                        <label for="leasing-priceInput" class="block text-sm font-medium text-gray-300 mb-1">Kaufpreis *</label>
                        <input id="leasing-priceInput" type="text" value="40.000,00 €" 
                               class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <div class="text-xs text-gray-400 mt-1">Kaufpreis inkl. USt. und NoVA</div>
                    </div>

                    <!-- Eigenmittel -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-300">Eigenmittel *</label>
                        <div class="space-y-2">
                            <input type="range" id="leasing-downRange" min="0" max="40000" step="100" value="8000" 
                                   class="w-full h-2 bg-sky-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
                            <div class="flex justify-between items-center">
                                <button data-step="-500" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">−</button>
                                <input id="leasing-downInput" type="text" value="8.000,00 €" 
                                       class="flex-1 mx-2 px-3 py-2 bg-sky-700 border border-sky-500 text-white text-center rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                                <button data-step="500" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">+</button>
                            </div>
                            <div class="flex justify-between text-xs text-gray-400">
                                <span id="leasing-downMinL">0,00 €</span>
                                <span id="leasing-downMaxL">40.000,00 €</span>
                            </div>
                        </div>
                    </div>

                    <!-- Laufzeit -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-300">Laufzeit *</label>
                        <div class="space-y-2">
                            <input type="range" id="leasing-termRange" min="24" max="60" step="1" value="36" 
                                   class="w-full h-2 bg-sky-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
                            <div class="flex justify-between items-center">
                                <button data-step="-1" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">−</button>
                                <input id="leasing-termInput" type="text" value="36 Monate" 
                                       class="flex-1 mx-2 px-3 py-2 bg-sky-700 border border-sky-500 text-white text-center rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                                <button data-step="1" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">+</button>
                            </div>
                            <div class="flex justify-between text-xs text-gray-400">
                                <span>24</span>
                                <span>60</span>
                            </div>
                        </div>
                    </div>

                    <!-- Restzahlung -->
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-gray-300">Restzahlung *</label>
                        <div class="space-y-2">
                            <input type="range" id="leasing-rvRange" min="0" max="22000" step="100" value="17225" 
                                   class="w-full h-2 bg-sky-600 rounded-lg appearance-none cursor-pointer accent-blue-500">
                            <div class="flex justify-between items-center">
                                <button data-step="-500" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">−</button>
                                <input id="leasing-rvInput" type="text" value="17.225,00 €" 
                                       class="flex-1 mx-2 px-3 py-2 bg-sky-700 border border-sky-500 text-white text-center rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                                <button data-step="500" class="w-8 h-8 bg-sky-700 text-white rounded hover:bg-sky-600 flex items-center justify-center">+</button>
                            </div>
                            <div class="flex justify-between text-xs text-gray-400">
                                <span id="leasing-rvMinL">0,00 €</span>
                                <span id="leasing-rvMaxL">22.000,00 €</span>
                            </div>
                        </div>
                    </div>

                    <!-- Sollzinssatz -->
                    <div>
                        <label for="leasing-ratePA" class="block text-sm font-medium text-gray-300 mb-1">Sollzinssatz (p.a.)</label>
                        <input id="leasing-ratePA" type="number" min="0" step="0.01" value="4.90" 
                               class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <div class="text-xs text-gray-400 mt-1">Nominal p.a., monatlich verrechnet.</div>
                    </div>
                </div>

                <!-- Rechte Spalte: Ergebnis -->
                <div class="bg-sky-800 p-6 rounded-lg border border-sky-600">
                    <h3 class="text-xl font-bold text-white mb-4">Ergebnis</h3>
                    
                    <!-- KPI Tabelle -->
                    <div class="space-y-4">
                        <div class="bg-sky-700 p-4 rounded-lg border border-sky-500">
                            <div class="flex justify-between items-center">
                                <span class="text-lg font-semibold text-white">Maximale Leasingrate</span>
                                <div class="text-right">
                                    <span class="text-2xl font-bold text-white" id="leasing-kpiRate">–</span>
                                    <span class="text-white ml-1">€</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-sky-700 p-3 rounded-lg border border-sky-500">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-300">Gesamtbelastung</span>
                                <div class="text-right">
                                    <span class="font-semibold text-white" id="leasing-kpiTotal">–</span>
                                    <span class="text-white ml-1">€</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-xs text-gray-400 mt-4">
                        <strong>Hinweis:</strong> Gesamtbelastung = Eigenmittel + Summe aller Monatsraten + Restzahlung. 
                        Keine Nebenkosten (Zulassung, Versicherung, Gebühren) berücksichtigt.
                    </div>
                </div>
            </div>
          `;
          // Initialisiere den Leasingrechner nach dem DOM-Update
          setTimeout(() => initLeasingrechner(), 100);
          break;
        case 'steuervorteil':
          title.textContent = 'Steuervorteilrechner';
          content.innerHTML = `
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Linke Spalte: Eingaben -->
                <div class="bg-sky-800 p-6 rounded-lg border border-sky-600 space-y-6">
                    <h3 class="text-xl font-bold text-center text-white border-b border-sky-600 pb-2">Deine Berechnung</h3>
                    
                    <div>
                        <label for="steuer-startwert" class="block text-sm font-medium text-gray-300 mb-1">Startwert (€)</label>
                        <input type="number" id="steuer-startwert" value="0" min="0" step="1000" 
                               class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    
                    <div>
                        <label for="steuer-sparrate" class="block text-sm font-medium text-gray-300 mb-1">Sparsumme / Monat (€)</label>
                        <input type="number" id="steuer-sparrate" value="200" min="0" step="10" 
                               class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    
                    <div>
                        <label for="steuer-dauer" class="block text-sm font-medium text-gray-300 mb-1">Anlagedauer (Jahre)</label>
                        <input type="number" id="steuer-dauer" value="35" min="1" max="50" step="1" 
                               class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    
                    <div>
                        <label for="steuer-rendite" class="block text-sm font-medium text-gray-300 mb-1">Rendite p.a. (%)</label>
                        <input type="number" id="steuer-rendite" value="7" min="0" max="20" step="0.1" 
                               class="w-full px-3 py-2 bg-sky-700 border border-sky-500 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    </div>
                    
                    <div class="flex items-center justify-between pt-4 border-t border-sky-600">
                        <label for="steuer-kest" class="text-sm font-medium text-gray-300">KESt berücksichtigen?</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="steuer-kest" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-sky-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-500"></div>
                        </label>
                    </div>
                    
                    <!-- Ergebnisse -->
                    <div class="pt-4 border-t border-sky-600 space-y-3 text-lg text-white">
                        <div class="flex justify-between">
                            <span>Einzahlung gesamt:</span> 
                            <span id="steuer-output-einzahlung" class="font-bold">0 €</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Rendite gesamt:</span> 
                            <span id="steuer-output-rendite" class="font-bold">0 €</span>
                        </div>
                        <div class="flex justify-between text-red-400">
                            <span>KESt gesamt:</span> 
                            <span id="steuer-output-kest" class="font-bold">0 €</span>
                        </div>
                        <div class="flex justify-between text-xl text-green-400 pt-2 border-t border-sky-600">
                            <span>Endbetrag:</span> 
                            <span id="steuer-output-endbetrag" class="font-bold">0 €</span>
                        </div>
                    </div>
                </div>

                <!-- Rechte Spalte: Chart -->
                <div class="bg-sky-800 p-6 rounded-lg border border-sky-600">
                    <h3 class="text-xl font-bold text-white mb-4 text-center">Vermögensentwicklung</h3>
                    <div id="steuer-chart-container" class="w-full h-96"></div>
                </div>
            </div>
          `;
          // Initialisiere den Steuervorteilrechner nach dem DOM-Update
          setTimeout(() => initSteuervorteilrechner(), 100);
          break;
      }
      
      // Zeige Modal
      modal.classList.remove('hidden');
    }

    function closeCalculatorModal() {
      document.getElementById('calculatorModal').classList.add('hidden');
    }

    // Schließe Dropdown wenn außerhalb geklickt wird
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('calculatorDropdown');
      const button = event.target.closest('.control-btn');
      
      if (!button && !dropdown.contains(event.target)) {
        dropdown.classList.add('hidden');
      }
    });

    function openCalculator() {
      // Alte Funktion - wird nicht mehr verwendet
    }
    
    // Jump to specific slide (dynamisch)
    function jumpToSlide(slideNumber) {
      // Reset alle Animationen für alle Folien
      resetAllAnimations();
      
      // Springe zur gewünschten Folie
      nextSlide(slideNumber);
      
      // Spezielle Behandlung für bestimmte Folien
      if (slideNumber === 4) {
        // Folie 4: Zeige alle Animationen sofort
        showAllAnimations();
      }
    }
    
    // Hilfsfunktion: Alle Animationen zurücksetzen
    function resetAllAnimations() {
      // Reset alle Animationen für alle Folien
      Object.values(slideAnimations).forEach(animationList => {
        animationList.forEach(id => {
          const element = document.getElementById(id);
          if (element) element.classList.remove("show");
        });
      });
      
      // Reset alle fade-in Elemente
      document.querySelectorAll('.fade-in').forEach(element => {
        element.classList.remove('show');
      });
      
      resetAnimationIndex();
    }
    
    // Hilfsfunktion: Alle Animationen für aktuelle Folie anzeigen
    function showAllAnimations() {
      const currentAnimations = slideAnimations[currentSlide];
      if (currentAnimations) {
        currentAnimations.forEach(id => {
          const element = document.getElementById(id);
          if (element) element.classList.add("show");
        });
        animationIndex = currentAnimations.length;
      }
    }
    
    // === SEATABLE-KONFIGURATION & FUNKTIONEN (aus beratung_standalone.js kopiert) ===
    
    // Konstanten & Globale Variablen
    const SEATABLE_API_TOKEN = "b148f4c735d193f77841ce4e4ddb2bb8bc2e446b";
    const SEATABLE_APP_ACCESS_TOKEN_URL = "https://cloud.seatable.io/api/v2.1/dtable/app-access-token/";
    const SEATABLE_DTABLE_UUID = "5b374b51-789c-4aac-a12f-02574f8f4855";

    let seaTableAccessToken = null;
    let apiGatewayUrl = null;
    let COLUMN_MAPS = {};
    let METADATA = {};
    let db = {
      mitarbeiter: [],
      gesellschaften: [], // Für Logos
    };
    
    // === ZEITDAUER-TRACKING ===
    let presentationStartTime = null;
    let presentationDuration = null;

    // SeaTable Access Token holen
    async function getSeaTableAccessToken() {
      try {
        const url = `${SEATABLE_APP_ACCESS_TOKEN_URL}?dtable_uuid=${SEATABLE_DTABLE_UUID}`;
        const response = await fetch(url, { headers: { Authorization: `Token ${SEATABLE_API_TOKEN}` } });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        seaTableAccessToken = data.access_token;
        apiGatewayUrl = data.dtable_server;
      } catch (error) {
        console.error("Error getting SeaTable access token:", error);
      }
    }

    // SeaTable Tabellen abfragen
    async function seaTableQuery(tableName) {
      if (!seaTableAccessToken || !apiGatewayUrl) {
        await getSeaTableAccessToken();
      }
      try {
        const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/rows/?table_name=${encodeURIComponent(tableName)}&convert_link_id=true`;
        const response = await fetch(url, { headers: { Authorization: `Bearer ${seaTableAccessToken}` } });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        return data.rows || [];
      } catch (error) {
        console.error(`Error fetching data from table ${tableName}:`, error);
        return [];
      }
    }

    // Spalten-Maps von SeaTable holen
    async function fetchColumnMaps() {
      if (!seaTableAccessToken || !apiGatewayUrl) return {};
      try {
        const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/metadata/`;
        const response = await fetch(url, { headers: { Authorization: `Bearer ${seaTableAccessToken}` } });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        const newColumnMaps = {};
        if (data && data.metadata && data.metadata.tables) {
          METADATA.tables = data.metadata.tables;
          data.metadata.tables.forEach((table) => {
            newColumnMaps[table.name.toLowerCase()] = {};
            table.columns.forEach((col) => { newColumnMaps[table.name.toLowerCase()][col.name] = col.key; });
          });
        }
        return newColumnMaps;
      } catch (error) {
        console.error("Error fetching column maps:", error);
        return {};
      }
    }

    // Download-Links für Dateien holen
    async function getSeaTableDownloadLink(filePath) {
      const log = (message, ...data) => console.log(`%c[DownloadLink] %c${message}`, 'color: #17a2b8; font-weight: bold;', 'color: black;', ...data);
      log(`Anfrage für Download-Link für Pfad: ${filePath}`);

      if (!SEATABLE_API_TOKEN) {
        log("!!! FEHLER: Haupt-API-Token (SEATABLE_API_TOKEN) fehlt.");
        console.error("Cannot get download link without the main SeaTable API Token.");
        return null;
      }
      try {
        let relativePath = filePath;
        const assetPrefix = `/asset/${SEATABLE_DTABLE_UUID}/`;
        const assetIndex = relativePath.indexOf(assetPrefix);

        if (assetIndex !== -1) {
          relativePath = relativePath.substring(assetIndex + assetPrefix.length);
          log(`Asset-Pfad extrahiert: ${relativePath}`);
        } else {
          log(`WARNUNG: Asset-Präfix nicht im Pfad gefunden. Verwende Pfad wie er ist: ${relativePath}`);
        }

        let rawPath;
        try {
          const correctedPath = relativePath.replace(/%6s/g, '%20');
          rawPath = decodeURIComponent(correctedPath);
          log(`Pfad dekodiert zu: ${rawPath}`);
        } catch (e) {
          log(`Konnte Pfad nicht dekodieren, wird unverändert verwendet. Fehler: ${e.message}`);
          rawPath = relativePath;
        }

        const url = `https://cloud.seatable.io/api/v2.1/dtable/app-download-link/?dtable_uuid=${SEATABLE_DTABLE_UUID}&path=${rawPath}`;
        const response = await fetch(url, { method: 'GET', headers: { Authorization: `Token ${SEATABLE_API_TOKEN}` } });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        return data.download_link;
      } catch (error) {
        log('!!! KRITISCHER FEHLER beim Abrufen des Download-Links:', error);
        return null;
      }
    }

    // SeaTable initialisieren
    async function initSeaTable() {
      console.log('Initialisiere SeaTable-Verbindung...');
      
      try {
        // 1. Access Token holen
        await getSeaTableAccessToken();
        if (!seaTableAccessToken) {
          throw new Error('Konnte SeaTable Access Token nicht erhalten');
        }

        // 2. Spalten-Maps laden
        const columnMaps = await fetchColumnMaps();
        COLUMN_MAPS = columnMaps;
        console.log('COLUMN_MAPS geladen:', COLUMN_MAPS);

        // 3. Mitarbeiter-Daten laden
        const mitarbeiterData = await seaTableQuery('Mitarbeiter');
        db.mitarbeiter = mitarbeiterData;
        console.log(`${mitarbeiterData.length} Mitarbeiter geladen`);

        // 4. Gesellschaften für Logos laden (optional)
        try {
          const gesellschaftenData = await seaTableQuery('Gesellschaften');
          db.gesellschaften = gesellschaftenData;
          console.log(`${gesellschaftenData.length} Gesellschaften geladen`);
        } catch (error) {
          console.warn('Gesellschaften-Tabelle nicht gefunden, weiter ohne Logos');
        }

        console.log('SeaTable erfolgreich initialisiert');
        return true;
      } catch (error) {
        console.error('Fehler bei SeaTable-Initialisierung:', error);
        return false;
      }
    }

    // HTML Escaping
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Berater-Vorstellung rendern (Kopie der _renderBeraterVorstellung Methode)
    async function renderBeraterVorstellung() {
      console.log('🔍 renderBeraterVorstellung() gestartet');
      const container = document.getElementById('berater-slide-container');
      if (!container) {
        console.error('❌ Container berater-slide-container nicht gefunden');
        return;
      }

      container.innerHTML = '<div class="loader-white mx-auto"></div>';

      const beraterName = window.currentBeraterName;
      console.log('👤 Berater-Name:', beraterName);
      if (!beraterName) {
        container.innerHTML = '<p class="text-center text-xl">Kein Berater-Name angegeben.</p>';
        return;
      }

      // Prüfe ob SeaTable-Daten verfügbar sind (brauchen wir die globalen Variablen)
      console.log('🔗 SeaTable Check - COLUMN_MAPS:', typeof COLUMN_MAPS, 'db:', typeof db);
      console.log('📊 db.mitarbeiter length:', db?.mitarbeiter?.length);
      
      if (typeof COLUMN_MAPS === 'undefined' || typeof db === 'undefined' || !db.mitarbeiter || db.mitarbeiter.length === 0) {
        console.warn('⚠️ SeaTable-Daten nicht verfügbar - verwende Fallback');
        // Fallback wenn SeaTable nicht verfügbar
        renderBeraterFallback(beraterName);
        return;
      }

      const nameKey = COLUMN_MAPS.mitarbeiter?.Name;
      console.log('🔑 nameKey:', nameKey);
      
      const berater = nameKey 
        ? db.mitarbeiter.find(m => m && m[nameKey] && m[nameKey].toLowerCase() === beraterName.toLowerCase())
        : null;

      console.log('👨‍💼 Berater gefunden:', !!berater);
      if (berater) {
        console.log('📝 Berater-Daten:', berater);
      }

      if (!berater) {
        console.warn('❌ Berater nicht gefunden');
        container.innerHTML = `<p class="text-center text-xl">Informationen zum Berater "${escapeHtml(beraterName)}" konnten nicht geladen werden.</p>`;
        return;
      }

      console.log('✅ Berater gefunden - extrahiere Daten...');
      
      // Berater-Daten extrahieren
      const karrierestufeLink = berater[COLUMN_MAPS.mitarbeiter.Karrierestufe];
      const karrierestufe = (Array.isArray(karrierestufeLink) && karrierestufeLink[0]) ? karrierestufeLink[0].display_value : 'Berater';
      console.log('💼 Karrierestufe:', karrierestufe);

      const bueroLink = berater[COLUMN_MAPS.mitarbeiter.Buero];
      const buero = (Array.isArray(bueroLink) && bueroLink[0]) ? bueroLink[0].display_value : 'Hauptzentrale';
      console.log('🏢 Büro:', buero);

      const textZuMir = berater[COLUMN_MAPS.mitarbeiter.TextZuMir] || 'Ihr Experte für eine sichere finanzielle Zukunft.';
      console.log('📝 Text zu mir:', textZuMir);
      
      const bildUrlRaw = berater[COLUMN_MAPS.mitarbeiter.Bild]?.[0];
      console.log('🖼️ Bild URL Raw:', bildUrlRaw);

      const hatVA = berater[COLUMN_MAPS.mitarbeiter.VA] === true;
      const hatVB = berater[COLUMN_MAPS.mitarbeiter.VB] === true;
      const hatImmo = berater[COLUMN_MAPS.mitarbeiter.Immobilienexperte] === true;
      console.log('🔧 Qualifikationen - VA:', hatVA, 'VB:', hatVB, 'Immo:', hatImmo);

      // Bild laden
      console.log('🖼️ Starte Bild-Laden...');
      let bildHtml = '<div class="w-80 h-80 bg-sky-700 rounded-full flex items-center justify-center"><i class="fas fa-user fa-8x text-white"></i></div>';
      if (bildUrlRaw && typeof getSeaTableDownloadLink === 'function') {
        try {
          console.log('📸 Lade Bild von SeaTable...');
          const finalBildUrl = await getSeaTableDownloadLink(bildUrlRaw);
          console.log('🔗 Final Bild URL:', finalBildUrl);
          if (finalBildUrl) {
            bildHtml = `<img src="${finalBildUrl}" alt="Portrait von ${escapeHtml(berater[nameKey])}" class="w-80 h-80 rounded-full object-cover shadow-2xl border-4 border-white">`;
            console.log('✅ Bild HTML erstellt');
          }
        } catch (error) {
          console.warn('❌ Fehler beim Laden des Beraterbildes:', error);
        }
      } else {
        console.log('ℹ️ Kein Bild oder getSeaTableDownloadLink nicht verfügbar');
      }

      // Siegel erstellen
      const createSiegel = (text, icon) => `
        <div class="flex flex-col items-center text-center">
          <div class="w-24 h-24 rounded-full bg-accent-gold text-skt-blue flex items-center justify-center shadow-lg mb-2 border-4 border-skt-blue-light">
            <i class="fas ${icon} fa-3x"></i>
          </div>
          <p class="font-semibold">${text}</p>
        </div>
      `;

      let siegelHtml = '<div class="flex justify-center gap-8 mt-8">';
      if (hatVA) siegelHtml += createSiegel('Versicherungsagent', 'fa-shield-alt');
      if (hatVB) siegelHtml += createSiegel('Vermögensberater', 'fa-piggy-bank');
      if (hatImmo) siegelHtml += createSiegel('Immobilienexperte', 'fa-home');
      siegelHtml += '</div>';

      // Berater-Inhalt rendern (50% größer skaliert)
      console.log('🎨 Erstelle HTML für Container...');
      const finalHtml = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-18 items-center transform scale-150">
          <div class="md:col-span-2 text-left">
            <h2 class="text-7xl font-bold mb-2">${escapeHtml(berater[nameKey])}</h2>
            <p class="text-gold font-bold text-3xl mb-3">${karrierestufe}</p>
            <p class="text-2xl text-gray-300 mb-9"><i class="fas fa-map-marker-alt mr-3"></i>${escapeHtml(buero)}</p>
            <div class="prose prose-3xl text-white max-w-none">
              ${textZuMir}
            </div>
            ${(hatVA || hatVB || hatImmo) ? siegelHtml : ''}
          </div>
          <div class="flex justify-center md:justify-end">
            ${bildHtml.replace('w-80 h-80', 'w-96 h-96')}
          </div>
        </div>
      `;
      
      console.log('📄 Final HTML length:', finalHtml.length);
      container.innerHTML = finalHtml;
      
      // Mache den Container sichtbar
      container.classList.add('show');
      console.log('✅ Berater-Inhalt erfolgreich gerendert und sichtbar gemacht!');
    }

    // Fallback wenn SeaTable nicht verfügbar
    function renderBeraterFallback(beraterName) {
      const container = document.getElementById('berater-slide-container');
      if (!container) return;

      const siegelHtml = `
        <div class="flex justify-center gap-8 mt-8">
          <div class="flex flex-col items-center text-center">
            <div class="w-24 h-24 rounded-full bg-accent-gold text-skt-blue flex items-center justify-center shadow-lg mb-2 border-4 border-skt-blue-light">
              <i class="fas fa-shield-alt fa-3x"></i>
            </div>
            <p class="font-semibold">Versicherungsagent</p>
          </div>
          <div class="flex flex-col items-center text-center">
            <div class="w-24 h-24 rounded-full bg-accent-gold text-skt-blue flex items-center justify-center shadow-lg mb-2 border-4 border-skt-blue-light">
              <i class="fas fa-piggy-bank fa-3x"></i>
            </div>
            <p class="font-semibold">Vermögensberater</p>
          </div>
          <div class="flex flex-col items-center text-center">
            <div class="w-24 h-24 rounded-full bg-accent-gold text-skt-blue flex items-center justify-center shadow-lg mb-2 border-4 border-skt-blue-light">
              <i class="fas fa-home fa-3x"></i>
            </div>
            <p class="font-semibold">Immobilienexperte</p>
          </div>
        </div>
      `;

      container.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 gap-18 items-center transform scale-150">
          <div class="md:col-span-2 text-left">
            <h2 class="text-7xl font-bold mb-2">${escapeHtml(beraterName)}</h2>
            <p class="text-gold font-bold text-3xl mb-3">Regionaldirektor</p>
            <p class="text-2xl text-gray-300 mb-9"><i class="fas fa-map-marker-alt mr-3"></i>Hauptzentrale Wien</p>
            <div class="prose prose-2xl text-white max-w-none">
              <p>Als erfahrener Finanzexperte mit über 10 Jahren Branchenerfahrung unterstütze ich Sie dabei, Ihre finanziellen Ziele zu erreichen und eine sichere Zukunft aufzubauen.</p>
              <p class="mt-6">Meine Spezialisierung liegt in der ganzheitlichen Finanzberatung – von der Risikoabsicherung über Vermögensaufbau bis hin zur Altersvorsorge.</p>
            </div>
            ${siegelHtml}
          </div>
          <div class="flex justify-center md:justify-end">
            <div class="w-96 h-96 bg-sky-700 rounded-full flex items-center justify-center border-4 border-white shadow-2xl">
              <i class="fas fa-user fa-8x text-white"></i>
            </div>
          </div>
        </div>
      `;
      
      // Mache den Container sichtbar
      container.classList.add('show');
    }

    // Beim Laden der Seite - initialisiere alles
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('📄 Seite geladen - initialisiere...');
      
      // 1. Erstmal alle Slides verstecken
      document.querySelectorAll('.slide').forEach(s => {
        s.classList.remove('active');
        s.style.display = 'none';
      });
      
      // 2. SeaTable initialisieren
      console.log('Starte SeaTable-Initialisierung...');
      const seaTableSuccess = await initSeaTable();
      if (seaTableSuccess) {
        console.log('✅ SeaTable bereit');
      } else {
        console.warn('⚠️ SeaTable-Initialisierung fehlgeschlagen - Fallback aktiv');
      }

      // 3. Starte mit Folie 0
      nextSlide(0);
      
      // 3. Fokus auf Eingabefeld setzen
      setTimeout(() => {
        const input = document.getElementById('beraterNameInput');
        if (input) {
          input.focus();
        }
      }, 100);
      
      // 4. Enter-Key im Eingabefeld abfangen
      const input = document.getElementById('beraterNameInput');
      if (input) {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            startAnalyse();
          }
        });
      }
      
      // 5. Auch bei normaler Enter-Taste in der Eingabe
      input.addEventListener('focus', function() {
        document.addEventListener('keydown', function handleEnter(e) {
          if (e.key === 'Enter' && document.activeElement === input) {
            startAnalyse();
            document.removeEventListener('keydown', handleEnter);
          }
        });
      });
      
      // 6. Optional: URL-Parameter laden falls vorhanden
      const urlParams = new URLSearchParams(window.location.search);
      const urlBerater = urlParams.get('advisor') || urlParams.get('berater');
      if (urlBerater && input) {
        input.value = urlBerater;
        startAnalyse();
      }
    });

    // Define morphTransitionToFolie7 function
    function morphTransitionToFolie7() {
      const folie6 = document.getElementById('folie6');
      const folie7 = document.getElementById('folie7');

      if (folie6 && folie7) {
        folie6.style.transition = 'opacity 1s ease, transform 1s ease';
        folie6.style.opacity = '0';
        folie6.style.transform = 'scale(0.9)';

        setTimeout(() => {
          folie6.style.display = 'none';
          folie7.style.display = 'flex';
          folie7.style.opacity = '1';
          folie7.style.transform = 'scale(1)';
        }, 1000);
      }
    }

    // Kreis-Rotation für Versicherungen-Folie
    function rotateVersicherungKreis() {
      const kreis = document.querySelector('#versicherungKreis img');
      if (kreis) {
        // Starte von 0° und drehe zu -60°
        kreis.style.transform = 'rotate(-60deg)';
        console.log('🔄 Versicherung-Kreis wird gedreht');
      }
    }

    // Reset Kreis Position bei Folienwechsel
    function resetVersicherungKreis() {
      const kreis = document.querySelector('#versicherungKreis img');
      if (kreis) {
        kreis.style.transform = 'rotate(0deg)';
      }
    }

    // Kreis-Rotation für Bausparkassen-Folie
    function rotateBausparkassenKreis() {
      const kreis = document.querySelector('#bausparkassenKreis img');
      if (kreis) {
        // Starte von -60° und drehe zu -120°
        kreis.style.transform = 'rotate(-120deg)';
        console.log('🔄 Bausparkassen-Kreis wird gedreht');
      }
    }

    // Reset Bausparkassen-Kreis Position bei Folienwechsel
    function resetBausparkassenKreis() {
      const kreis = document.querySelector('#bausparkassenKreis img');
      if (kreis) {
        kreis.style.transform = 'rotate(-60deg)';
      }
    }

    // Kreis-Rotation für Investment-Folie
    function rotateInvestmentKreis() {
      const kreis = document.querySelector('#investmentKreis img');
      if (kreis) {
        // Starte von -120° und drehe zu -180°
        kreis.style.transform = 'rotate(-180deg)';
        console.log('🔄 Investment-Kreis wird gedreht');
      }
    }

    // Reset Investment-Kreis Position bei Folienwechsel
    function resetInvestmentKreis() {
      const kreis = document.querySelector('#investmentKreis img');
      if (kreis) {
        kreis.style.transform = 'rotate(-120deg)';
      }
    }

    // Kreis-Rotation für Immobilien-Folie
    function rotateImmobilienKreis() {
      const kreis = document.querySelector('#immobilienKreis img');
      if (kreis) {
        // Starte von -180° und drehe zu -240°
        kreis.style.transform = 'rotate(-240deg)';
        console.log('🔄 Immobilien-Kreis wird gedreht');
      }
    }

    // Reset Immobilien-Kreis Position bei Folienwechsel
    function resetImmobilienKreis() {
      const kreis = document.querySelector('#immobilienKreis img');
      if (kreis) {
        kreis.style.transform = 'rotate(-180deg)';
      }
    }

    // Kreis-Rotation für Steuern-Folie
    function rotateSteuernKreis() {
      const kreis = document.querySelector('#steuernKreis img');
      if (kreis) {
        // Starte von -240° und drehe zu -300° (weitere 60° Drehung)
        kreis.style.transform = 'rotate(-300deg)';
        console.log('🔄 Steuern-Kreis wird gedreht');
      }
    }

    // Reset Steuern-Kreis Position bei Folienwechsel
    function resetSteuernKreis() {
      const kreis = document.querySelector('#steuernKreis img');
      if (kreis) {
        kreis.style.transform = 'rotate(-240deg)';
      }
    }

    // Pensionslückenrechner-Funktion (kopiert aus beratung_standalone.js)
    function initPensionsrechner() {
        const berechnenBtn = document.getElementById('pr-berechnen-btn');
        const resetBtn = document.getElementById('pr-reset-btn');
        const inputSections = document.getElementById('pr-input-sections');
        const auswertungSection = document.getElementById('pr-auswertung');

        if (!berechnenBtn || !resetBtn || !inputSections || !auswertungSection) return;

        // Remove old listener to prevent duplicates
        const newBtn = berechnenBtn.cloneNode(true);
        berechnenBtn.parentNode.replaceChild(newBtn, berechnenBtn);

        const resetView = () => {
            inputSections.classList.remove('collapsed');
            auswertungSection.style.display = 'none';
            newBtn.style.display = 'inline-flex';
        };

        resetBtn.addEventListener('click', resetView);

        newBtn.addEventListener('click', () => {
            const anfangsEinkommen = parseFloat(document.getElementById("pr-einkommen").value) || 0;
            const karriereSteigerung = (parseInt(document.getElementById("pr-karriere").value) || 0) / 100;
            const geburtsdatum = new Date(document.getElementById("pr-geburtsdatum").value);
            const pensionsalter = parseInt(document.getElementById("pr-pensionsalter").value) || 65;
            
            // KORREKTUR: Dynamische Berechnung des letzten Einkommens
            const heute = new Date();
            const alter = heute.getFullYear() - geburtsdatum.getFullYear();
            const verbleibendeJahre = pensionsalter - alter;
            
            // Zinseszinsformel für das Gehalt
            const letztesBruttoEinkommen = anfangsEinkommen * Math.pow(1 + karriereSteigerung, verbleibendeJahre);

            // einfache Annahmen
            const nettoFaktor = 1.326; // Annäherung für Brutto -> Netto x14
            const pensionsersatzrate = 0.74; // Annäherung für die Pensionshöhe
            const nettoLetzteinkommen = letztesBruttoEinkommen * nettoFaktor;
            const nettoPension = nettoLetzteinkommen * pensionsersatzrate;
            const luecke = nettoLetzteinkommen - nettoPension;

            document.getElementById("pr-pAntritt").innerText = "01.01.2061";
            document.getElementById("pr-pAlter").innerText = `${pensionsalter} Jahre`;
            document.getElementById("pr-pKarriere").innerText = (karriereSteigerung * 100) + " %";
            document.getElementById("pr-pLetzte").innerText = nettoLetzteinkommen.toFixed(0) + " €";
            document.getElementById("pr-pPension").innerText = nettoPension.toFixed(0) + " €";
            document.getElementById("pr-pLuecke").innerText = luecke.toFixed(0) + " €";

            // Balken-Diagramm
            const total = nettoLetzteinkommen;
            const pensionPct = (nettoPension / total) * 100;
            const gapPct = (luecke / total) * 100;
            document.getElementById("pr-barPension").style.width = pensionPct + "%";
            document.getElementById("pr-barGap").style.width = gapPct + "%";
            document.getElementById("pr-auswertung").style.display = "block";
            newBtn.style.display = 'none'; // Hide the calculate button

            // NEU: Klappe die Eingabefelder nach der Berechnung ein.
            inputSections.classList.add('collapsed');
        });
    }

    // Vorsorgerechner-Funktion (kopiert aus beratung_standalone.js)
    function initVorsorgerechner() {
        const berechnenBtn = document.getElementById('vr-berechnen-btn');
        if (!berechnenBtn) return;

        const berechnen = () => {
            const entnahme = parseFloat(document.getElementById("vr-entnahme").value) || 0;
            const dauer = parseInt(document.getElementById("vr-dauer").value) || 0;
            const zinsEntnahme = (parseFloat(document.getElementById("vr-zinsEntnahme").value) || 0) / 100;
            const zinsSparen = (parseFloat(document.getElementById("vr-zinsSparen").value) || 0) / 100;
            const startKapital = parseFloat(document.getElementById("vr-startKapital").value) || 0;

            // Kapitalbedarf berechnen
            const monate = dauer * 12;
            const i = zinsEntnahme / 12;
            const kapitalBedarf = entnahme * (1 - Math.pow(1 + i, -monate)) / i;

            // Sparrate berechnen (Annahme: 25 Jahre Sparphase)
            const sparJahre = 25;
            const m = sparJahre * 12;
            const j = zinsSparen / 12;
            const sparrate = (kapitalBedarf - startKapital) * j / (Math.pow(1 + j, m) - 1);

            // Ausgabe
            const formatCurrency = (val) => val.toLocaleString("de-DE", { style: "currency", currency: "EUR" });
            document.getElementById("vr-kapital").innerText = formatCurrency(kapitalBedarf);
            document.getElementById("vr-monatl").innerText = formatCurrency(entnahme);
            document.getElementById("vr-sparrate").innerText = formatCurrency(sparrate);

            // Chart-Daten generieren
            const years = [...Array(sparJahre + dauer + 1).keys()];
            let values = [];
            let saldo = startKapital;
            for (let y = 0; y <= sparJahre; y++) {
                saldo = saldo * (1 + zinsSparen) + sparrate * 12;
                values.push(saldo);
            }
            for (let y = 1; y <= dauer; y++) {
                saldo = saldo * (1 + zinsEntnahme) - entnahme * 12;
                values.push(Math.max(saldo, 0));
            }

            // ApexChart rendern
            const chartContainer = document.getElementById('vr-chart-container');
            chartContainer.innerHTML = '';
            const options = {
                series: [{ name: "Kapitalverlauf", data: values }],
                chart: { type: 'area', height: 350, foreColor: '#e2e8f0', toolbar: { show: false }, zoom: { enabled: false } },
                dataLabels: { enabled: false },
                stroke: { curve: 'smooth', width: 2 },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.7,
                        opacityTo: 0.2,
                        stops: [0, 100]
                    }
                },
                // NEU: Farben für Anspar- und Entnahmephase
                colors: ['#22c55e'], // Startet mit Grün
                annotations: {
                    xaxis: [{
                        x: sparJahre,
                        borderColor: '#FFD700',
                        label: {
                            borderColor: '#FFD700',
                            style: { color: '#111', background: '#FFD700', },
                            text: 'Pensionsantritt'
                        }
                    }]
                },
                xaxis: {
                    categories: years,
                    title: { text: 'Jahre', style: { color: '#9ca3af' } },
                    labels: { formatter: (val) => (parseInt(val) % 5 === 0) ? val : '' }
                },
                yaxis: {
                    title: { text: 'Kapital in €', style: { color: '#9ca3af' } },
                    labels: { formatter: (val) => `${(val / 1000).toFixed(0)}k` }
                },
                tooltip: { theme: 'dark', y: { formatter: (val) => `${val.toLocaleString('de-DE')} €` } },
                grid: { borderColor: '#4a5568', strokeDashArray: 4 }
            };
            const chart = new ApexCharts(chartContainer, options);
            chart.render();
        };

        berechnenBtn.onclick = berechnen;
        berechnen(); // Initial render
    }

    // BU-Lückenrechner-Funktion (kopiert aus beratung_standalone.js)
    function initBuLueckenrechner() {
        const fmt = (v) => new Intl.NumberFormat('de-AT', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(v || 0);

        let chart = null; // Variable für die Chart-Instanz
        const incomeTypeToggle = document.getElementById('bu-income-type-toggle');
        const allInputs = ['#bu-birthdate', '#bu-job', '#bu-income', '#bu-ret-age', '#bu-entry-age'];

        const calc = () => {
            const type = incomeTypeToggle.querySelector('.active')?.dataset.v || 'net';
            const birth = new Date(document.getElementById('bu-birthdate').value || '1990-01-01');
            const job = document.getElementById('bu-job').value;
            const incomeInput = parseFloat(document.getElementById('bu-income').value || 0);
            const retAge = parseInt(document.getElementById('bu-ret-age').value, 10);
            const growth = 0.02; // NEU: Festes jährliches Gehaltswachstum von 2%
            const entryAge = parseInt(document.getElementById('bu-entry-age').value, 10);

            // Alter heute
            const now = new Date();
            let age = now.getFullYear() - birth.getFullYear();
            const m = now.getMonth() - birth.getMonth();
            if (m < 0 || (m === 0 && now.getDate() < birth.getDate())) age--;

            // Nettoeinkommen HEUTE berechnen
            const netToday = type === 'net' ? incomeInput : (incomeInput * 0.70);

            // Zukünftiges Nettoeinkommen mit 2% Wachstum p.a. berechnen
            const yearsToBuEntry = Math.max(0, entryAge - age);
            const netAtBuEntry = netToday * Math.pow(1 + growth, yearsToBuEntry);

            // Einfaches BU-Pensionsmodell
            const buPensionFactor = (job) => {
                if (job === 'ang') return 0.60;
                if (job === 'arb') return 0.55;
                return 0.50;
            };
            const factor = buPensionFactor(job);
            
            // Staatliche Pension HEUTE berechnen
            const buPensionToday = Math.max(0, netToday * factor);
            // Zukünftige staatliche Pension mit 1% Wachstum p.a. berechnen
            const buMonthly = buPensionToday * Math.pow(1 + 0.01, yearsToBuEntry);

            // Monatliche Lücke
            const gapMonthly = Math.max(0, netAtBuEntry - buMonthly);

            // Jahre bis Pension vom Eintrittszeitpunkt
            const yearsToRet = Math.max(0, retAge - entryAge);
            const monthsToRet = yearsToRet * 12;

            // Gesamtlücke (vereinfacht, ohne Abzinsung/Aufwertung)
            const totalGap = gapMonthly * monthsToRet;

            // KPIs befüllen
            document.getElementById('bu-result-pension').textContent = fmt(buMonthly);
            document.getElementById('bu-result-gap-month').textContent = fmt(gapMonthly);
            document.getElementById('bu-result-gap-total').textContent = fmt(totalGap);

            // NEU: ApexCharts-Balkendiagramm erstellen oder aktualisieren
            const chartOptions = {
                series: [{
                    name: 'Geschätzte BU-Staatspension',
                    data: [Math.round(buMonthly)]
                }, {
                    name: 'Monatliche Lücke',
                    data: [Math.round(gapMonthly)]
                }],
                chart: {
                    type: 'bar',
                    height: 120,
                    stacked: true,
                    stackType: '100%',
                    toolbar: { show: false },
                    foreColor: '#e2e8f0'
                },
                plotOptions: {
                    bar: {
                        horizontal: true,
                        borderRadius: 4, // NEU: Fügt abgerundete Ecken hinzu
                    },
                },
                stroke: { width: 1, colors: ['#043C64'] },
                xaxis: {
                    categories: [''],
                    labels: { show: false },
                    axisBorder: { show: false },
                    axisTicks: { show: false }
                },
                yaxis: { labels: { show: false } },
                tooltip: {
                    theme: 'dark',
                    y: { formatter: (val) => fmt(val) }
                },
                grid: { show: false },
                colors: ['#27ae60', '#FF6347'], // Grün für Pension, Rot für Lücke
                legend: { show: false },
                dataLabels: { enabled: false }, // KORREKTUR: Beschriftungen im Balken entfernt
                title: {
                    text: `Gesamteinkommen: ${fmt(netAtBuEntry)}`,
                    align: 'center',
                    style: { fontSize: '14px', fontWeight: 'bold', color: '#fff' }
                }
            };

            if (!chart) {
                chart = new ApexCharts(document.querySelector("#bu-chart-container"), chartOptions);
                chart.render();
            } else {
                chart.updateOptions(chartOptions);
            }
        };

        // Event Listeners
        [...incomeTypeToggle.querySelectorAll('button')].forEach(b => {
            b.addEventListener('click', () => {
                b.parentElement.querySelectorAll('button').forEach(x => x.classList.remove('active'));
                b.classList.add('active');
                calc();
            });
        });

        allInputs.forEach(s => {
            const el = document.querySelector(s);
            if (el) {
                el.addEventListener('input', () => {
                    if (s === '#bu-entry-age') {
                        document.getElementById('bu-age-now').textContent = el.value;
                    }
                    calc();
                });
            }
        });

        calc(); // Initial calculation
    }

    // Erwerbspotentialrechner-Funktion (kopiert aus beratung_standalone.js)
    function initErwerbspotentialRechner() {
        const fmt = (v) => new Intl.NumberFormat('de-AT', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 }).format(v || 0);
        
        let chart = null;
        const allInputs = ['#ep-birth', '#ep-job', '#ep-growth']; // KORREKTUR: Brutto/Netto werden separat behandelt
        const grossInput = document.getElementById('ep-gross');
        const netInput = document.getElementById('ep-net');

        // NEU: Logik zur Kopplung von Brutto- und Netto-Eingabefeldern
        const updateNetto = () => {
            const grossValue = parseFloat(grossInput.value) || 0;
            netInput.value = Math.round(grossValue * 0.70); // Einfache Brutto-Netto-Näherung
            draw();
        };
        const updateBrutto = () => {
            const netValue = parseFloat(netInput.value) || 0;
            grossInput.value = Math.round(netValue / 0.70); // Einfache Netto-Brutto-Näherung
            draw();
        };

        grossInput.addEventListener('input', _.debounce(updateNetto, 250));
        netInput.addEventListener('input', _.debounce(updateBrutto, 250));

        const draw = () => {
            const birth = new Date(document.getElementById('ep-birth').value || '1995-12-11');
            const net0 = parseFloat(netInput.value || 0);
            const g = parseFloat(document.getElementById('ep-growth').value || 0);

            // Jahre bis zur Rente berechnen
            const now = new Date();
            let age = now.getFullYear() - birth.getFullYear();
            const m = now.getMonth() - birth.getMonth();
            if (m < 0 || (m === 0 && now.getDate() < birth.getDate())) age--;
            const years = Math.max(0, 65 - age);

            // Datenreihen aufbauen
            const buildSeries = (startNet, growth, numYears) => {
                const pts = [];
                let sum = 0;
                for (let t = 0; t <= numYears; t++) {
                    const netY = startNet * Math.pow(1 + growth, t) * 12;
                    if (t > 0) sum += netY;
                    pts.push({ t, sum });
                }
                return pts;
            };

            const s1 = buildSeries(net0, g, years); // mit Wachstum

            const total = s1[s1.length - 1]?.sum || 0;
            document.getElementById('ep-sum').textContent = fmt(total);

            // Chart-Optionen
            const chartOptions = {
                series: [{ // KORREKTUR: Nur noch eine Serie anzeigen
                    name: 'Mit Karriereverlauf',
                    data: s1.map(p => Math.round(p.sum))
                }],
                chart: {
                    type: 'area',
                    height: 350,
                    foreColor: '#e2e8f0',
                    toolbar: { show: false },
                    zoom: { enabled: false }
                },
                colors: ['#3b82f6'], // KORREKTUR: Nur noch eine Farbe
                dataLabels: { enabled: false },
                stroke: {
                    curve: 'smooth',
                    width: 3,
                },
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.4,
                        opacityTo: 0.1,
                        stops: [0, 100]
                    }
                },
                xaxis: {
                    categories: s1.map(p => p.t),
                    title: { text: 'Jahre ab heute', style: { color: '#9ca3af' } },
                    labels: {
                        formatter: (val) => (parseInt(val) % 5 === 0) ? val : ''
                    }
                },
                yaxis: {
                    title: { text: 'Gesamteinkommen', style: { color: '#9ca3af' } },
                    labels: { formatter: (val) => `${(val / 1000).toFixed(0)}k €` }
                },
                tooltip: {
                    theme: 'dark',
                    x: { formatter: (val) => `Nach ${val} Jahren` },
                    y: { formatter: (val) => fmt(val) }
                },
                legend: { show: false }, // KORREKTUR: Legende ausblenden, da nur eine Serie
                grid: { borderColor: 'rgba(255,255,255,0.1)', strokeDashArray: 4 }
            };

            const chartContainer = document.getElementById('ep-chart-container');
            if (!chart) {
                chart = new ApexCharts(chartContainer, chartOptions);
                chart.render();
            } else {
                chart.updateOptions(chartOptions);
            }
        };

        allInputs.forEach(s => {
            const el = document.querySelector(s);
            if (el) el.addEventListener('input', _.debounce(draw, 250));
        });

        draw(); // Initialer Aufruf
    }

    // Finanzierungsrechner/Kreditrechner-Funktion (kopiert aus beratung_standalone.js)
    function initKreditrechner() {
        const qs = (s) => document.querySelector(s);
        const eur = (v) => new Intl.NumberFormat('de-AT', { style: 'currency', currency: 'EUR' }).format(+v || 0);
        const pct = (v, dp = 1) => (+v).toFixed(dp).replace('.', ',') + ' % p.a.';
        const parseMoney = (s) => +String(s).replace(/[^0-9,.-]/g, '').replace(',', '.');
        const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

        const amountRange = qs('#kr-amountRange');
        const amountInput = qs('#kr-amountInput');
        const yearsRange = qs('#kr-yearsRange');
        const yearsInput = qs('#kr-yearsInput');

        if (!amountRange || !amountInput || !yearsRange || !yearsInput) return;

        const recalc = () => {
            const P = +amountRange.value;
            const years = +yearsRange.value;
            const n = years * 12;
            const i_m = (+qs('#kr-ratePA').value) / 100 / 12;
            const tilg = qs('#kr-tilgung').value;

            let M;
            if (tilg === 'ann') {
                M = (i_m <= 0) ? P / n : P * i_m / (1 - Math.pow(1 + i_m, -n));
            } else {
                M = (P / n) + (P * i_m); // First rate for linear
            }

            const payout = P;
            let total;
            if (tilg === 'ann') {
                total = M * n;
            } else {
                let sum = 0, rest = P;
                for (let m = 1; m <= n; m++) {
                    const z = rest * i_m;
                    const t = P / n;
                    sum += z + t;
                    rest -= t;
                }
                total = sum;
                M = sum / n; // Average rate for display
            }

            const irrMonthly = (cashflows) => {
                const npv = (r) => cashflows.reduce((acc, cf, t) => acc + cf / Math.pow(1 + r, t), 0);
                let lo = 0, hi = 1, flo = npv(lo), fhi = npv(hi);
                if (flo * fhi > 0) {
                    for (let k = 0; k < 60 && fhi > 0; k++) { hi *= 1.5; fhi = npv(hi); }
                    if (flo * fhi > 0) return NaN;
                }
                for (let it = 0; it < 200; it++) {
                    const mid = (lo + hi) / 2, fmid = npv(mid);
                    if (Math.abs(fmid) < 1e-6) return mid;
                    if (flo * fmid > 0) { lo = mid; flo = fmid; } else { hi = mid; }
                }
                return (lo + hi) / 2;
            };

            const flows = Array(n + 1).fill(0);
            flows[0] = payout;
            for (let m = 1; m <= n; m++) flows[m] -= M;
            const r_m = irrMonthly(flows);
            const apr = isNaN(r_m) ? null : (Math.pow(1 + r_m, 12) - 1);

            qs('#kr-kpiRate').textContent = eur(M);
            const breakdownContainer = qs('#kr-breakdown-container');
            breakdownContainer.innerHTML = `
                <h3 class="text-xl font-bold text-white mb-4">Berechnungsbeispiel:</h3>
                <div class="space-y-3 text-gray-300">
                    <div class="flex justify-between"><span>Kreditbetrag:</span><span class="font-semibold text-white">${eur(P)}</span></div>
                    <div class="flex justify-between"><span>Laufzeit:</span><span class="font-semibold text-white">${years} Jahre</span></div>
                    <div class="flex justify-between"><span>Sollzinssatz, variabel:</span><span class="font-semibold text-white">${pct(+qs('#kr-ratePA').value, 3)}</span></div>
                    <div class="flex justify-between"><span>Auszahlungsbetrag:</span><span class="font-semibold text-white">${eur(payout)}</span></div>
                    <div class="flex justify-between"><span>Effektivzinssatz:</span><span class="font-semibold text-white">${(apr == null ? '–' : ((apr * 100).toFixed(1).replace('.', ',') + ' % p.a.'))}</span></div>
                    <div class="flex justify-between text-lg"><span>Zu zahlender Gesamtbetrag:</span><span class="font-bold text-white">${eur(total)}</span></div>
                </div>
                <p class="text-xs text-gray-400 mt-6">Hinweis: Zusätzliche Kosten wie Schätzgebühren, Grundbuchseintragungen oder Kontoführungsgebühren sind hier <strong>nicht</strong> berücksichtigt, da diese von Bank zu Bank unterschiedlich ausfallen können.</p>
            `;
        };

        const syncAmount = (from) => {
            if (from === 'range') amountInput.value = eur(amountRange.value);
            else { const v = clamp(parseMoney(amountInput.value), 50000, 3000000); amountRange.value = v; amountInput.value = eur(v); }
            recalc();
        };
        const syncYears = (from) => {
            if (from === 'range') yearsInput.value = yearsRange.value + ' Jahre';
            else { const v = clamp(parseInt((yearsInput.value || '').replace(/\D/g, '')) || 25, 10, 35); yearsRange.value = v; yearsInput.value = v + ' Jahre'; }
            recalc();
        };

        amountRange.oninput = () => syncAmount('range');
        amountInput.onchange = () => syncAmount('input');
        yearsRange.oninput = () => syncYears('range');
        yearsInput.onchange = () => syncYears('input');
        document.querySelectorAll('[data-step]').forEach(btn => {
            btn.onclick = () => {
                if (btn.closest('div').querySelector('#kr-amountInput')) {
                    const v = clamp(+amountRange.value + (+btn.dataset.step), 50000, 3000000); amountRange.value = v; syncAmount('range');
                } else {
                    const v = clamp(+yearsRange.value + (+btn.dataset.step), 10, 35); yearsRange.value = v; syncYears('range');
                }
            };
        });
        ['#kr-ratePA', '#kr-tilgung'].forEach(id => qs(id).oninput = recalc);

        syncAmount('range');
        syncYears('range');
    }

    // Leasingrechner-Funktion (kopiert aus beratung_standalone.js)
    function initLeasingrechner() {
        const qs = (s) => document.querySelector(s);
        const fmtEUR = (v) => new Intl.NumberFormat('de-AT', { style: 'currency', currency: 'EUR' }).format(+v || 0);
        const fmtMoney = (v) => fmtEUR(v);

        function parseMoney(str) {
            const raw = String(str || '').trim();
            if (!raw) return 0;
            let keep = '';
            for (let i = 0; i < raw.length; i++) {
                const ch = raw[i];
                if ((ch >= '0' && ch <= '9') || ch === '-' || ch === ',' || ch === '.') keep += ch;
            }
            keep = keep.split('.').join(''); // remove thousands
            const lastComma = keep.lastIndexOf(',');
            if (lastComma !== -1) keep = keep.slice(0, lastComma) + '.' + keep.slice(lastComma + 1);
            const num = parseFloat(keep);
            return Number.isFinite(num) ? num : 0;
        }

        function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

        // Elemente
        const priceInput = qs('#leasing-priceInput');
        const downRange = qs('#leasing-downRange');
        const downInput = qs('#leasing-downInput');
        const termRange = qs('#leasing-termRange');
        const termInput = qs('#leasing-termInput');
        const rvRange = qs('#leasing-rvRange');
        const rvInput = qs('#leasing-rvInput');
        const ratePA = qs('#leasing-ratePA');

        const downMinL = qs('#leasing-downMinL');
        const downMaxL = qs('#leasing-downMaxL');
        const rvMinL = qs('#leasing-rvMinL');
        const rvMaxL = qs('#leasing-rvMaxL');

        function setPrice(v) {
            const P = clamp(v, 1000, 1000000);
            priceInput.value = fmtMoney(P);
            const downMin = 0;
            const downMax = Math.round(P);
            downRange.min = downMin;
            downRange.max = downMax;
            downMinL.textContent = fmtMoney(downMin);
            downMaxL.textContent = fmtMoney(downMax);

            const rvMin = 0;
            const rvMax = Math.round(P * 0.60);
            rvRange.min = rvMin;
            rvRange.max = rvMax;
            rvMinL.textContent = fmtMoney(rvMin);
            rvMaxL.textContent = fmtMoney(rvMax);

            if (parseMoney(downInput.value) > downMax) downInput.value = fmtMoney(downMax);
            if (parseMoney(rvInput.value) > rvMax) rvInput.value = fmtMoney(rvMax);

            recalc();
        }

        function annuityBalloonRate(Principal, RV, i_m, n) {
            if (n <= 0) return 0;
            if (i_m <= 0) {
                return (Principal - RV) / n;
            }
            const pvRV = RV / Math.pow(1 + i_m, n);
            const base = (Principal - pvRV);
            return base * (i_m / (1 - Math.pow(1 + i_m, -n)));
        }

        function recalc() {
            const price = parseMoney(priceInput.value) || 0;
            const down = clamp(parseMoney(downInput.value), +downRange.min, +downRange.max);
            const term = clamp(parseInt(termInput.value) || 36, +termRange.min, +termRange.max);
            const rv = clamp(parseMoney(rvInput.value), +rvRange.min, +rvRange.max);

            downInput.value = fmtMoney(down);
            downRange.value = down;
            termInput.value = term + ' Monate';
            termRange.value = term;
            rvInput.value = fmtMoney(rv);
            rvRange.value = rv;

            const principal = Math.max(0, price - down);
            const i_m = ((+ratePA.value) || 0) / 100 / 12;

            let M = annuityBalloonRate(principal, rv, i_m, term);
            if (!Number.isFinite(M)) M = 0;
            const total = down + M * term + rv;

            qs('#leasing-kpiRate').textContent = M.toFixed(2).replace('.', ',');
            qs('#leasing-kpiTotal').textContent = total.toFixed(2).replace('.', ',');
        }

        // Event Listeners
        priceInput.addEventListener('change', () => setPrice(parseMoney(priceInput.value)));

        [downRange, rvRange, termRange].forEach(r => r.addEventListener('input', () => {
            if (r === downRange) downInput.value = fmtMoney(+downRange.value);
            if (r === rvRange) rvInput.value = fmtMoney(+rvRange.value);
            if (r === termRange) termInput.value = (+termRange.value) + ' Monate';
            recalc();
        }));

        [downInput, rvInput].forEach(inp => inp.addEventListener('change', recalc));
        termInput.addEventListener('change', () => {
            const v = parseInt(termInput.value) || 36;
            termRange.value = clamp(v, +termRange.min, +termRange.max);
            recalc();
        });
        ratePA.addEventListener('input', recalc);

        document.querySelectorAll('[data-step]').forEach(btn => {
            btn.addEventListener('click', () => {
                const step = +btn.dataset.step;
                const field = btn.parentElement.querySelector('input');
                if (field === downInput) {
                    const v = clamp(parseMoney(downInput.value) + step, +downRange.min, +downRange.max);
                    downRange.value = v;
                    downInput.value = fmtMoney(v);
                } else if (field === rvInput) {
                    const v = clamp(parseMoney(rvInput.value) + step, +rvRange.min, +rvRange.max);
                    rvRange.value = v;
                    rvInput.value = fmtMoney(v);
                } else if (field === termInput) {
                    const v = clamp((parseInt(termInput.value) || 36) + step, +termRange.min, +termRange.max);
                    termRange.value = v;
                    termInput.value = v + ' Monate';
                }
                recalc();
            });
        });

        // Initialisierung mit Beispielwerten
        setPrice(40000);
        downRange.value = 8000;
        downInput.value = fmtMoney(8000);
        termRange.value = 36;
        termInput.value = '36 Monate';
        rvRange.value = 17225;
        rvInput.value = fmtMoney(17225);
        ratePA.value = 4.90;
        recalc();
    }

    // Steuervorteilrechner-Funktion (kopiert aus beratung_standalone.js)
    function initSteuervorteilrechner() {
        const container = document.getElementById('steuer-chart-container');
        const sparrateInput = document.getElementById('steuer-sparrate');
        const dauerInput = document.getElementById('steuer-dauer');
        const renditeInput = document.getElementById('steuer-rendite');
        const kestToggle = document.getElementById('steuer-kest');
        const startwertInput = document.getElementById('steuer-startwert');

        if (!container || !sparrateInput || !dauerInput || !renditeInput || !kestToggle || !startwertInput) return;

        const renderChart = () => {
            const startwert = parseFloat(startwertInput.value) || 0;
            const monthlySavings = parseFloat(sparrateInput.value) || 0;
            const years = parseInt(dauerInput.value) || 0;
            const annualReturn = (parseFloat(renditeInput.value) || 0) / 100;
            const considerKest = kestToggle.checked;

            const categories = Array.from({ length: years }, (_, i) => `Jahr ${i + 1}`);
            const seriesData = { einzahlung: [], fondsdepot: [], flv: [] };

            let totalEinzahlung = startwert;
            let kapitalMitKest = startwert;
            let totalKest = 0;
            const annualSavings = monthlySavings * 12;
            let flvKapital = startwert;

            for (let i = 1; i <= years; i++) {
                totalEinzahlung += annualSavings;
                const prevKapitalMitKest = kapitalMitKest;
                kapitalMitKest = (kapitalMitKest + annualSavings) * (1 + annualReturn);
                const gain = kapitalMitKest - prevKapitalMitKest - annualSavings;
                const kest = considerKest && gain > 0 ? gain * 0.275 : 0;
                kapitalMitKest -= kest;
                totalKest += kest;

                const isInitialPhase = i <= 5;
                const flvNetAnnualSavings = isInitialPhase ? annualSavings * 0.70 : annualSavings;
                flvKapital = (flvKapital + flvNetAnnualSavings) * (1 + annualReturn);

                seriesData.einzahlung.push(Math.round(totalEinzahlung));
                seriesData.fondsdepot.push(Math.round(kapitalMitKest));
                seriesData.flv.push(Math.round(flvKapital));
            }

            document.getElementById('steuer-output-einzahlung').textContent = `${totalEinzahlung.toLocaleString('de-DE')} €`;
            const gesamtrendite = flvKapital - totalEinzahlung;
            document.getElementById('steuer-output-rendite').textContent = `${gesamtrendite.toLocaleString('de-DE', {maximumFractionDigits: 0})} €`;
            document.getElementById('steuer-output-kest').textContent = `-${totalKest.toLocaleString('de-DE', {maximumFractionDigits: 0})} €`;
            document.getElementById('steuer-output-endbetrag').textContent = `${kapitalMitKest.toLocaleString('de-DE', {maximumFractionDigits: 0})} €`;

            const options = {
                series: [{
                    name: 'Eingezahlt', 
                    type: 'column', 
                    data: seriesData.einzahlung
                }, {
                    name: 'Fondsdepot (nach KESt)', 
                    type: 'column', 
                    data: seriesData.fondsdepot
                }, {
                    name: 'FLV (KESt-frei)', 
                    type: 'column', 
                    data: seriesData.flv
                }],
                chart: { 
                    height: 450, 
                    type: 'line', 
                    stacked: false, 
                    foreColor: '#e2e8f0', 
                    toolbar: { show: false } 
                },
                stroke: { 
                    width: [0, 0, 3], 
                    curve: 'smooth' 
                },
                plotOptions: { 
                    bar: { columnWidth: '60%' } 
                },
                colors: ['#a0aec0', '#f1c40f', '#27ae60'],
                xaxis: {
                    categories: categories,
                    title: { text: 'Jahre', style: { color: '#9ca3af' } },
                    labels: {
                        formatter: (val) => {
                            if (typeof val !== 'string') return '';
                            return (parseInt(val.replace('Jahr ', '')) % 5 === 0 || val === 'Jahr 1') ? val.replace('Jahr ', '') : '';
                        }
                    }
                },
                yaxis: { 
                    title: { text: 'Vermögen in €', style: { color: '#9ca3af' } }, 
                    labels: { formatter: (val) => `${(val / 1000).toFixed(0)}k` } 
                },
                dataLabels: { enabled: false },
                tooltip: { 
                    theme: 'dark', 
                    shared: true, 
                    intersect: false, 
                    y: { formatter: (val) => `${val.toLocaleString('de-DE')} €` } 
                },
                legend: { 
                    position: 'top', 
                    horizontalAlign: 'center' 
                },
                grid: { 
                    borderColor: 'rgba(255,255,255,0.1)',
                    strokeDashArray: 4
                }
            };

            container.innerHTML = '';
            const chart = new ApexCharts(container, options);
            chart.render();
        };

        renderChart();

        const debouncedRender = _.debounce(renderChart, 300);
        [startwertInput, sparrateInput, dauerInput, renditeInput, kestToggle].forEach(input => {
            input.addEventListener('input', debouncedRender);
        });
    }

    // Metadaten der Tabelle "Analysen" beim Laden der Seite ausgeben
    async function getAnalysenMetadata() {
        try {
            console.log('🔍 Lade Metadaten der Tabelle "Analysen"...');
            
            // SeaTable Access Token holen falls nicht vorhanden
            if (!seaTableAccessToken || !apiGatewayUrl) {
                await getSeaTableAccessToken();
            }
            
            // Metadaten abrufen
            const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/metadata/`;
            const response = await fetch(url, { 
                headers: { Authorization: `Bearer ${seaTableAccessToken}` } 
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            
            // Tabelle "Analysen" finden
            const analysenTable = data.metadata.tables.find(table => 
                table.name.toLowerCase() === 'analysen'
            );
            
            if (analysenTable) {
                console.log('📊 Metadaten der Tabelle "Analysen":');
                console.log('='.repeat(50));
                console.log(`Tabellen-Name: ${analysenTable.name}`);
                console.log(`Tabellen-ID: ${analysenTable._id}`);
                console.log(`Anzahl Spalten: ${analysenTable.columns.length}`);
                console.log('');
                
                console.log('📋 Spalten-Details:');
                analysenTable.columns.forEach((column, index) => {
                    console.log(`${index + 1}. ${column.name}`);
                    console.log(`   - Typ: ${column.type}`);
                    console.log(`   - Key: ${column.key}`);
                    if (column.data) {
                        console.log(`   - Optionen: ${JSON.stringify(column.data)}`);
                    }
                    console.log('');
                });
                
                console.log('='.repeat(50));
                
                // Auch auf der Seite anzeigen (optional)
                if (window.location.search.includes('debug=true')) {
                    const debugDiv = document.createElement('div');
                    debugDiv.style.cssText = `
                        position: fixed; 
                        top: 10px; 
                        right: 10px; 
                        background: rgba(0,0,0,0.8); 
                        color: white; 
                        padding: 10px; 
                        border-radius: 5px; 
                        max-width: 300px; 
                        font-family: monospace; 
                        font-size: 12px; 
                        z-index: 9999;
                        max-height: 400px;
                        overflow-y: auto;
                    `;
                    debugDiv.innerHTML = `
                        <strong>Analysen-Tabelle Metadaten:</strong><br>
                        Spalten: ${analysenTable.columns.length}<br>
                        ${analysenTable.columns.map(col => `• ${col.name} (${col.type})`).join('<br>')}
                    `;
                    document.body.appendChild(debugDiv);
                }
                
            } else {
                console.warn('⚠️ Tabelle "Analysen" nicht gefunden!');
                console.log('Verfügbare Tabellen:');
                data.metadata.tables.forEach(table => {
                    console.log(`- ${table.name}`);
                });
            }
            
        } catch (error) {
            console.error('❌ Fehler beim Laden der Analysen-Metadaten:', error);
        }
    }

    // Metadaten beim Laden der Seite abrufen
    window.addEventListener('load', () => {
        console.log('🚀 Seite geladen - lade Analysen-Metadaten...');
        
        // Starte Zeitdauer-Messung
        presentationStartTime = new Date();
        console.log('⏱️ Präsentations-Timer gestartet um:', presentationStartTime.toLocaleTimeString());
        
        getAnalysenMetadata();
        
        // Auto-Save-Listener aktivieren
        addAutoSaveListener();
        console.log('💾 Auto-Save für Folie 20 aktiviert');
    });

    // === ZUSÄTZLICHE SEATABLE-SPEICHERFUNKTIONEN (aus main.js kopiert) ===
    
    // Link-Feld aktualisieren (spezifisch für Termine <-> Mitarbeiter)
    async function seaTableUpdateLinkField(terminRowId, mitarbeiterRowId) {
        if (!seaTableAccessToken || !apiGatewayUrl) return false;
        try {
            const termineTableMeta = METADATA.tables.find((t) => t.name === "Termine");
            const mitarbeiterTableMeta = METADATA.tables.find((t) => t.name === "Mitarbeiter");
            if (!termineTableMeta || !mitarbeiterTableMeta) throw new Error("Could not find 'Termine' or 'Mitarbeiter' table in metadata.");

            const linkColumnMeta = termineTableMeta.columns.find((c) => c.name === "Mitarbeiter_ID");
            if (!linkColumnMeta || !linkColumnMeta.data || !linkColumnMeta.data.link_id) throw new Error("Could not find 'link_id' for 'Mitarbeiter_ID' column.");

            const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/links/`;
            const body = {
                table_id: termineTableMeta._id,
                other_table_id: mitarbeiterTableMeta._id,
                link_id: linkColumnMeta.data.link_id,
                other_rows_ids_map: {
                    [terminRowId]: mitarbeiterRowId ? [mitarbeiterRowId] : [],
                },
            };

            console.log("[API-LINK-UPDATE] PUT /links Payload:", JSON.stringify(body, null, 2));

            const response = await fetch(url, {
                method: "PUT",
                headers: {
                    Authorization: `Bearer ${seaTableAccessToken}`,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(body),
            });
            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Link update failed: ${response.status} ${errorText}`);
            }
            console.log("[API-LINK-UPDATE] Link updated successfully.");
            return true;
        } catch (error) {
            console.error("Error updating link field:", error);
            return false;
        }
    }

    // Zeile hinzufügen (Hauptfunktion für alle Tabellen)
    async function seaTableAddRow(tableName, rowData) {
        // Neuer, effizienter Ansatz basierend auf dem Skript des Benutzers:
        // 1. Daten für die Verknüpfung (Mitarbeiter_ID) von den restlichen Daten trennen.
        // 2. Spalten-Keys in Spalten-NAMEN umwandeln, da der /rows Endpunkt Namen erwartet.
        // 3. Eine neue Zeile mit den umgewandelten Daten erstellen.
        // 4. Die Verknüpfung in einem separaten Schritt über die Links-API setzen.
        console.log("[ADD-ROW-NEW] Starting new add-row process.");

        if (!seaTableAccessToken || !apiGatewayUrl) {
            console.error("Cannot add row without access token and gateway URL.");
            return false;
        }

        // --- SCHRITT 1: Daten vorbereiten (Link trennen, Keys in Namen umwandeln) ---
        const tableMap = COLUMN_MAPS[tableName.toLowerCase()];
        if (!tableMap) {
            console.error(`[ADD-ROW-NEW] Column map for table '${tableName}' not found.`);
            return false;
        }
        const tableMeta = METADATA.tables.find(t => t.name.toLowerCase() === tableName.toLowerCase());
        const linkColumns = tableMeta ? tableMeta.columns.filter(c => c.type === 'link') : [];

        const linkData = {};
        const rowDataForCreation = { ...rowData };

        linkColumns.forEach(col => {
            if (rowDataForCreation[col.key]) {
                linkData[col.name] = rowDataForCreation[col.key][0]; // Store by name for updateSingleLink
                delete rowDataForCreation[col.key];
            }
        });

        // KORREKTUR: Der 'rows' Endpunkt erwartet Spalten-NAMEN, nicht Spalten-Keys.
        // Wir müssen die Keys (z.B. '0000') in Namen (z.B. 'Terminpartner') umwandeln.
        const reversedMap = Object.fromEntries(Object.entries(tableMap).map(([name, key]) => [key, name]));

        const rowDataWithNames = {};
        for (const key in rowDataForCreation) {
            const name = reversedMap[key];
            if (name) {
                // API erwartet `null` für leere Felder, nicht `undefined`
                const value = rowDataForCreation[key];
                rowDataWithNames[name] = (value === undefined || value === '') ? null : value;
            } else if (key !== '_id') {
                console.warn(`[ADD-ROW-NEW] No column name found for key: ${key}`);
            }
        }

        let newRowId = null;

        // --- SCHRITT 2: Zeile mit den meisten Daten anlegen ---
        try {
            // Wir verwenden den "Append rows" (plural) Endpunkt, wie im Skript des Benutzers.
            const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/rows/`;
            const body = { table_name: tableName, rows: [rowDataWithNames] }; // KORREKTUR: rowDataWithNames verwenden

            console.log(`[ADD-ROW-NEW] Step 1: Creating row. POST to ${url}`);
            console.log(`[ADD-ROW-NEW] Step 1 Body:`, JSON.parse(JSON.stringify(body)));

            const response = await fetch(url, { method: "POST", headers: { Authorization: `Bearer ${seaTableAccessToken}`, "Content-Type": "application/json" }, body: JSON.stringify(body) });
            const responseText = await response.text();
            console.log(`[ADD-ROW-NEW] Step 1 Response Status: ${response.status}`);
            console.log(`[ADD-ROW-NEW] Step 1 Response Body:`, responseText);
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}, message: ${responseText}`);
            }

            const result = JSON.parse(responseText);
            if (!result || !result.row_ids || result.row_ids.length === 0) {
                // Falls die API einen 200 OK mit einer Fehlermeldung zurückgibt (z.B. bei falschem Spaltennamen)
                const errorMessage = result.error_message || "API did not return a valid new row ID in 'row_ids' array.";
                throw new Error(errorMessage);
            }
            // KORREKTUR: Die API gibt ein Array von Objekten zurück, wir brauchen die _id Eigenschaft daraus.
            // Dein Skript hat dies korrekt gezeigt: `data.row_ids[0]._id`
            newRowId = result.row_ids[0]?._id;
            if (!newRowId) {
                throw new Error("API response for new row is malformed, missing _id in row_ids[0].");
            }
            console.log(`[ADD-ROW-NEW] Step 1 Success: Created row with _id: ${newRowId}`);
        } catch (error) {
            console.error("[ADD-ROW-NEW] Step 1 FAILED: Could not create initial row.", error);
            return false;
        }

        // --- SCHRITT 3: Verknüpfungen setzen ---
        for (const colName in linkData) {
            if (linkData[colName]) {
                console.log(`[ADD-ROW-NEW] Step 2: Linking ${colName} ${linkData[colName]} to new row ${newRowId}.`);
                const linkSuccess = await updateSingleLink(tableName, newRowId, colName, [linkData[colName]]);
                if (!linkSuccess) {
                    console.error(`[ADD-ROW-NEW] Step 2 FAILED: Could not link ${colName} to the new row.`);
                    return false; // Fehler, wenn die Verknüpfung fehlschlägt.
                }
                console.log(`[ADD-ROW-NEW] Step 2 Success: ${colName} linked.`);
            }
        }

        console.log(`[ADD-ROW-NEW] Process finished successfully. Returning new row ID: ${newRowId}`);
        return newRowId;
    }

    // Zeile aktualisieren (für Textfelder und andere nicht-Link Felder)
    async function seaTableUpdateRow(tableName, rowId, updateData) {
        if (!seaTableAccessToken || !apiGatewayUrl) {
            console.error("Cannot update row without access token and gateway URL.");
            return false;
        }

        try {
            console.log(`[UPDATE-ROW] Updating row ${rowId} in table ${tableName}`);
            console.log(`[UPDATE-ROW] Update data:`, updateData);

            // API erwartet Spalten-Namen, nicht Keys - aber updateData enthält bereits Keys
            // Für diesen speziellen Fall (Analyst-Feld) verwenden wir direkt den Key
            const tableMap = COLUMN_MAPS[tableName.toLowerCase()];
            if (!tableMap) {
                console.error(`[UPDATE-ROW] Column map for table '${tableName}' not found.`);
                return false;
            }

            // Keys in Namen umwandeln
            const reversedMap = Object.fromEntries(Object.entries(tableMap).map(([name, key]) => [key, name]));
            const updateDataWithNames = {};
            
            for (const key in updateData) {
                const name = reversedMap[key];
                if (name) {
                    updateDataWithNames[name] = updateData[key];
                } else {
                    console.warn(`[UPDATE-ROW] No column name found for key: ${key}`);
                }
            }

            const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/rows/`;
            const body = {
                table_name: tableName,
                row_id: rowId,
                row: updateDataWithNames
            };

            const response = await fetch(url, {
                method: "PUT",
                headers: {
                    Authorization: `Bearer ${seaTableAccessToken}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(body)
            });

            if (!response.ok) {
                const responseText = await response.text();
                throw new Error(`HTTP error! status: ${response.status}, message: ${responseText}`);
            }

            console.log(`[UPDATE-ROW] Successfully updated row ${rowId}`);
            return true;

        } catch (error) {
            console.error("[UPDATE-ROW] Failed to update row:", error);
            return false;
        }
    }

    // Einzelne Link-Verbindung aktualisieren (generische Funktion)
    async function updateSingleLink(baseTableName, baseRowId, linkColumnName, otherRowIds) {
        if (!seaTableAccessToken || !apiGatewayUrl) return false;
        try {
            const baseTableMeta = METADATA.tables.find(t => t.name.toLowerCase() === baseTableName.toLowerCase());
            if (!baseTableMeta) throw new Error(`Could not find metadata for table '${baseTableName}'`);

            const linkColumnMeta = baseTableMeta.columns.find(c => c.name === linkColumnName);
            if (!linkColumnMeta || !linkColumnMeta.data || !linkColumnMeta.data.link_id) throw new Error(`Could not find link metadata for column '${linkColumnName}' in table '${baseTableName}'`);

            const otherTableId = linkColumnMeta.data.other_table_id;

            const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/links/`;
            const body = {
                table_id: baseTableMeta._id,
                other_table_id: otherTableId,
                link_id: linkColumnMeta.data.link_id,
                other_rows_ids_map: {
                    [baseRowId]: Array.isArray(otherRowIds) ? otherRowIds.filter(Boolean) : (otherRowIds ? [otherRowIds] : [])
                }
            };
            
            console.log(`[API-LINK-UPDATE] Updating link for ${linkColumnName}. Payload:`, body);
            const response = await fetch(url, { method: 'PUT', headers: { Authorization: `Bearer ${seaTableAccessToken}`, 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            if (!response.ok) {
                throw new Error(`Link update for ${linkColumnName} failed: ${response.status} ${await response.text()}`);
            }
            return true;
        } catch (error) {
            console.error(`Error updating link for ${linkColumnName}:`, error);
            return false;
        }
    }

    // Hilfsfunktion: Spalten-Maps von SeaTable dynamisch laden
    async function getColumnMaps() {
        try {
            // SeaTable Access Token holen falls nicht vorhanden
            if (!seaTableAccessToken || !apiGatewayUrl) {
                await getSeaTableAccessToken();
            }
            
            // Metadaten abrufen
            const url = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/metadata/`;
            const response = await fetch(url, { 
                headers: { Authorization: `Bearer ${seaTableAccessToken}` } 
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            const columnMaps = {};
            
            if (data && data.metadata && data.metadata.tables) {
                data.metadata.tables.forEach((table) => {
                    columnMaps[table.name.toLowerCase()] = {};
                    table.columns.forEach((col) => { 
                        columnMaps[table.name.toLowerCase()][col.name] = col.key; 
                    });
                });
            }
            
            return columnMaps;
        } catch (error) {
            console.error('❌ Fehler beim Laden der Spalten-Maps:', error);
            return {};
        }
    }

    // Beispiel-Funktion zum Speichern von Analyse-Daten
    async function saveAnalyseData(analyseData) {
        try {
            console.log('💾 Speichere Analyse-Daten in SeaTable...');
            
            // Spalten-Maps laden falls noch nicht vorhanden
            if (!COLUMN_MAPS.analysen) {
                COLUMN_MAPS = await getColumnMaps();
            }
            
            // Daten an die Tabelle "Analysen" senden
            const newRowId = await seaTableAddRow('Analysen', analyseData);
            
            if (newRowId) {
                console.log('✅ Analyse-Daten erfolgreich gespeichert mit ID:', newRowId);
                return newRowId;
            } else {
                console.error('❌ Fehler beim Speichern der Analyse-Daten');
                return null;
            }
        } catch (error) {
            console.error('❌ Fehler beim Speichern:', error);
            return null;
        }
    }

    // Funktion zum Berechnen der Präsentationsdauer im h:mm Format
    function calculatePresentationDuration() {
        if (!presentationStartTime) {
            console.warn('⚠️ Präsentations-Startzeit nicht verfügbar');
            return null;
        }
        
        const endTime = new Date();
        const durationMs = endTime.getTime() - presentationStartTime.getTime();
        const durationMinutes = Math.floor(durationMs / (1000 * 60));
        
        const hours = Math.floor(durationMinutes / 60);
        const minutes = durationMinutes % 60;
        
        // Format: h:mm (z.B. "1:30" für 1 Stunde 30 Minuten)
        const formattedDuration = `${hours}:${minutes.toString().padStart(2, '0')}`;
        
        console.log(`⏱️ Präsentationsdauer: ${formattedDuration} (${durationMinutes} Minuten total)`);
        
        return formattedDuration;
    }

    // Funktion zum Setzen des Mitarbeiter-Links oder Analyst-Feldes
    async function setMitarbeiterOrAnalyst(analyseRowId, analystName = null) {
        try {
            console.log('🔍 Suche Mitarbeiter-ID aus verschiedenen Quellen...');
            
            // Versuche Mitarbeiter-ID aus definierten Quellen zu ermitteln
            let mitarbeiterId = null;
            
            // 1. Aus URL-Parameter (z.B. ?mitarbeiter=123)
            const urlParams = new URLSearchParams(window.location.search);
            mitarbeiterId = urlParams.get('mitarbeiter');
            console.log('📋 URL-Parameter mitarbeiter:', mitarbeiterId);
            
            // 2. Aus LocalStorage (falls gesetzt)
            if (!mitarbeiterId) {
                mitarbeiterId = localStorage.getItem('currentMitarbeiterId');
                console.log('💾 LocalStorage currentMitarbeiterId:', mitarbeiterId);
            }
            
            // 3. Aus einem versteckten Input-Feld (falls vorhanden)
            if (!mitarbeiterId) {
                const hiddenInput = document.getElementById('mitarbeiter-id');
                if (hiddenInput && hiddenInput.value) {
                    mitarbeiterId = hiddenInput.value;
                    console.log('🔒 Hidden Input mitarbeiter-id:', mitarbeiterId);
                } else {
                    console.log('🔒 Hidden Input mitarbeiter-id: nicht gefunden oder leer');
                }
            }
            
            // 4. Direkte SeaTable-Abfrage für den aktuellen Berater (falls currentBeraterName gesetzt ist)
            if (!mitarbeiterId && window.currentBeraterName) {
                console.log('👤 Suche Mitarbeiter-ID für aktuellen Berater via SeaTable-API:', window.currentBeraterName);
                
                try {
                    // Direkte API-Abfrage an SeaTable um den Berater zu finden
                    const mitarbeiterTableUrl = `${apiGatewayUrl}api/v2/dtables/${SEATABLE_DTABLE_UUID}/rows/?table_name=Mitarbeiter`;
                    const response = await fetch(mitarbeiterTableUrl, {
                        method: 'GET',
                        headers: {
                            Authorization: `Bearer ${seaTableAccessToken}`,
                            "Content-Type": "application/json"
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('✅ Mitarbeiter-Daten von SeaTable erhalten, Anzahl:', data.rows?.length || 0);
                        
                        // Suche den Berater anhand des Namens (Spalte "Name" mit Key "lA2R")
                        const berater = data.rows?.find(row => row.lA2R === window.currentBeraterName);
                        
                        if (berater && berater._id) {
                            mitarbeiterId = berater._id;
                            console.log('✅ Mitarbeiter Row-ID gefunden:', mitarbeiterId);
                            console.log('📝 Berater-Objekt:', berater);
                        } else {
                            console.log('❌ Berater nicht in SeaTable gefunden');
                            console.log('🔍 Gesuchter Name:', window.currentBeraterName);
                            console.log('🔍 Erste 3 Mitarbeiter-Namen als Beispiel:', 
                                data.rows?.slice(0, 3).map(r => r.lA2R) || []);
                        }
                    } else {
                        console.log('❌ Fehler beim Laden der Mitarbeiter-Daten:', response.status);
                    }
                } catch (error) {
                    console.log('❌ Fehler bei SeaTable-Abfrage für Mitarbeiter:', error);
                }
            } else {
                console.log('🔍 Debug - Schritt 4 übersprungen:');
                console.log('  - mitarbeiterId bereits gesetzt:', !!mitarbeiterId);
                console.log('  - window.currentBeraterName:', window.currentBeraterName);
            }
            
            // Wenn Mitarbeiter-ID verfügbar ist, setze Mitarbeiter-Link
            if (mitarbeiterId) {
                console.log('🔗 Setze Mitarbeiter-Link mit ID:', mitarbeiterId);
                
                // Link in SeaTable setzen
                const linkSuccess = await updateSingleLink('Analysen', analyseRowId, 'Mitarbeiter', [mitarbeiterId]);
                
                if (linkSuccess) {
                    console.log('✅ Mitarbeiter-Link erfolgreich gesetzt');
                } else {
                    console.error('❌ Fehler beim Setzen des Mitarbeiter-Links');
                }
            } else {
                console.log('ℹ️ Kein Mitarbeiter eingeloggt - nur Analyst-Feld wird gesetzt');
            }
            
            // Analyst-Name IMMER setzen (unabhängig vom Mitarbeiter-Link)
            if (analystName && analystName.trim()) {
                console.log('📝 Setze Analyst-Name:', analystName);
                
                const analystSuccess = await seaTableUpdateRow('Analysen', analyseRowId, {
                    '7JQf': analystName.trim()  // Analyst column key
                });
                
                if (analystSuccess) {
                    console.log('✅ Analyst-Name erfolgreich gesetzt');
                } else {
                    console.error('❌ Fehler beim Setzen des Analyst-Namens');
                }
            } else {
                console.log('⚠️ Kein Analyst-Name verfügbar zum Speichern');
                console.log('🔍 Debug - analystName:', analystName);
            }
            
        } catch (error) {
            console.error('❌ Fehler beim Setzen von Mitarbeiter/Analyst:', error);
        }
    }

    // Funktion zum Speichern der Formulardaten von der "Noch ein paar Fragen"-Seite
    async function saveFragenFormular() {
        try {
            console.log('💾 Speichere Formulardaten aus "Noch ein paar Fragen"...');
            
            // Eingabefelder auslesen
            const kundenname = document.getElementById('kundenname')?.value?.trim() || '';
            const beratungstermin = document.getElementById('beratungstermin')?.value || '';
            const wichtigePunkte = document.getElementById('wichtige-punkte')?.value?.trim() || '';
            const unterlagen = document.getElementById('unterlagen')?.value || '';
            
            // Präsentationsdauer berechnen
            const dauer = calculatePresentationDuration();
            
            // Validierung
            if (!kundenname) {
                alert('Bitte geben Sie Ihren Namen ein.');
                return false;
            }
            
            if (!beratungstermin) {
                alert('Bitte wählen Sie einen Beratungstermin aus.');
                return false;
            }
            
            // Datum formatieren (von datetime-local zu YYYY-MM-DD)
            const btDatum = beratungstermin.split('T')[0]; // Extrahiert nur das Datum
            
            console.log('📝 Gesammelte Daten:', {
                kundenname,
                beratungstermin,
                btDatum,
                wichtigePunkte,
                unterlagen,
                dauer
            });
            
            // Daten für SeaTable vorbereiten (mit korrekten Spalten-Keys basierend auf Metadaten)
            const analyseData = {
                'yUHT': kundenname,           // Spalte "Kunde" (Key: yUHT)
                'mO8t': btDatum,              // Spalte "BTDatum" (Key: mO8t) 
                'O1PL': wichtigePunkte,       // Spalte "Themen" (Key: O1PL)
                'IEC0': unterlagen,           // Spalte "Unterlagen" (Key: IEC0)
                'rlwA': dauer                 // Spalte "Dauer" (Key: rlwA) - Format h:mm
                // Hinweis: Mitarbeiter-Link wird separat gesetzt (wenn verfügbar)
            };
            
            // In SeaTable speichern
            const newRowId = await seaTableAddRow('Analysen', analyseData);
            
            if (newRowId) {
                console.log('✅ Formulardaten erfolgreich gespeichert mit ID:', newRowId);
                console.log(`⏱️ Gespeicherte Dauer: ${dauer}`);
                
                // Mitarbeiter-Link oder Analyst-Name setzen
                await setMitarbeiterOrAnalyst(newRowId, window.currentBeraterName);
                
                // Erfolgsmeldung anzeigen (OHNE Dauer)
                showSuccessMessage('Ihre Angaben wurden erfolgreich gespeichert!');
                
                return newRowId;
            } else {
                throw new Error('Fehler beim Speichern in der Datenbank');
            }
            
        } catch (error) {
            console.error('❌ Fehler beim Speichern der Formulardaten:', error);
            alert('Es gab einen Fehler beim Speichern Ihrer Angaben. Bitte versuchen Sie es erneut.');
            return false;
        }
    }
    
    // Hilfsfunktion für Erfolgsmeldung
    function showSuccessMessage(message) {
        // Erstelle ein temporäres Erfolgs-Modal
        const successDiv = document.createElement('div');
        successDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
        successDiv.innerHTML = `
            <div class="bg-white rounded-lg p-8 max-w-md mx-4 text-center">
                <div class="text-green-600 text-6xl mb-4">✅</div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Erfolgreich gespeichert!</h3>
                <p class="text-gray-600 mb-6">${message}</p>
                <button onclick="this.parentElement.parentElement.remove()" 
                        class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    OK
                </button>
            </div>
        `;
        document.body.appendChild(successDiv);
        
        // Automatisch nach 3 Sekunden schließen
        setTimeout(() => {
            if (successDiv.parentElement) {
                successDiv.remove();
            }
        }, 3000);
    }
    
    // Event-Listener für automatisches Speichern beim Verlassen der Folie 20
    function addAutoSaveListener() {
        // Speichere beim Klick auf die Folie (nextStep wird aufgerufen)
        const originalNextStep = window.nextStep;
        window.nextStep = function() {
            // Prüfe, ob wir gerade auf Folie 20 sind (Noch ein paar Fragen)
            if (currentSlide === 20) {
                console.log('🔄 Verlasse Folie 20 - speichere Formulardaten...');
                saveFragenFormular().then(() => {
                    // Nach erfolgreichem Speichern zur nächsten Folie wechseln
                    originalNextStep.call(this);
                }).catch(() => {
                    // Bei Fehler trotzdem weiterblättern (Benutzer hat bereits eine Fehlermeldung gesehen)
                    originalNextStep.call(this);
                });
            } else {
                // Normale Navigation für andere Folien
                originalNextStep.call(this);
            }
        };
    }

    // Navigation functions for Immobilien buttons
    function navigateToSell() {
        console.log('🏠 Navigiere zu "Immobilie verkaufen" (Folie 12)');
        immobilienPath = 'sell';
        event.stopPropagation(); // Verhindere, dass der Click-Handler der Folie ausgelöst wird
        nextSlide(12);
    }

    function navigateToBuy() {
        console.log('🏠 Navigiere zu "Immobilie kaufen" (Folie 13)');
        immobilienPath = 'buy';
        event.stopPropagation(); // Verhindere, dass der Click-Handler der Folie ausgelöst wird
        nextSlide(13);
    }


  </script>
</body>
</html>
