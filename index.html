<!DOCTYPE html>
<html lang="de">
<head>
    <!-- Standard Favicons -->
<link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512x512.png">

<!-- Apple Touch Icons -->
<link rel="apple-touch-icon" sizes="120x120" href="icon-120.png">
<link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
<link rel="apple-touch-icon" sizes="167x167" href="icon-167.png">
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKT Success Dashboard</title>
    
    <!-- PWA Manifest & Theme Color -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#002147">

    <!-- Tailwind CSS CDN für schnelle und responsive Stile -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome für Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body class="flex flex-col min-h-screen text-skt-blue">
    <!-- Pull-to-Refresh Indikator -->
    <div id="refresh-indicator" class="fixed top-0 left-0 right-0 flex justify-center pt-3 opacity-0 transition-opacity duration-300 z-40">
        <div class="bg-white rounded-full shadow-lg h-10 w-10 flex items-center justify-center">
            <i class="fas fa-sync-alt text-skt-blue transition-transform duration-200"></i>
        </div>
    </div>

    <!-- Auswahlbereich für Benutzer -->
    <div id="user-select-screen" class="hidden flex-col items-center justify-start min-h-screen bg-gray-100 p-4 pt-16 sm:pt-24">
        <div class="w-full max-w-sm bg-white p-8 rounded-2xl shadow-xl border border-gray-200 text-center transform transition-transform duration-300 hover:scale-105">
            <div class="mb-6">
                <h1 class="text-3xl font-extrabold text-skt-blue leading-tight">Willkommen zurück!</h1>
                <p class="text-gray-500 mt-2">Wähle deinen Namen, um fortzufahren.</p>
            </div>
            <div class="mb-6">
                <div class="relative">
                    <select id="user-dropdown-select" class="block w-full px-4 py-3 rounded-xl border-2 border-gray-300 bg-white text-lg text-gray-700 appearance-none transition-colors duration-200 focus:border-skt-blue-main focus:ring-2 focus:ring-skt-blue-main focus:outline-none pr-10 cursor-pointer">
                        <option value="">Benutzer wählen ...</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-gray-500">
                        <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    </div>
                </div>
            </div>
            <div id="password-container" class="hidden mb-6">
                <input type="password" id="password-input" placeholder="Passwort" class="block w-full px-4 py-3 rounded-xl border-2 border-gray-300 bg-white text-lg text-gray-700 transition-colors duration-200 focus:border-skt-blue-main focus:ring-2 focus:ring-skt-blue-main focus:outline-none">
            </div>
            <button id="start-dashboard-btn" class="hidden w-full bg-skt-blue text-white font-semibold py-3 rounded-xl hover:bg-skt-blue-light transition-colors duration-200 shadow-md transform hover:-translate-y-0.5 active:translate-y-0 text-lg">Dashboard laden</button>
            <p id="user-select-error" class="text-red-600 mt-4 h-5 text-sm"></p>
        </div>
    </div>

    <!-- Dashboard-Container -->
    <div id="dashboard-content" class="hidden flex-col min-h-screen">
        <header class="w-full p-6 md:p-8 bg-skt-blue relative rounded-b-3xl z-50">
            <div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between gap-x-8 gap-y-4 relative">
                <div class="flex flex-col">
                    <h1 class="text-4xl sm:text-5xl font-bold font-times-new-roman text-white mb-2" id="welcome-header">Willkommen,</h1>
                    <p id="user-position" class="text-lg text-gold font-bold"></p>
                    <p class="text-lg sm:text-xl text-white mt-2">Dein persönliches Dashboard für Erfolg und Karriereplanung.</p>
                </div>
                <div class="relative self-start sm:self-center flex items-center space-x-2">
                    <button id="back-button" class="hidden bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 flex items-center justify-center" title="Zurück">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button id="dashboard-header-btn" class="bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 flex items-center justify-center" title="Dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                    </button>
                    <button id="einarbeitung-btn" class="bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 flex items-center justify-center" title="Einarbeitung">
                        <i class="fas fa-graduation-cap"></i>
                    </button>
                    <!-- NEU: Termin-Button im Header -->
                    <button id="appointments-header-btn" class="bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 flex items-center justify-center" title="Termine verwalten">
                        <i class="fas fa-calendar-alt"></i>
                    </button>
                    <!-- NEU: Umsatz-Button im Header -->
                    <button id="umsatz-header-btn" class="bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 flex items-center justify-center" title="Umsätze">
                        <i class="fas fa-chart-line"></i>
                    </button>
                    <!-- Folgende Buttons werden auf kleinen Bildschirmen in einem Menü zusammengefasst -->
                    <button id="pg-tagebuch-header-btn" class="hidden sm:flex bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 items-center justify-center" title="PG-Tagebuch">
                        <i class="fas fa-comments"></i>
                    </button>
                    <button id="potential-header-btn" class="hidden sm:flex bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 items-center justify-center" title="Potentialbearbeitung">
                        <i class="fas fa-users"></i>
                    </button>
                    <button id="auswertung-header-btn" class="hidden sm:flex bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 items-center justify-center" title="Auswertungen">
                        <i class="fas fa-trophy"></i>
                    </button>
                    <button id="strukturbaum-header-btn" class="hidden sm:flex bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 items-center justify-center" title="Strukturbaum">
                        <i class="fas fa-sitemap"></i>
                    </button>
                    <button id="ai-assistant-btn" class="hidden sm:flex bg-accent-purple text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-purple-700 transition-colors h-10 w-10 items-center justify-center" title="KI-Assistent">
                        <i class="fas fa-robot"></i>
                    </button>
                    <!-- NEU: "Mehr"-Menü für kleine Bildschirme -->
                    <div class="relative sm:hidden">
                        <button id="more-tools-btn" class="bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 flex items-center justify-center" title="Weitere Werkzeuge">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                        <div id="more-tools-menu" class="dropdown-menu hidden">
                             <a href="#" id="pg-tagebuch-menu-item" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-comments w-5 mr-2"></i>PG-Tagebuch</a>
                             <a href="#" id="potential-menu-item" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-users w-5 mr-2"></i>Potential</a>
                             <a href="#" id="auswertung-menu-item" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-trophy w-5 mr-2"></i>Auswertung</a>
                             <a href="#" id="strukturbaum-menu-item" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-sitemap w-5 mr-2"></i>Strukturbaum</a>
                             <a href="#" id="ai-assistant-menu-item" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-robot w-5 mr-2"></i>KI-Assistent</a>
                        </div>
                    </div>
                    <div class="relative">
                        <button id="settings-btn" class="bg-skt-blue-light text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-skt-blue-main transition-colors h-10 w-10 flex items-center justify-center" title="Einstellungen">
                            <i class="fas fa-cog"></i>
                        </button>
                        <div id="settings-menu" class="dropdown-menu hidden">
                             <a href="#" id="superuser-btn" class="hidden block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-users-cog w-5 mr-2"></i>Gesamtansicht</a>
                             <a href="#" id="money-view-btn" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-euro-sign w-5 mr-2"></i>Geld-Ansicht</a>
                             <a href="#" id="edit-user-btn" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-user-edit w-5 mr-2"></i>Personendaten</a>
                             <a href="#" id="planning-btn" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-tasks w-5 mr-2"></i>Planung</a>
                             <a href="#" id="add-new-user-btn" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-user-plus w-5 mr-2"></i>Neuer Nutzer</a>                             <a href="#" id="time-travel-btn" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-clock-rotate-left w-5 mr-2"></i>Zeitreise</a>
                             <a href="#" id="clear-cache-btn" class="block px-4 py-2 text-sm text-skt-blue hover:bg-skt-grey-light"><i class="fas fa-right-from-bracket w-5 mr-2"></i>Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- NEU: Zeitreise-Banner -->
        <div id="time-travel-banner" class="hidden bg-accent-purple text-white p-3 text-center font-semibold shadow-md z-40">
            <p>Zeitreise aktiv: <span id="time-travel-date-display"></span> <button id="reset-time-travel-btn" class="ml-4 font-bold underline hover:text-yellow-300">Zurück in die Gegenwart</button></p>
        </div>

        <!-- Hauptansicht für Dashboard -->
        <main id="main-dashboard-view" class="flex flex-col w-full max-w-7xl mx-auto flex-grow px-6 md:px-8 pt-2 md:pt-4 pb-6 space-y-6 overflow-hidden">
            <div id="notification-prompt" class="hidden bg-skt-blue-light text-white p-4 rounded-lg shadow-md flex justify-between items-center">
                <p>Möchtest du über wichtige Updates benachrichtigt werden?</p>
                <button id="enable-notifications-btn" class="bg-white text-skt-blue font-bold py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors">Aktivieren</button>
            </div>

            <div id="status-message" class="flex flex-col items-center justify-center text-center text-lg font-semibold text-skt-blue mt-6">
                <div class="loader mb-4"></div><p id="status-text">Daten werden geladen...</p>
            </div>

            <div id="dashboard-sections" class="space-y-12 opacity-0 transition-opacity duration-500">
                <section id="monthly-planning-view" class="bg-white rounded-2xl p-6 md:p-8 shadow-lg">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
                        <h2 id="monthly-planning-title" class="text-2xl font-semibold text-skt-blue">Monatsplanung</h2>
                        <div id="planning-view-toggle" class="view-toggle hidden flex w-full sm:w-auto space-x-2">
                            <button id="struktur-view-btn" class="flex-1">Struktur</button>
                            <button id="team-view-btn" class="active flex-1">Gruppe</button>
                            <button id="personal-view-btn" class="flex-1">Persönlich</button>
                        </div>
                    </div>
                    <div class="mb-8"><div id="weekly-progress-container" class="w-full flex relative h-5 mb-4 items-end"></div></div>
                    <div class="flex flex-col md:flex-row items-center justify-between gap-8 mb-8">
                        <div class="flex-grow md:w-1/2 relative w-full h-auto max-w-sm max-h-sm">
                            <svg class="progress-circle-monthly w-full h-full" viewBox="0 0 100 100">
                                <circle class="bg-circle" cx="50" cy="50" r="45"></circle>
                                <circle class="progress-arc-eh" cx="50" cy="50" r="45" id="progress-circle-eh"></circle>
                                
                                <circle class="prognosis-bg-circle" cx="50" cy="50" r="35"></circle>
                                <circle class="prognosis-arc-eh" cx="50" cy="50" r="35" id="prognosis-circle-eh"></circle>

                                <g id="segment-dividers-eh"></g>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center flex-col text-center">
                                <p class="text-xl sm:text-2xl lg:text-3xl font-bold text-skt-green-accent">
                                    <span id="eh-center-current">0</span> / <span id="eh-center-goal">0</span>
                                </p>
                                <p id="eh-center-unit-label" class="text-sm text-gray-500">Einheiten erreicht</p>
                                <p class="text-lg font-bold text-skt-yellow-accent mt-2">
                                    <span id="eh-soll-value">0</span>
                                </p>
                                <p id="eh-soll-unit-label" class="text-xs text-gray-500">Soll Einheiten</p>
                            </div>
                        </div>
                        <div class="flex-grow md:w-1/2 flex flex-col gap-8 w-full justify-center">
                            <div class="p-4 bg-skt-grey-light rounded-xl shadow-md text-center">
                                <p class="text-sm font-semibold text-skt-blue mb-2">Analysetermine</p>
                                <p class="text-lg font-bold text-skt-blue" id="appointments-text">0 / 0 / 0</p>
                                <p class="text-xs mb-2">
                                    <span class="font-semibold" style="color: var(--color-accent-green);">Gehalten</span> / 
                                    <span class="font-semibold" style="color: var(--color-skt-blue-main);">Vereinbart</span> / 
                                    <span class="font-semibold" style="color: var(--color-accent-red);">Soll</span>
                                </p>
                                <div id="appointments-progress-bar" class="w-full bg-accent-red-light h-3 rounded-full overflow-hidden relative">
                                    <div id="appointments-vereinbart-bar" class="h-full bg-skt-blue-accent absolute top-0 left-0 transition-all duration-700 ease-out" style="width: 0%;"></div>
                                    <div id="appointments-gehalten-bar" class="h-full bg-skt-green-accent absolute top-0 left-0 transition-all duration-700 ease-out" style="width: 0%;"></div>
                                </div>
                            </div>
                            <!-- UPDATE: Bewerbungsgespräche mit Balken -->
                            <div class="p-4 bg-accent-gold-light rounded-xl shadow-md border-2 border-accent-gold text-center">
                                <p class="text-sm text-skt-blue-light font-bold mb-2" data-tooltip="Fortschritt deiner gehaltenen Bewerbungsgespräche.">Einstellungstermine</p>
                                <p class="text-xl font-bold text-skt-blue mb-4"><span id="et-current">0</span> / <span id="et-goal">0</span></p>
                                <div id="interviews-progress-wrapper" class="w-full bg-skt-grey-medium h-3 rounded-full overflow-hidden relative">
                                    <div id="interviews-progress-bar" class="h-full bg-skt-green-accent absolute top-0 left-0 transition-all duration-700 ease-out" style="width: 0%;"></div>
                                </div>
                                <p id="next-info-date" class="text-sm text-skt-blue-light mt-3"></p>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="employee-view" class="bg-white rounded-2xl p-6 md:p-8 shadow-lg">
                    <h2 class="text-2xl font-semibold text-skt-blue mb-6 text-center">Dein aktueller Fortschritt</h2>
                    
                    <!-- NEU: Einarbeitungs-Banner -->
                    <div id="einarbeitung-banner" class="hidden mb-6 p-4 bg-skt-blue-light text-white rounded-xl shadow-lg flex justify-between items-center cursor-pointer hover:bg-skt-blue transition-colors">
                        <div>
                            <p class="font-bold text-lg">Neuer Mitarbeiter? Starte hier!</p>
                            <p>Verfolge deine Einarbeitungsschritte und starte erfolgreich durch.</p>
                        </div>
                        <i class="fas fa-arrow-right text-2xl"></i>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div id="tier-1-card" class="tier-card active"><h3 class="text-2xl font-bold mb-2 text-skt-blue">T1</h3><p class="text-sm text-skt-blue-light mb-4">0 EH</p><div class="w-full bg-skt-grey-light h-2 rounded-full overflow-hidden"><div id="tier-1-progress" class="h-full bg-skt-green-accent transition-all duration-700 ease-out" style="width: 100%;"></div></div></div>
                        <div id="tier-2-card" class="tier-card"><h3 class="text-2xl font-bold mb-2 text-skt-blue">T2</h3><p class="text-sm text-skt-blue-light mb-4">1.250 EH</p><div class="w-full bg-skt-grey-light h-2 rounded-full overflow-hidden"><div id="tier-2-progress" class="h-full bg-skt-green-accent transition-all duration-700 ease-out" style="width: 0%;"></div></div></div>
                        <div id="tier-3-card" class="tier-card"><h3 class="text-2xl font-bold mb-2 text-skt-blue">T3</h3><p class="text-sm text-skt-blue-light mb-4">2.500 EH</p><div class="w-full bg-skt-grey-light h-2 rounded-full overflow-hidden"><div id="tier-3-progress" class="h-full bg-skt-green-accent transition-all duration-700 ease-out" style="width: 0%;"></div></div></div>
                        <div id="tier-gst-card" class="tier-card"><h3 class="text-2xl font-bold mb-2 text-skt-blue">Junior GST</h3><p class="text-sm text-skt-blue-light mb-4">4.000 EH</p><div class="w-full bg-skt-grey-light h-2 rounded-full overflow-hidden"><div id="tier-gst-progress" class="h-full bg-skt-green-accent transition-all duration-700 ease-out" style="width: 0%;"></div></div></div>
                    </div>
                    <div class="flex flex-col md:flex-row items-center justify-between gap-8 mt-8">
                        <div class="flex-grow md:w-1/2 relative w-full h-auto max-w-96 max-h-96">
                            <svg class="progress-circle w-full h-full" viewBox="0 0 100 100">
                                <circle class="bg-circle" cx="50" cy="50" r="40"></circle><circle class="progress-arc" cx="50" cy="50" r="40" id="progress-circle-career"></circle>
                            </svg>
                            <div class="absolute inset-0 flex items-center justify-center flex-col text-center">
                                <p id="career-progress-percentage" class="text-3xl sm:text-4xl lg:text-5xl font-bold text-skt-blue">0%</p><p class="text-sm text-skt-blue-light mt-1" id="progress-to-next-text">Fortschritt zum ...</p>
                            </div>
                        </div>
                        <div class="flex-grow md:w-1/2 grid grid-cols-2 gap-4 w-full">
                            <div class="p-4 bg-skt-grey-light rounded-xl shadow-md flex flex-col items-center justify-center text-center">
                                <p id="eh-value-title" class="text-xs text-skt-blue-light font-bold" data-tooltip="Deine gesamten erreichten Einheiten">Erreichte EH (insgesamt)</p>
                                <div class="flex items-center justify-center h-full">
                                    <p id="eh-value-display" class="text-2xl font-bold text-skt-blue mt-1"><span id="current-eh-display">0</span><span id="eh-value-unit"> EH</span></p><i id="eh-checkmark" class="fas fa-check-circle text-5xl text-green-500 hidden"></i>
                                </div>
                            </div>
                            <div class="p-4 bg-skt-grey-light rounded-xl shadow-md flex flex-col items-center justify-center text-center">
                                <p class="text-xs text-skt-blue-light font-bold">Nächstes Karriereziel</p>
                                <div id="employee-info-container" class="mt-1 flex flex-col items-center justify-center">
                                    <p class="text-2xl font-bold text-skt-blue" id="employee-count-display">0</p><p id="employee-goal-status" class="text-skt-blue-light text-sm mt-1">...</p>
                                </div>
                                <div id="employee-slots-container" class="flex space-x-2 mt-2"></div>
                            </div>
                            <div class="p-4 col-span-2 bg-skt-grey-light rounded-xl shadow-md flex flex-col items-center justify-center text-center">
                                <p id="next-milestone" class="text-skt-blue-light text-sm font-bold">Nächster Meilenstein: <span class="text-skt-blue font-semibold">...</span></p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- NEU: Planungsqualitätsquote (PQQ) - jetzt klickbar -->
                <section id="pqq-view" class="hidden bg-white rounded-2xl p-6 md:p-8 shadow-lg cursor-pointer">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-semibold text-skt-blue mb-2">Planungsqualitätsquote (PQQ)</h2>
                        <i id="pqq-chevron" class="fas fa-chevron-down text-skt-blue-light transition-transform duration-300"></i>
                    </div>
                    <p class="text-sm text-gray-500 mb-6">Erfüllungsquote deiner ursprünglichen Ziele des Vormonats.</p>
                    <div class="w-full max-w-xl mx-auto">
                        <div id="pqq-gauge" class="relative h-8 rounded-full">
                            <div id="pqq-bar" class="h-full rounded-full"></div>
                            <div id="pqq-indicator" class="absolute top-0 h-full flex items-center">
                                <div class="w-1 h-10 bg-skt-blue rounded-full shadow-md"></div>
                            </div>
                            <div id="pqq-value-display" class="absolute text-skt-blue font-bold"></div>
                        </div>
                        <div class="flex justify-between text-xs font-semibold text-gray-500 mt-2 px-1">
                            <span>60%</span>
                            <span>100%</span>
                            <span>140%</span>
                        </div>
                    </div>
                    <!-- NEU: Detail-Container -->
                    <div id="pqq-details-container" class="pqq-details-collapsible collapsed mt-8 space-y-6">
                        <!-- EH Quote -->
                        <div>
                            <h3 class="text-lg font-semibold text-skt-blue mb-2">EH-Quote</h3>
                            <div class="w-full max-w-xl mx-auto">
                                <div class="relative h-8 rounded-full">
                                    <div class="h-full rounded-full" style="background: linear-gradient(to right, var(--color-accent-red), var(--color-accent-green) 50%, var(--color-accent-gold));"></div>
                                    <div id="pqq-eh-indicator" class="absolute top-0 h-full flex items-center" style="left: 50%; transition: left 0.7s ease-out;">
                                        <div class="w-1 h-10 bg-skt-blue rounded-full shadow-md"></div>
                                    </div>
                                    <div id="pqq-eh-value-display" class="absolute text-skt-blue font-bold" style="top: -25px; left: 50%; transform: translateX(-50%); transition: left 0.7s ease-out;"></div>
                                </div>
                                <div class="flex justify-between text-xs font-semibold text-gray-500 mt-2 px-1"><span>60%</span><span>100%</span><span>140%</span></div>
                            </div>
                        </div>
                        <!-- ET Quote -->
                        <div>
                            <h3 class="text-lg font-semibold text-skt-blue mb-2">ET-Quote</h3>
                            <div class="w-full max-w-xl mx-auto">
                                <div class="relative h-8 rounded-full">
                                    <div class="h-full rounded-full" style="background: linear-gradient(to right, var(--color-accent-red), var(--color-accent-green) 50%, var(--color-accent-gold));"></div>
                                    <div id="pqq-et-indicator" class="absolute top-0 h-full flex items-center" style="left: 50%; transition: left 0.7s ease-out;">
                                        <div class="w-1 h-10 bg-skt-blue rounded-full shadow-md"></div>
                                    </div>
                                    <div id="pqq-et-value-display" class="absolute text-skt-blue font-bold" style="top: -25px; left: 50%; transform: translateX(-50%); transition: left 0.7s ease-out;"></div>
                                </div>
                                <div class="flex justify-between text-xs font-semibold text-gray-500 mt-2 px-1"><span>60%</span><span>100%</span><span>140%</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="leadership-view" class="hidden bg-white rounded-2xl p-6 md:p-8 shadow-lg">
                    <div id="leader-personal-goal-container" class="mb-8"></div>
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                        <h2 id="leadership-view-title" class="text-2xl font-semibold text-skt-blue">Deine Struktur-Übersicht</h2>
                        <div id="leadership-view-mode-toggle" class="view-toggle flex space-x-2">
                            <button id="grid-view-btn" title="Kachelansicht"><i class="fas fa-th-large"></i></button>
                            <button id="list-view-btn" class="active" title="Listenansicht"><i class="fas fa-bars"></i></button>
                        </div>
                    </div>
                    <p id="leadership-view-count" class="text-center sm:text-left text-skt-blue-light mb-8"></p>
                    <div id="team-members-container" class="mt-6"></div>
                    <div id="passive-members-section" class="mt-8"></div>
                </section>
            </div>          
        </main>

        <!-- NEU: Ansicht für Einarbeitung -->
    <main id="einarbeitung-view" class="hidden w-full max-w-7xl mx-auto flex-grow px-4 md:px-8 pt-6 pb-6">
         <div class="bg-white rounded-2xl p-6 md:p-8 shadow-lg">
              <h2 id="einarbeitung-title" class="text-3xl font-bold text-skt-blue mb-8 text-center">Dein Einarbeitungsplan</h2>
              
              <!-- Container für die Trainee-Ansicht -->
              <div id="trainee-onboarding-view">
                  <div id="onboarding-progress-container" class="mb-8 px-2 md:px-4">
                      <div class="flex justify-between items-center mb-1">
                          <p class="font-semibold text-skt-blue">Gesamtfortschritt</p>
                          <p id="onboarding-progress-text" class="font-bold text-skt-blue">0%</p>
                      </div>
                      <div class="w-full bg-gray-200 rounded-full h-4 shadow-inner relative">
                          <div id="onboarding-soll-bar" class="bg-red-300 h-4 rounded-full absolute top-0 left-0 transition-all duration-700 ease-out" style="width: 0%; z-index: 1;" data-tooltip="Soll-Fortschritt"></div>
                          <div id="onboarding-progress-bar" class="bg-skt-green-accent h-4 rounded-full absolute top-0 left-0 transition-all duration-700 ease-out" style="width: 0%; z-index: 2;" data-tooltip="Ist-Fortschritt"></div>
                      </div>
                  </div>

                      <div class="space-y-8">
                      <!-- Container Grundseminar -->
                      <div id="grundseminar-container" class="bg-skt-grey-light p-6 rounded-xl shadow-md">
                          <h3 class="text-2xl font-bold text-skt-blue mb-6 text-center">Grundseminar</h3>
                          <div class="timeline-wrapper flex gap-x-4 md:gap-x-6">
                              <div class="w-12 md:w-20 flex-shrink-0 relative pt-4 pb-4">
                                  <div class="timeline-vertical-line"></div>
                                  <div class="timeline-vertical-line-progress" id="grundseminar-progress"></div>
                                  <div class="timeline-date-markers" id="grundseminar-date-markers"></div>
                              </div>
                              <div id="grundseminar-steps-container" class="space-y-4 flex-grow"></div>
                          </div>
                  </div>
                      <!-- Container Aufbauseminar -->
                      <div id="aufbauseminar-container" class="bg-skt-grey-light p-6 rounded-xl shadow-md">
                          <h3 class="text-2xl font-bold text-skt-blue mb-6 text-center">Aufbauseminar</h3>
                          <div class="timeline-wrapper flex gap-x-4 md:gap-x-6">
                              <div class="w-12 md:w-20 flex-shrink-0 relative pt-4 pb-4">
                                  <div class="timeline-vertical-line"></div>
                                  <div class="timeline-vertical-line-progress" id="aufbauseminar-progress"></div>
                                  <div class="timeline-date-markers" id="aufbauseminar-date-markers"></div>
                              </div>
                              <div id="aufbauseminar-steps-container" class="space-y-4 flex-grow"></div>
                            </div>
                      </div>
                    </div>
                </div>

                <!-- Container für die Führungskraft-Ansicht -->
                <div id="leader-onboarding-view" class="hidden">
                    <!-- Inhalt wird per JS generiert -->
                </div>
            </div>
        </main>
        
        <!-- Container für die Termin-Ansicht -->
        <main id="appointments-view" class="hidden w-full max-w-7xl mx-auto flex-grow px-4 md:px-8 pt-6 pb-6">
            <!-- Inhalt von appointments.html wird hier geladen -->
        </main>

        <!-- Container für die Potential-Ansicht -->
        <main id="potential-view" class="hidden w-full max-w-7xl mx-auto flex-grow px-4 md:px-8 pt-6 pb-6">
            <!-- Inhalt von potential.html wird hier geladen -->
        </main>

        <!-- Container für die Umsatz-Ansicht -->
        <main id="umsatz-view" class="hidden w-full max-w-7xl mx-auto flex-grow px-4 md:px-8 pt-6 pb-6">
            <!-- Inhalt von umsatz.html wird hier geladen -->
        </main>

        <!-- Container für die Auswertungs-Ansicht -->
        <main id="auswertung-view" class="hidden w-full max-w-7xl mx-auto flex-grow px-4 md:px-8 pt-6 pb-6">
            <!-- Inhalt von auswertung.html wird hier geladen -->
        </main>

        <!-- Container für die Strukturbaum-Ansicht -->
        <main id="strukturbaum-view" class="hidden w-full max-w-7xl mx-auto flex-grow px-4 md:px-8 pt-6 pb-6">
            <!-- Inhalt von strukturbaum.html wird hier geladen -->
        </main>

        <!-- Container für die PG-Tagebuch-Ansicht -->
        <main id="pg-tagebuch-view" class="hidden w-full max-w-7xl mx-auto flex-grow px-4 md:px-8 pt-6 pb-6">
            <!-- Inhalt von pg-tagebuch.html wird hier geladen -->
        </main>
    </div>

    <!-- Modals -->
    <div id="ios-instructions-modal" class="modal-overlay">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-sm text-center">
            <h3 class="text-xl font-bold text-skt-blue mb-2">Benachrichtigungen aktivieren</h3>
            <p class="text-gray-600 mb-4">Um Benachrichtigungen auf einem iPhone zu erhalten, füge diese App bitte zuerst zu deinem Home-Bildschirm hinzu:</p>
            <ol class="text-left text-gray-600 space-y-2 mb-4">
                <li>1. Tippe auf das <i class="fas fa-share-square"></i> **Teilen-Symbol** in der Browser-Leiste.</li>
                <li>2. Scrolle nach unten und wähle **"Zum Home-Bildschirm"**.</li>
                <li>3. Starte die App vom neuen Icon auf deinem Home-Bildschirm.</li>
            </ol>
            <button id="close-ios-modal-btn" class="w-full bg-skt-blue text-white font-semibold py-2 rounded-lg hover:bg-skt-blue-light transition-colors">Verstanden</button>
        </div>
    </div>
    
    <div id="hinweis-modal" class="modal-overlay">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-md relative">
            <button id="close-hinweis-modal-btn" class="absolute top-2 right-3 text-2xl text-gray-500 hover:text-skt-blue">&times;</button>
            <h3 id="hinweis-modal-title" class="text-xl font-bold text-skt-blue mb-4">Hinweis</h3>
            <div id="hinweis-modal-content" class="text-gray-700"></div>
        </div>
    </div>

    <!-- NEU: Modal zum Bearbeiten von Benutzerdaten -->
    <div id="edit-user-modal" class="modal-overlay">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full relative">
             <button id="cancel-edit-user-btn" class="absolute top-2 right-3 text-2xl text-gray-500 hover:text-skt-blue">&times;</button>
             <h3 class="text-2xl font-bold text-skt-blue mb-6">Personendaten bearbeiten</h3>
             <form id="edit-user-form" class="space-y-4">
                 <div>
                     <label for="edit-name" class="block text-sm font-medium text-gray-700">Name</label>
                     <input type="text" id="edit-name" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                 <div>
                     <label for="edit-pwd" class="block text-sm font-medium text-gray-700">Passwort</label>
                     <input type="text" id="edit-pwd" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                  <div>
                     <label for="edit-eh-quote" class="block text-sm font-medium text-gray-700">EH pro AT Quote</label>
                     <input type="number" id="edit-eh-quote" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                 <div>
                     <label for="edit-start-date" class="block text-sm font-medium text-gray-700">Startdatum</label>
                     <input type="date" id="edit-start-date" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                 <div>
                     <label for="edit-birthday" class="block text-sm font-medium text-gray-700">Geburtstag</label>
                     <input type="date" id="edit-birthday" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                 <div>
                     <label for="edit-promotion-date" class="block text-sm font-medium text-gray-700">Nächstes Rennen Startdatum</label>
                     <input type="date" id="edit-promotion-date" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                     <p class="mt-1 text-xs text-gray-500">Startdatum deines nächsten Karriereschritts</p>
                 </div>
                 <div class="flex items-center space-x-3 pt-2">
                     <label for="edit-ausgeschieden" class="toggle-switch">
                         <input type="checkbox" id="edit-ausgeschieden" class="sr-only peer">
                         <div class="toggle-slider"></div>
                     </label>
                     <label for="edit-ausgeschieden" class="text-sm font-medium text-gray-700">Mitarbeiter ausgeschieden</label>
                 </div>
                 <div id="ausscheide-fields-container" class="hidden space-y-4 border-t border-gray-200 pt-4 mt-4">
                     <div>
                         <label for="edit-ausscheidetag" class="block text-sm font-medium text-gray-700">Ausscheidedatum</label>
                         <input type="date" id="edit-ausscheidetag" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                     </div>
                     <div>
                         <label for="edit-ausscheidegrund" class="block text-sm font-medium text-gray-700">Ausscheidegrund</label>
                         <textarea id="edit-ausscheidegrund" rows="2" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main"></textarea>
                     </div>
                 </div>
                 <div class="pt-4 flex justify-end space-x-3">
                     <button type="button" id="cancel-edit-user-btn-2" class="bg-gray-200 text-gray-800 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition-colors">Abbrechen</button>
                     <button type="submit" id="save-user-btn" class="bg-skt-blue text-white font-semibold py-2 px-5 rounded-lg hover:bg-skt-blue-light transition-colors">Speichern</button>
                 </div>
             </form>
        </div>
    </div>
    <!-- NEU: Modal zum Hinzufügen von Benutzern -->
    <div id="add-user-modal" class="modal-overlay">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full relative">
             <button id="cancel-add-user-btn" class="absolute top-2 right-3 text-2xl text-gray-500 hover:text-skt-blue">&times;</button>
             <h3 class="text-2xl font-bold text-skt-blue mb-6">Neuen Nutzer anlegen</h3>
             <form id="add-user-form" class="space-y-4">
                 <div>
                     <label for="add-name" class="block text-sm font-medium text-gray-700">Name</label>
                     <input type="text" id="add-name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                 <div>
                     <label for="add-pwd" class="block text-sm font-medium text-gray-700">Passwort</label>
                     <input type="text" id="add-pwd" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                 <div>
                     <label for="add-birthday" class="block text-sm font-medium text-gray-700">Geburtstag</label>
                     <input type="date" id="add-birthday" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main">
                 </div>
                 <div>
                     <label for="add-werber" class="block text-sm font-medium text-gray-700">Werber</label>
                     <select id="add-werber" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main"></select>
                 </div>
                 <div>
                     <label for="add-buero" class="block text-sm font-medium text-gray-700">Büro</label>
                     <select id="add-buero" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-skt-blue-main focus:border-skt-blue-main"></select>
                 </div>
                 <div class="pt-4 flex justify-end space-x-3">
                     <button type="button" id="cancel-add-user-btn-2" class="bg-gray-200 text-gray-800 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition-colors">Abbrechen</button>
                     <button type="submit" id="save-new-user-btn" class="bg-skt-blue text-white font-semibold py-2 px-5 rounded-lg hover:bg-skt-blue-light transition-colors">Nutzer anlegen</button>
                 </div>
             </form>
        </div>
    </div>
    <!-- NEU: Modal für die Monatsplanung -->
    <div id="planning-modal" class="modal-overlay">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full relative">
             <button id="cancel-planning-btn" class="absolute top-2 right-3 text-2xl text-gray-500 hover:text-skt-blue">&times;</button>
             <h3 id="planning-modal-title" class="text-2xl font-bold text-skt-blue mb-6">Monatsplanung hinzufügen/bearbeiten</h3>
             <form id="planning-form" class="space-y-4">
                 <div>
                     <label for="planning-user-select" class="block text-sm font-medium text-gray-700">Mitarbeiter</label>
                     <select id="planning-user-select" required class="modern-select"></select>
                 </div>
                 <div class="grid grid-cols-2 gap-4">
                     <div>
                         <label for="planning-month-select" class="block text-sm font-medium text-gray-700">Monat</label>
                         <select id="planning-month-select" required class="modern-select"></select>
                     </div>
                     <div>
                         <label for="planning-year-input" class="block text-sm font-medium text-gray-700">Jahr</label>
                         <input type="number" id="planning-year-input" required class="modern-input">
                     </div>
                 </div>
                 <div>
                     <label for="planning-eh-goal" class="block text-sm font-medium text-gray-700">EH Ziel</label>
                     <input type="number" id="planning-eh-goal" required class="modern-input">
                 </div>
                 <div>
                     <label for="planning-et-goal" class="block text-sm font-medium text-gray-700">ET Ziel</label>
                     <input type="number" id="planning-et-goal" required class="modern-input">
                 </div>
                 <div>
                     <label for="planning-infoabend-date" class="block text-sm font-medium text-gray-700">Zugehöriger Infoabend</label>
                     <input type="date" id="planning-infoabend-date" disabled class="modern-input bg-gray-100 cursor-not-allowed">
                     <p class="mt-1 text-xs text-gray-500">Dieses Datum wird automatisch auf den nächsten Infoabend gesetzt.</p>
                 </div>
                 <div class="pt-4 flex justify-end space-x-3">
                     <button type="button" id="cancel-planning-btn-2" class="bg-gray-200 text-gray-800 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition-colors">Abbrechen</button>
                     <button type="submit" id="save-planning-btn" class="bg-skt-blue text-white font-semibold py-2 px-5 rounded-lg hover:bg-skt-blue-light transition-colors">Planung speichern</button>
                 </div>
             </form>
        </div>
    </div>
    <!-- NEU: Modal für die Zeitreise -->
    <div id="time-travel-modal" class="modal-overlay">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full relative">
             <button id="cancel-time-travel-btn" class="absolute top-2 right-3 text-2xl text-gray-500 hover:text-skt-blue">&times;</button>
             <h3 class="text-2xl font-bold text-skt-blue mb-6">Zeitreise</h3>
             <p class="text-gray-600 mb-6">Wähle ein Datum in der Vergangenheit, um das Dashboard so anzuzeigen, als wärst du in diesem Monat.</p>
             <form id="time-travel-form" class="space-y-4">
                 <div class="grid grid-cols-2 gap-4">
                     <div>
                         <label for="time-travel-month-select" class="block text-sm font-medium text-gray-700">Monat</label>
                         <select id="time-travel-month-select" required class="modern-select"></select>
                     </div>
                     <div>
                         <label for="time-travel-year-select" class="block text-sm font-medium text-gray-700">Jahr</label>
                         <select id="time-travel-year-select" required class="modern-select"></select>
                     </div>
                 </div>
                 <div class="pt-4 flex justify-end space-x-3">
                     <button type="button" id="cancel-time-travel-btn-2" class="bg-gray-200 text-gray-800 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition-colors">Abbrechen</button>
                     <button type="submit" id="start-time-travel-btn" class="bg-skt-blue text-white font-semibold py-2 px-5 rounded-lg hover:bg-skt-blue-light transition-colors">Reise starten</button>
                 </div>
             </form>
        </div>
    </div>
    <!-- NEU: Benutzerdefiniertes Bestätigungs-Modal -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-md w-full text-center">
            <h3 id="confirm-modal-title" class="text-xl font-bold text-skt-blue mb-4">Bestätigung</h3>
            <p id="confirm-modal-text" class="text-gray-600 mb-6">Möchten Sie diese Aktion wirklich durchführen?</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-modal-cancel-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">Abbrechen</button>
                <button id="confirm-modal-ok-btn" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-red-700 transition-colors">Bestätigen</button>
            </div>
        </div>
    </div>

    <!-- Lodash für Hilfsfunktionen wie _.debounce -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script type="module" src="main.js"></script>
</body>
</html>